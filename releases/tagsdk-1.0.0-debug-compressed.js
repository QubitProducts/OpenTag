try{(function(){var y,v;(function(){Function.prototype.bind=Function.prototype.bind||function(a){var h=this;return function(){return h.apply(a,arguments)}}})();var u=function(){};(function(){function a(){}var h=null;try{h=(0,eval)("this")||function(){return this}()}catch(b){}a.global=function(){return h};a.namespace=function(d,c,b,g){d=d.split(".");var n=a.NAMESPACE_BASE||a.global(),e=null,m=null,n=b||n;for(b=0;b<d.length-1;b+=1)m=d[b],n[m]=n[m]||{},n=n[m];e=n;m=d[d.length-1];h.TAGSDK_NS_OVERRIDE&&
(g=!1);void 0!==c?void 0!==e[m]&&g||(e[m]=c):e[m]=e[m]||{};return e[m]};a.clazz=function(d,c,b,g,h){a.namespace(d,c,g,!0);"function"===typeof b&&(c.superclass=b,c.prototype=new c.superclass(h));c.prototype&&(d=d.split("."),c.prototype.CLASS_NAME=d[d.length-1],d.splice(d.length-1,1),c.prototype.PACKAGE_NAME=d.join("."));return c};a.clazz("qubit.Define",a)})();(function(){function a(a){}for(var h={},b=0;93>b;b++)h["abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ*!-#$&+()@'%./:<>?[\"]^_`{|}~\\;=".charAt(b)]=
b;qubit.Define.clazz("qubit.Cookie",a);a.cookieAlphabet="abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ*!-#$&+()@'%./:<>?[\"]^_`{|}~\\;=";a.cookieAlphabetMap=h;a.decode=function(a){return decodeURIComponent(a)};a.encode=function(a){return encodeURIComponent(a)};a.set=function(d,c,b,g,h){if(b){var e=new Date;e.setTime(e.getTime()+864E5*b);b="; expires="+e.toGMTString()}else b="";h&&(d=a.encode(d),c=a.encode(c));d=d+"="+c+b+"; path=/;";g&&(d+=" domain="+g);document.cookie=d};a.get=function(b,
c){for(var f=b+"=",g=document.cookie.split(";"),h=0;h<g.length;h++){for(var e=g[h];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(f))return f=e.substring(f.length,e.length),c&&(f=a.decode(f)),f}return null};a.getAll=function(b,c){for(var f=b+"=",g=document.cookie.split(";"),h=[],e=0;e<g.length;e++){for(var m=g[e];" "===m.charAt(0);)m=m.substring(1,m.length);0===m.indexOf(f)&&(m=m.substring(f.length,m.length),c&&(m=a.decode(m)),h.push(m))}return h};a.rm=function(b,c){a.set(b,"",-1,c)}})();
(function(){function a(a){if(a)if(a.alphabet)for(this.alphabet=a.alphabet,this.dict={},a=0;a<this.alphabet.length;a++)this.dict[this.alphabet[a]]=a;else this.alphabet=b,this.dict=f}function h(a,b){for(var e in b)if(a===b[e])return e;return null}for(var b=[],d=Math.pow(2,8),c=0;c<d;c++)b.push(String.fromCharCode(c));for(var f={},d=0;d<b.length;d++)f[b[d]]=d;qubit.Define.clazz("qubit.compression.LZW",a);a.prototype.encode=function(a){for(var b=this.alphabet.length,e={},c=[],d=0,l=a.charAt(d++),p,k=
this.dict;p=a.charAt(d++);){var s=l+p;if(k.hasOwnProperty(s)||e.hasOwnProperty(s))l=s;else{var f=k.hasOwnProperty(l)?k[l]:e[l];if(void 0===f)throw"Dictionary base is to small for those contents: "+l;c.push(f);e[s]=b++;l=p}}""!==l&&c.push(e.hasOwnProperty(l)?e[l]:k[l]);return c};a.prototype.decode=function(a){for(var b=this.dict,e=this.alphabet.length,c,d={},l=h(a[0],b),p=l,k=[l],s=1;s<a.length;s++){var f=a[s];c=h(f,b);null===c&&(d.hasOwnProperty(f)&&(c=d[f]),null===c&&(c=p+l));k.push(c);l=c.charAt(0);
d[e++]=p+l;p=c}return k.join("")}})();(function(){function a(a){}for(var h={},b=0;45>b;b++)h["abcdefghijklmnopqrstuvwxyz0123456789'%./:<>?[".charAt(b)]=b;for(var d={},b=0;45>b;b++)d['ABCDEFGHIJKLMNOPQRSTUVWXYZ*!-#$&+()@"]^_`{|}~'.charAt(b)]=b;for(var c={},b=0;45>b;b++)c["abcdefghijklmnopqrstuvwxyz0123456789'%./:<>?[".charAt(b)]='ABCDEFGHIJKLMNOPQRSTUVWXYZ*!-#$&+()@"]^_`{|}~'.charAt(b);var f="abcdefghijklmnopqrstuvwxyz0123456789'%./:<>?[".split(""),g=f.length,n=new qubit.compression.LZW({});qubit.Define.clazz("qubit.compression.Compressor",
a);a.prototype.compress=function(a,b){for(var c=(b||n).encode(a),l=[],p=0;p<c.length;p++)l.push(String.fromCharCode(c[p]));return l.join("")};a.prototype.compressAnsi=function(a,b){for(var d=(b||n).encode(a),l=[],p=0;p<d.length;p++){var k;k=d[p];var s=0,E=0>k;E&&(k=-k);var h="",t=!0;do s=k%g,t?(h=c[f[s]],t=!1):h=f[s]+h,k=(k-s)/g;while(0<k);k=E?"-"+h:h;l.push(k)}return l.join("")};a.prototype.decompressAnsi=function(a,b){for(var c=[],l="",p=0;p<a.length;p++){var k=a.charAt(p);if(d.hasOwnProperty(k)){for(var k=
l+k,l="",s=0,f=0,w=!0,t=0;t<k.length;t++){var D=k.charAt(k.length-1-t);w&&(w=!1,D="abcdefghijklmnopqrstuvwxyz0123456789'%./:<>?[".charAt(d[D]));s+=h[D]*Math.pow(g,f++)}k=s;c.push(k)}else l+=k}return(b||n).decode(c)};a.prototype.decompress=function(a,b){for(var c=[],l=0;l<a.length;l++)c.push(a.charCodeAt(l));return(b||n).decode(c)}})();(function(){function a(){}function h(a,p){for(var k=g.length,s=0;s<k;s++)if(a===g[s][0])return g[s][1];g[g.length]=[a,p];return!1}function b(a,p,k,s,e){var c=!1,d=!1,
m=!1,r=!1,n=!1,n=!1;p&&(c=(n=!!p.all)||p.nodes,r=n||p.win,d=n,m=p.noFunctions&&!n,void 0!==p.noOwn&&(d=!!p.noOwn),void 0!==p.noFunctions&&(m=!!p.noFunctions),void 0!==p.win&&(r=!!p.win),void 0!==p.nodes&&(c=!!p.nodes),n=!!p.copyReference);if(void 0===k||k){void 0!==k&&k--;if(!(a&&a instanceof Object))return a;if(!c){try{if(a instanceof Node)return a}catch(A){if(a instanceof ActiveXObject&&void 0!==a.nodeType)return a}if(a===document)return a}if(!r&&a===f)return a;c=a instanceof Array?[]:{};a instanceof
Date&&(c=new Date(a));!m&&a instanceof Function&&(m=String(a).replace(/\s+/g,""),c=m.indexOf("{[nativecode]}")+14===m.length?function(){return a.apply(e||this,arguments)}:function(){return a.apply(this,arguments)});void 0===s&&(g=[],s=0);if(m=h(a,c))return m;if(c instanceof Array)for(m=0;m<a.length;m++)c[c.length]=a[m]===a[m]?b(a[m],p,k,s+1,a):a[m];else{var m=0,q;for(q in a){if(d||a.hasOwnProperty(q))c[q]=a[q]===a[q]?b(a[q],p,k,s+1,a):a[q];m++}}p.proto&&(c.prototype=b(a.prototype,p,k,s+1,a));n&&(c.___copy_ref=
a);return c}}function d(a,p,k,e,c,b,g){k=k||{};void 0===k.hasOwn&&(k.hasOwn=!0);if(!k.objectsOnly||a instanceof Object)if(void 0===k.maxDeep||k.maxDeep){void 0!==k.maxDeep&&k.maxDeep--;if(!k||!k.nodes)try{if(a instanceof Node)return}catch(m){if(a instanceof ActiveXObject&&void 0!==a.nodeType)return}if(a!==f){void 0===e&&(n=[],e=0);var r;a:{for(r=0;r<e&&r<n.length;r++)if(a===n[r]){r=!0;break a}r=!1}if(!(r||(n[e]=a,c=c||a,c&&b&&c[b]!==c[b]||p(a,c,b,g)))){b=0;r="";for(var h in a){if(!k.hasOwn||a.hasOwnProperty(h))try{var q=
a[h];k.track&&(r=g?g+"."+h:h);d(q,p,k,e+1,c,h,r)}catch(u){}b++}}}}}var c=qubit.Define,f=c.global();c.clazz("qubit.opentag.Utils",a);a.global=c.global;a.namespace=c.namespace;a.clazz=c.clazz;a.getObjectUsingPath=function(a,p){p=p||f;for(var k=a.split("."),e=0;e<k.length;e++)p&&k[e]&&(p=p[k[e]]);return p};a.variableExists=function(a){return void 0!==a&&null!==a&&""!==a};a.ANON_VARS=[];a.getAnonymousAcessor=function(l){var e=a.indexInArray(l,a.ANON_VARS);-1===e&&(e=a.addToArrayIfNotExist(a.ANON_VARS,
l));return"qubit.opentag.Utils.ANON_VARS["+e+"]"};a.replaceAll=function(a,e,k){return a.replace(new RegExp(e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),k)};a.secureText=function(a){"string"!==typeof a&&(a+="");a=a.replace(/</g,"&lt;");return a=a.replace(/>/g,"&gt;")};a.getUrl=function(){return document.location.href};a.getQueryParam=function(l){var e,k,c,b;e=a.getUrl();if(0<e.indexOf("?"))for(b=e.substring(e.indexOf("?")+1).split("&"),e=0,k=b.length;e<k;e+=1)if(c=b[e],0<c.indexOf("=")&&(c=
c.split("="),2===c.length&&c[0]===l))return c[1];return null};a.getElementValue=function(a){return(a=document.getElementById(a))?a.textContent||a.innerText:null};var g=[];a.objectCopy=function(a,e){e=e||{};var k=b(a,e,e.maxDeep);g=[];return k};var n=[];a.traverse=function(a,e,k){d(a,e,k)};a.prepareQuotedString=function(a){return"string"===typeof a?'"'+a.replace(/\"/g,'\\"')+'"':a};a.expressionToFunction=function(l,e){return a.gevalAndReturn("function ("+(e||"")+") {"+l+"}").result};a.defineClass=
function(l,e,k){var c=l.split("."),c=a.gevalAndReturn("(function "+c[c.length-1]+"() {  if ("+l+"._CONSTRUCTOR) {    return "+l+"._CONSTRUCTOR.apply(this, arguments);  } else {    if ("+l+".superclass) {      return "+l+".superclass.apply(this, arguments);    }  }})").result;c._CONSTRUCTOR=k.CONSTRUCTOR;c.superclass=e;a.clazz(l,c,e);for(var b in k)k.hasOwnProperty(b)&&"CONSTRUCTOR"!==b&&(c.prototype[b]=k[b]);return c};a.keys=function(a){if(a instanceof Object){if(Object.keys)return Object.keys(a);
var e=[],k;for(k in a)a.hasOwnProperty(k)&&(e[e.length]=k);return e}throw"keys() called on non-object!";};a.getSrcElement=function(a){var e;a=a||window.event;a.srcElement?e=a.srcElement:a.target&&(e=a.target);return e};a.addToArrayIfNotExist=function(a,e){for(var k=0,c=!1;k<a.length;k+=1)if(a[k]===e){c=!0;break}c||(a[a.length]=e,k=-1);return k};a.indexInArray=function(a,e){for(var k=0,c=!1;k<a.length;k++)if(a[k]===e){c=!0;break}return c?k:-1};a.removeFromArray=function(a,e){for(var k=0;k<a.length;k+=
1)a[k]===e&&a.splice(k,1)};a.addClass=function(l,e){var k;try{l.classList.add(e)}catch(c){null===l.className?l.className=e:(k=l.className.split(" "),a.addToArrayIfNotExist(k,e),l.className=k.join(" "))}};a.removeClass=function(l,e){var k;try{l.classList.remove(e)}catch(c){null===l.className?l.className="":(k=l.className.split(" "),a.removeFromArray(k,e),l.className=k.join(" "))}};a.gevalAndReturn=function(l){a.gevalAndReturn.___var_test___=void 0;a.gevalAndReturn.___var_test___error=void 0;a.geval("try{qubit.opentag.Utils.gevalAndReturn.___var_test___=("+
l+");}catch(ex){qubit.opentag.Utils.gevalAndReturn.___var_test___error = ex;}");return{result:a.gevalAndReturn.___var_test___,error:a.gevalAndReturn.___var_test___error}};a.trim=function(a){try{return String(a).trim()}catch(e){return String(a).replace(/^\s+|\s+$/g,"")}};a.setIfUnset=function(a,e){if(a&&e)for(var k in e)e.hasOwnProperty(k)&&!a.hasOwnProperty(k)&&(a[k]=e[k])};a.geval=function(a){window&&window.execScript?window.execScript(a):f.eval.call(f,a)};var e=[],m=!1;a.bodyReady=function(a){if(m)return a&&
a(),!0;if(m=!(!document.body||"complete"!==document.readyState)){for(var c=0;c<e.length;c++)try{e[c]()}catch(k){f.console&&f.console.trace&&f.console.trace(k)}a&&a()}else a&&e.push(a);return m};var r=f.onload;f.onload=function(e){a.bodyReady();r&&r(e)}})();(function(){function a(e,c,b){this.collectLogs=!!a.COLLECT;this.collectLocally=b;this.collection=[];this.getPrefix=function(){var a="";c&&("function"===typeof c?a=c(this.ref):c.CLASS_NAME?a=c.CLASS_NAME:c.constructor&&c.constructor.name&&(a=c.constructor.name),
a&&(a+=" -> "));return(e||"")+a}}function h(e,c,b,l,d,k,s,g){var f=a.LEVEL>=g;if(0<=a.COLLECT_LEVEL||f)c=d?[l,s,b]:[c+e.getPrefix()+l,k,b],c[3]=g,e.collect(c,g),f&&e.printMessage.apply(e,c)}var b=qubit.Define,d=null;b.clazz("qubit.opentag.Log",a);a.LEVEL_FINEST=4;a.LEVEL_FINE=3;a.LEVEL_INFO=2;a.LEVEL_WARN=1;a.LEVEL_ERROR=0;a.LEVEL_NONE=-1;a.MAX_LOG_LEN=1E4;a.prototype.MAX_LOG_LEN=-1;a.LEVEL=a.LEVEL_NONE;a.LEVEL=a.LEVEL_INFO;a.COLLECT_LEVEL=a.LEVEL_FINE;a.COLLECT=!0;var c=[];a.logsCollection=c;a.rePrintAll=
function(e,c,b,l){var p=a.LEVEL;void 0!==e&&(a.LEVEL=e);try{if(a.COLLECT){try{b||d.clear()}catch(k){}var s=l||a.logsCollection,g=0;for(b=0;b<s.length;b++)(function(l){var k=s[l];l=k[3];void 0!==l&&a.LEVEL>=l&&(g++,c?qubit.opentag.Timed.setTimeout(function(){void 0!==e&&(a.LEVEL=e);try{a.print.apply(a,k)}finally{a.LEVEL=p}},g*c):a.print.apply(a,k))})(b)}}catch(f){}finally{a.LEVEL=p}};var f=!!b.global().webkitURL;a.isStyleSupported=function(){return f};var g={};a.setConsole=function(a){return d=a=a||
g};a.delayPrint=-1;var n=(new Date).valueOf();a.prototype.printMessage=function(e,c,b,l){if(0<a.delayPrint){var d=a.delayPrint,k=n-(new Date).valueOf();0<k&&(d+=k);try{qubit.opentag.Timed.setTimeout(function(){this.print(e,c,b,l)}.bind(this),d)}catch(s){setTimeout(function(){this.print(e,c,b,l)}.bind(this),d)}n=(new Date).valueOf()+d}else this.print(e,c,b,l)};a.prototype.print=function(e,c,b,l){a.print(e,c,b,l)};a.print=function(e,c,b,l){if(!(void 0!==l&&a.LEVEL<l))try{if(d&&d.log)if(c&&a.isStyleSupported())if(b&&
d[b])d[b]("%c"+e,c);else d.log("%c"+e,c);else if(b&&d[b])d[b](e);else d.log(e)}catch(p){}};a.prototype.collect=function(e,b){void 0===b&&(b=a.COLLECT_LEVEL);var d=!1,l=this.collectLogs&&a.COLLECT&&a.COLLECT_LEVEL>=+b;l&&(c.push(e),d=!0);this.collectLocally&&l&&(this.collection.push(e),d=!0);0<a.MAX_LOG_LEN&&c.length>a.MAX_LOG_LEN&&c.splice(0,c.length-a.MAX_LOG_LEN);if(0<a.MAX_LOG_LEN||0<this.MAX_LOG_LEN)l=a.MAX_LOG_LEN,0<this.MAX_LOG_LEN&&(l=this.MAX_LOG_LEN),this.collection.length>l&&this.collection.splice(0,
this.collection.length-l);return d?e:null};a.clearAllLogs=function(){try{d.clear()}catch(a){}finally{c.splice(0,c.length)}};a.getCollectedByLevel=function(a,b){b=b||c;for(var d=[],l=0;l<b.length;l++){var p=b[l];p[0][4]===a&&d.push(p)}return d};a.prototype.rePrint=function(e,c,b){a.rePrintAll(e,c,!b,this.collection)};a.prototype.FINEST=function(e,c){h(this,"FINEST: ",!1,e,c,"color:#CCCCCC;",!1,a.LEVEL_FINEST)};a.prototype.FINE=function(c,b){h(this,"FINE: ",!1,c,b,"color:#999999;",!1,a.LEVEL_FINE)};
a.prototype.INFO=function(c,b,d){h(this,"INFO: ","info",c,b,d,d,a.LEVEL_INFO)};a.prototype.WARN=function(c,b){h(this,"WARN: ","warn",c,b,"color:#26A110;",!1,a.LEVEL_WARN)};a.prototype.ERROR=function(c,b){h(this,"ERROR: ","error",c,b,"color:red;",!1,a.LEVEL_ERROR)};a.setConsole(b.global().console)})();(function(){function a(a){a&&(b.FINEST("Config:"),b.FINEST(a,!0),this._rate=a.rate||10,this._smallestRate=-1,a.start&&this.startPooling(),this.config=a);this.inervals=[];this._lck_obj={};this._binded_pool=
this._pool.bind(this)}var h=qubit.opentag.Utils,b=new qubit.opentag.Log("Timer -> ");h.clazz("qubit.opentag.Timer",a);a.prototype.timers=[];a.prototype.startPooling=function(a){a&&this.config.dynamic&&(0>this._smallestRate||this._smallestRate>a)&&(this._smallestRate=Math.min(Math.floor(a/2),1500));this.started||(this.started=!0,setTimeout(this._binded_pool,0))};a.prototype._pool=function(){this.maxFrequent(function(){var a="";this.config&&this.config.name&&(a="["+this.config.name+"]");b.FINEST(a+
"Pooling in progress...")},5E3,this._lck_obj);this.callTimers();0!==this.timers.length?setTimeout(this._binded_pool,this._smallestRate>this._rate?this._smallestRate:this._rate):(this.started=!1,this._smallestRate=-1)};a.prototype.callTimers=function(){this.lastCalled=(new Date).valueOf();for(var a=0;a<this.timers.length;a++){var d=this.timers[a];if((new Date).valueOf()>=d.time){try{d.execute()}catch(g){b.ERROR("Error calling timer: "+g)}this.timers.splice(a,1);--a}}};a.prototype.cancellAll=function(){this.timers=
[];b.WARN("Cancelling all stack.")};a.prototype.setRate=function(a){this._rate=a};a.prototype.maxFrequent=function(a,b,d){d||(a.__maxFrequent__timer_opentag_qubit_=a.__maxFrequent__timer_opentag_qubit_||{},d=a.__maxFrequent__timer_opentag_qubit_);var h=d.____last__timed__max__frequent____;if(!h||(new Date).valueOf()-h>b)h=(new Date).valueOf(),d.____last__timed__max__frequent____=h,a()};a.prototype.runIfNotScheduled=function(a,b,d){if(d.__lastRun__&&(new Date).valueOf()<b+d.__lastRun__)return this.schedule(a,
b,d);d.__lastRun__=(new Date).valueOf();a();return!0};a.prototype.schedule=function(a,b,d){if(d.___scheduled___)return!1;d.___scheduled___=(new Date).valueOf();this.setTimeout(function(){d.___scheduled___=!1;d.__lastRun__=(new Date).valueOf();a()},b);return!0};var d=1;a.prototype.setTimeout=function(a,b){var g={id:d++,time:(new Date).valueOf()+ +b,execute:a};this.timers.push(g);this.startPooling(b);return g};a.prototype.setInterval=function(a,d){b.FINEST("Native wrapper");var g=setInterval(a,d);this.inervals.push(g);
return g}})();(function(){qubit.opentag.Utils.namespace("qubit.opentag.Timed",new qubit.opentag.Timer({rate:37,dynamic:!0}));var a=qubit.opentag.Timed;a.tillTrue=function(h,b,d){var c=function(){h()?b():a.setTimeout(c,d||33)};c()}})();var q;q=q||{};q.fileLoader={};q.fileLoader.load=function(a,h,b,d,c,f){var g,n,e,m;m=!1;e=function(e){return function(){m||(m=!0,e&&!n&&(n={url:document.location.href}),b(a,n,e))}};try{h&&(g=h(a))}catch(r){g=!1,b(a,"Exception loading pre",!0)}finally{!1!==g&&(h=q.fileLoader.createScriptEl(a,
c,!1,f),b&&(h.onload=e(!1),h.onerror=e(!0),h.onreadystatechange=function(){"complete"!==this.readyState&&"loaded"!==this.readyState||setTimeout(function(){e(!1)()},1)}),d||(d=window.document.getElementsByTagName("head")[0]),d.appendChild(h))}};q.fileLoader.createScriptEl=function(a,h,b,d){var c,f=document.createElement("script");f.type="text/javascript";f.src=q.fileLoader.tidyUrl(a)+(b?"?"+(new Date).getTime():"");!1!==h?(f.async="true",f.defer="true"):(f.async="false",!1!==f.async&&(f.async=!1),
f.defer="false");for(c in d)d.hasOwnProperty(c)&&f.setAttribute(c,d[c]);return f};q.fileLoader.tidyUrl=function(a){return"http:"===a.substring(0,5)||"https:"===a.substring(0,6)?a:"//"+a};(function(){function a(a){this.log=new qubit.opentag.Log("",function(){return this.CLASS_NAME+"["+this.config.name+"]"}.bind(this),"collectLogs");this.config={order:0,include:!0,name:"Filter-"+h++,script:void 0,session:void 0};this.session=null;if(a){for(var d in a)a.hasOwnProperty(d)&&(this.config[d]=a[d]);a.session&&
this.setSession(a.session)}}var h=0;qubit.opentag.Utils.clazz("qubit.opentag.filter.BaseFilter",a);a.state={DISABLED:-3,SESSION:-2,PASS:-1,FAIL:0};a.prototype.reset=function(){this.enable()};a.prototype.disable=function(){this.config.disabled=!0};a.prototype.enable=function(){this.config.disabled=!1};a.prototype.match=function(){return!0};a.prototype.setSession=function(a){this.session=a};a.prototype.getSession=function(){return this.session};a.prototype.getState=function(){var b=a.state.PASS;if(this.config.disabled)return a.state.DISABLED;
this.config.script&&(b=this.config.script.call(this,b));isNaN(+b)&&(this.log.WARN("filters should use a numerical state as a return for getState(): BaseFilter.state. Filter will fail. Returned: "+b),b=a.state.FAIL);this.lastState=+b;return b}})();(function(){function a(b){var d={customStarter:function(a,b,c){b(!1)},customScript:function(a){return!0}};if(b)for(var c in b)!b.hasOwnProperty(c)||"customStarter"===c&&!b[c]||"customScript"===c&&!b[c]||(d[c]=b[c]);a.superclass.call(this,d)}var h=qubit.opentag.filter.BaseFilter;
qubit.opentag.Utils.clazz("qubit.opentag.filter.SessionVariableFilter",a,h);a.prototype.match=function(){try{return!!this.config.customScript(this.getSession())}catch(a){return this.log.FINE("Filter match throws exception:"+a),!1}};a.prototype.runTag=function(a){!this._runTag&&this.config.customStarter&&(this._runTag=!0,this.config.customStarter(this.getSession(),function(d){this.lastRun=(new Date).valueOf();!0===d?a.run():a.runOnce()}.bind(this),a))};a.prototype.getState=function(b){b&&this.setSession(b);
b=a.superclass.prototype.getState.call(this);if(b===h.state.DISABLED)return h.state.DISABLED;b===h.state.PASS&&this.config.customStarter&&(b=h.state.SESSION);this.config.script&&(b=this.config.script.call(this,b,this.getSession()));return this.lastState=b};a.prototype.reset=function(){a.superclass.prototype.reset.call(this);this._runTag=void 0}})();q.GlobalEval={};q.GlobalEval.globalEval=function(a){window.execScript?window.execScript(a):window.eval.call(window,a)};q.HtmlInjector={};q.HtmlInjector.inject=
function(a,h,b,d,c){var f,g,n,e;if(0<=b.toLowerCase().indexOf("<script")){c=document.createElement("div");c.innerHTML="a"+b;g=c.getElementsByTagName("script");n=[];b=0;for(f=g.length;b<f;b+=1)n.push(g[b]);e=[];b=0;for(f=n.length;b<f;b+=1){g=n[b];var m={attributes:q.HtmlInjector.getAttributes(g)};g.src?m.src=g.src:m.script=g.innerHTML;e.push(m);g.parentNode.removeChild(g)}c.innerHTML&&0<c.innerHTML.length&&(c.innerHTML=c.innerHTML.substring(1));q.HtmlInjector.doInject(a,h,c);q.HtmlInjector.loadScripts(e,
0,d,a)}else c=document.createElement("div"),c.innerHTML=b,q.HtmlInjector.doInject(a,h,c),d&&d()};q.HtmlInjector.doInject=function(a,h,b){if(0<b.childNodes.length){for(var d=document.createDocumentFragment();0<b.childNodes.length;)d.appendChild(b.removeChild(b.childNodes[0]));h?q.HtmlInjector.injectAtStart(a,d):q.HtmlInjector.injectAtEnd(a,d)}};q.HtmlInjector.injectAtStart=function(a,h){0===a.childNodes.length?a.appendChild(h):a.insertBefore(h,a.childNodes[0])};q.HtmlInjector.injectAtEnd=function(a,
h,b){b||(b=1);a===document.body&&"complete"!==document.readyState&&50>b?setTimeout(function(){q.HtmlInjector.injectAtEnd(a,h,b+1)},100):a.appendChild(h)};q.HtmlInjector.loadScripts=function(a,h,b,d){var c,f,g=!1;for(c=a.length;h<c;h+=1)if(f=a[h],f.src){g=!0;break}else q.GlobalEval.globalEval(f.script);g&&q.fileLoader.load(f.src,null,function(){q.HtmlInjector.loadScripts(a,h+1,b,d)},d,!1,f.attributes);b&&h===c&&b()};q.HtmlInjector.getAttributes=function(a){var h,b,d,c,f={};if(a){b=a.attributes;h=b.length;
for(a=0;a<h;a++)d=b[a].value,c=b[a].name.toLowerCase(),""===d||"id"!==c&&"class"!==c&&"charset"!==c&&"data-"!==c.substr(0,5)||(f[c]=d);return f}};(function(){var a=qubit.opentag.Utils,h=new qubit.opentag.Log("TagsUtils -> "),b=qubit.opentag.filter.BaseFilter,d=q.HtmlInjector,c=q.fileLoader,f=qubit.opentag.filter.SessionVariableFilter,g=function(){};a.clazz("qubit.opentag.TagsUtils",g);var n=!1;g.bodyLoaded=function(){return n?!0:n=!(!document.body||"loading"===document.readyState)};var e={};g.loadScript=
function(a){var l=a.url,k=function(k,b,c){e[l].error=b;c?(h.ERROR("Loading process error:"),h.ERROR(b,!0),e[l].state="failure",a.onerror()):(e[l].state="success",a.onsuccess())};if(e[l]){if(a.noMultipleLoad)return h.FINE(l+" is already loaded, with state: "+e[l].state),k(l,e[l].error,"failure"===e[l].state);e[l].count+=1}else e[l]={count:1,state:null};var b=!a.async,d=g.bodyLoaded();b&&d&&h.WARN("Script configured for synchronous injection while document seems to be already loaded. Secure option applies. Script will be appended in standard way.");
b&&!d?(h.WARN("Adding script element by using document.write. IE will error check fail broken url's."),g.writeScriptURL(l,function(a,e){k(l,e,!a)})):c.load(l,!1,k,a.node,a.async)};var m=null;g.redirectDocumentWritesToArray=function(a,l){l&&l.FINE("redirecting document.write methods...");m=m||{write:document.write,writeln:document.writeln};document.write=function(e){a.push(e);l&&l.FINE("Received call from document.write with:"+e)};document.writeln=function(e){a.push(e);l&&l.FINE("Received call from document.writeln with:"+
e)}};g.flushDocWritesArray=function(a,l,e,k,b){if(l&&a){a=a.splice(0,a.length);try{return g.injectHTML(l,e,a.join("\n"),b||u),!0}catch(c){k.ERROR("Loading html caused exception:"+c)}}else return k&&k.ERROR("Flushing location not found!"),!1;b&&b();return!0};g.unlockDocumentWrites=function(){m&&(h&&h.FINEST("Bringing back document.write"),document.write=m.write,document.writeln=m.writeln,m=null)};var r=0;g.writeScriptURL=function(a,l){var e="_"+r++,k=g.prototype.PACKAGE_NAME+".TagsUtils.writeScriptURL.callbacks."+
e;g.writeScriptURL.callbacks[e]=function(k){k?l(!1,"error while loading script "+a):l(!0);g.writeScriptURL.callbacks[e]=void 0;delete g.writeScriptURL.callbacks[e]};var b='if(this.readyState === "loaded" || this.readyState === "complete"){ try {'+k+"(true)} catch (ex) {}}",d="try{"+k+"(false)}catch(ex){}",k="try{"+k+"(true)}catch(ex){}";a=c.tidyUrl(a);document.write("<script onload='"+d+"'  onerror='"+k+"' onreadystatechange='"+b+"' type='text/javascript'  src='"+a+"'>\x3c/script>")};g.writeScriptURL.callbacks=
{};var l=b.state.SESSION,p=b.state.PASS,k=b.state.FAIL;g.filtersState=function(a,e,c){a=a.sort(function(a,l){try{return l.config.order-a.config.order}catch(e){return 0}});var d=p;if(!a||0===a.length)return d;for(var d=null,g=!1,h=!1,m=0,r,n,q,u,x=0;x<a.length;x++)if(q=a[x],q.setSession(e),q.match())if(r=q.getState(),0<r){if(0===m||m>r)m=r}else r===b.state.DISABLED?(c.log.WARN("filter with name "+q.config.name+" is disabled"),g=!0):r===l?(h=!0,n=d=q):d=q;else u=q;a=!1;null===d?(a=!0,d=g?p:k):d=d.config.include?
r:r===p?k:p;0<m&&(d===p||a)&&(d=m);if(d===l||d===p&&h){if(!n.config.include)return k;d=l;if(n instanceof f)try{n.runTag(c)}catch(v){n.log.FINEST("trying custom starter failed:"+v)}}c.config.dedupe&&d===p&&u&&u instanceof f&&(c.sendDedupePing=!0,d=k);return d};g.injectHTML=function(a,l,e,k){return d.inject(a,l?0:1,e,k||u)};g.getHTMLLocationForTag=function(a){a=a.prepareLocationObject(a.config.locationObject);switch(a){case "HEAD":a=document.getElementsByTagName("head")[0];break;case "BODY":a=document.body;
break;default:a=a?document.getElementById(a):document.body}return a}})();(function(){function a(d){this.config={};this.log=new qubit.opentag.Log("",function(){return this.CLASS_NAME+"["+this.uniqueId+"]"}.bind(this),"collectLogs");this.parameters=null;if(d){this.uniqueId="BV"+b++;a.ALL_VARIABLES[this.uniqueId]=this;for(var c in d)this.config[c]=d[c];void 0!==d.value&&(this.value=d.value);void 0!==d.defaultValue&&(this.defaultValue=d.defaultValue);(d=a.register(this))&&d!==this&&(d.log.FINEST("Variable config already registered."),
d.log.FINEST("Returning existing one."));return d}}var h=qubit.opentag.Utils,b=0;h.clazz("qubit.opentag.pagevariable.BaseVariable",a);a.ALL_VARIABLES={};a.pageVariables=[];a.register=function(b){if(b instanceof a){for(var c=0;c<a.pageVariables.length;c++){var f=a.pageVariables[c],g;if(g=b.constructor===f.constructor)a:{g=f.config;var h=b.config,e=void 0;for(e in h){var m=h[e],r;for(r in g)if(g.hasOwnProperty(r)&&g[r]!==m){g=!1;break a}}g=!0}if(g)return f}a.pageVariables.push(b);return b}return null};
a.prototype.getValue=function(){return this.value};a.prototype.setValue=function(a){this.value=a};a.prototype.getDefaultValue=function(){return this.defaultValue};a.prototype.setDefaultValue=function(a){this.defaultValue=a};a.prototype.exists=function(a){var b=h.variableExists(this.getValue());a&&(b=b||h.variableExists(this.getDefaultValue()));return b};a.prototype.getRelativeValue=function(a,b){var f=this.getValue();h.variableExists(f)||(f=b);a&&!h.variableExists(f)&&(f=this.getDefaultValue());return f};
a.prototype.replaceToken=function(a,b,f,g){var n=this.exists();f=n?this.getValue():f;a="\\$\\{"+a+"\\}";return g||f instanceof Array?(g=n?this.getValueAccessorString():h.getAnonymousAcessor(f),b.replace(new RegExp(a,"g"),g)):b.replace(new RegExp(a,"g"),f)};a.prototype.getAccessorString=function(){return"qubit.opentag.pagevariable.BaseVariable.ALL_VARIABLES."+this.uniqueId};a.prototype.getValueAccessorString=function(){return this.getAccessorString()+".getValue()"}})();(function(){function a(b){this._lockExprObject=
{};a.superclass.apply(this,arguments)}var h=qubit.opentag.Utils,b=qubit.opentag.Timed;h.clazz("qubit.opentag.pagevariable.Expression",a,qubit.opentag.pagevariable.BaseVariable);a.prototype.getValue=function(){var d,c;try{if(-1===this.value.indexOf("[#]")){var f=h.gevalAndReturn(this.value);d=f.result;this.failMessage=null;c=f.error}else d=a.parseUVArray(this.value)}catch(g){c=g}c&&(c="could not read value of expression: \n"+this.value+"\nexact cause: "+c,this.failMessage!==c&&(this.failMessage=c),
d=null);b.maxFrequent(function(){this.failMessage&&this.log.FINEST(this.failMessage);this.log.FINEST("getting value from expression: "+d)}.bind(this),1E4,this._lockExprObject);return d};a.parseUVArray=function(a){var b=a.split("[#]");a=h.gevalAndReturn(b[0]).result;var f=[],b=b[1];0===b.indexOf(".")&&(b=b.replace(".",""));for(var g=0;g<a.length;g++){var n=h.getObjectUsingPath(b,a[g]);f.push(n)}return f};a.prototype.replaceToken=function(b,c,f,g){this.getValue()instanceof Array&&(g=!0);return a.superclass.prototype.replaceToken.call(this,
b,c,f,g)}})();(function(){function a(b){a.superclass.apply(this,arguments)}var h=qubit.opentag.Utils;h.clazz("qubit.opentag.pagevariable.DOMText",a,qubit.opentag.pagevariable.BaseVariable);a.prototype.getValue=function(){this.log.FINEST("reading DOM element contents value");return h.getElementValue(this.value)}})();(function(){function a(b){a.superclass.apply(this,arguments);this._lockObject={}}var h=qubit.opentag.Timed;qubit.opentag.Utils.clazz("qubit.opentag.pagevariable.Cookie",a,qubit.opentag.pagevariable.BaseVariable);
a.prototype.getValue=function(){var a=qubit.Cookie.get(this.value,!0);h.maxFrequent(function(){this.log.FINEST("reading cookie value: "+a)}.bind(this),2E3,this._lockObject);return a}})();(function(){function a(b){a.superclass.apply(this,arguments)}var h=qubit.opentag.Utils;h.clazz("qubit.opentag.pagevariable.URLQuery",a,qubit.opentag.pagevariable.BaseVariable);a.prototype.getValue=function(){return h.getQueryParam(this.value)}})();(function(){function a(){}function h(a,e){var b=[];try{var c=a.parameters;
if(c)for(var d=0;d<c.length;d++)c[d].variable===e&&b.push(c[d])}catch(g){}return b}var b=qubit.opentag.Utils,d=qubit.opentag.TagsUtils,c=qubit.opentag.Timed,f=qubit.opentag.pagevariable.BaseVariable,g=qubit.opentag.pagevariable.Expression,n=qubit.opentag.pagevariable.DOMText,e=qubit.opentag.pagevariable.Cookie,m=qubit.opentag.pagevariable.URLQuery;b.clazz("qubit.opentag.TagHelper",a);a.injectHTMLForLoader=function(a,e,b,c){var g=a.config;if(c=void 0!==c?c:g.html){var g="END"===g.locationPlaceHolder,
f=d.getHTMLLocationForTag(a);a.log.FINE("injecting html into page:");a.log.FINE(c);a.injectHTMLNotFinished=!0;try{f?d.injectHTML(f,g,c,function(){a.log.FINE("finished html injection.");a.injectHTMLNotFinished=!1;if(e)try{e()}catch(b){a.log.ERROR("error while trying to run callback after html injection: "+b)}}.bind(a)):b&&"loading"===document.readyState?(document.write(c),a.injectHTMLNotFinished=!1):(a.injectHTMLFailed=(new Date).valueOf(),a.log.ERROR("location was not found or/and html is told to not to write at runtime or document is already loaded. Please check tag's configuration. Injection cancelled."))}catch(h){a.injectHTMLNotFinished=
!1,a.injectHTMLFailed=(new Date).valueOf(),a.log.ERROR("error while trying to inject html: "+h)}}};a.getAllVariablesWithParameters=function(a){for(var e=a.getPageVariables(),b=[],c=0;c<e.length;c++)for(var d=e[c],g=h(a,d),f=0;f<g.length;f++)b.push({parameter:g[f],variable:d});return b};var r={};a.allParameterVariablesReadyForTag=function(a,e){for(var k=a.log,d=!0,g=a.getPageVariables(),f=0;f<g.length;f++){var m=g[f];try{var n=h(a,m),q=m.exists();!q&&e&&(0<n.length&&(q=b.variableExists(n[0].defaultValue)),
q=q||m.exists(!0));var u=m.config.name?m.config.name:"[unnamed]";c.maxFrequent(function(){k.FINEST("Variable '"+u+"' exists? "+q)},5E3,r);if(!q){d=!1;break}}catch(A){c.maxFrequent(function(){k.ERROR("Error checking variable existence ");k.ERROR([m,A])},5E3,r);d=!1;break}}d&&!r.alreadyNotified&&(r={alreadyNotified:!0});c.maxFrequent(function(){k.FINEST("Checking page variables, variables are ready: "+d);d?(r.clear=!0,k.FINE("Variables ready.")):k.FINE("Variables not ready, waiting...")},2E3,r);return d};
a.validateAndGetVariableForParameter=function(e){return e.hasOwnProperty("variable")&&e.variable?e.variable=a.initPageVariable(e.variable):e.uv?e.variable=new g({name:e.uv,value:e.uv}):e.variable=a.initPageVariable({value:void 0,empty:!0})};a.initPageVariable=function(a){if(!a||a instanceof f)return a;switch(a.type){case "2":return new g(a);case "3":return new m(a);case "4":return new e(a);case "5":return new n(a);case "EPRESSION":return new g(a);case "URL_PARAMETER":return new m(a);case "COOKIE_VALUE":return new e(a);
case "DOM_VALUE":return new n(a);default:return new f(a)}}})();(function(){function a(a){this.log=new n("",function(){return this.CLASS_NAME+"["+this.config.name+"]"}.bind(this),"collectLogs");this.urlsFailed=this.urlsLoaded=0;this.config={name:"Tag-"+g++,async:!0,usesDocumentWrite:!1,timeout:this.LOADING_TIMEOUT,dependencies:[],url:null,urlLocation:null,locationPlaceHolder:"END",locationObject:null,dontWaitForBody:!1,noMultipleLoad:!1,loadDependenciesOnLoad:!1};this.delayDocWrite=!1;this.dependencies=
[];this._lockObject={count:0};this._lockObjectDepsLoaded={};this.genericDependencies=this.genericDependencies||[];if(a){this.log.FINE("instance...");if(!a.name){var b="Tag-"+g++;this.config.name=b;this.log.WARN("Name was not specified for tag. Assigning auto: "+b)}this.addState("INITIAL");for(var c in a)this.config[c]=a[c];a.genericDependencies&&(this.genericDependencies=this.genericDependencies.concat(a.genericDependencies));a.dependencies&&(this.dependencies=a.dependencies.concat(this.dependencies));
a.PACKAGE&&(this._package=a.PACKAGE);this.onInit()}}function h(){if(this.cancelled)this._handleCancel();else if(this.waitForDependenciesFinished=(new Date).valueOf(),this.dependenciesLoaded()?this._markLoadedSuccesfuly():this._loadingOutOfTimeFrames()?(this.loadingTimedOut=(new Date).valueOf(),this.dependenciesLoaded(!0)?this._markLoadedSuccesfuly():(this.log.WARN("timed out while loading dependencies."),this.addState("TIMED_OUT"),this.loadingDependenciesFailed=(new Date).valueOf(),this._triggerOnLoadTimeout())):
(this.waitForDependenciesFinished=!1,this._setTimeout(h.bind(this),75)),this.waitForDependenciesFinished)this.addState("LOADED_DEPENDENCIES");else{var a=((new Date).valueOf()-this.loadStarted)/this.getTimeout(),b=Math.ceil(this.getTimeout()/4E3);this._lockObject.curr=a;c.maxFrequent(function(){this.log.FINE("Waiting for dependencies, counting... "+this._lockObject.count++ +" ("+b+")")}.bind(this),4E3,this._lockObject)}}var b=qubit.opentag.Utils,d=qubit.opentag.TagsUtils,c=qubit.opentag.Timed,f=qubit.opentag.TagHelper,
g=0,n=qubit.opentag.Log;b.clazz("qubit.opentag.GenericLoader",a);a.prototype.onInit=u;a.prototype.LOADING_TIMEOUT=5E3;a.prototype._executeScript=function(){if(this.config&&this.config.script)if("function"===typeof this.config.script)this.script=this.config.script;else{var a=this.replaceTokensWithValues(String(this.config.script));this.script=b.expressionToFunction(a).bind(this)}this.log.INFO("executing main script...");a=!1;try{this.script(),a=!0,this.log.INFO("executed without errors.")}catch(c){this.addState("EXECUTED_WITH_ERRORS"),
this.log.ERROR("Error while executing: "+c),this.log.ERROR("There was an error while executing instance of tag: "+this.CLASS_NAME+" from package: "+this.PACKAGE_NAME),this.log.ERROR(c,!0),this._onError(c)}finally{this.onExecute(a)}};a.prototype.getTimeout=function(){return this._getTimeout()};a.prototype._getTimeout=function(a){var c=+this.config.timeout;if(-1!==c&&0<this.dependencies.length){var d=0;a=a||[];var l=this.dependencies;if(-1===b.indexInArray(a,this)){a[a.length]=this;for(var g=0;g<l.length;g++){var k=
l[g]._getTimeout(a);k>d&&(d=k)}0<d&&(c+=d)}else return 0}return c};a.prototype.onExecute=u;a.prototype._flushDocWrites=function(a){var b=!0;this._docWriteNotFlushed=!1;try{var c=d.getHTMLLocationForTag(this);c&&this._securedWrites&&0<this._securedWrites.length&&(this.log.FINE("flushing document.write proxy array"),this.log.FINE("flushing: "+this._securedWrites.join("\n")),(b=d.flushDocWritesArray(this._securedWrites,c,"END"===this.config.locationPlaceHolder,this.log,a))?this._docWriteFlushed=(new Date).valueOf():
this._docWriteNotFlushed=(new Date).valueOf())}catch(l){this.log.ERROR("Unexpected exception during flushing! "+l),this._onError(l)}a&&a();this._securedWrites&&0<this._securedWrites.length&&(b=!1,this._docWriteNotFlushed=(new Date).valueOf());return b};a.prototype.log=u;a.prototype.finished=function(){return!!this.runIsFinished};a.prototype.script=function(){this.log.INFO("Script run.")};a.prototype.before=function(){this.log.FINE("running before handler...");this.beforeRun=(new Date).valueOf();try{this.onBefore()}catch(a){this.log.ERROR("onBefore error: "+
a),this._onError(a)}};a.prototype.onBefore=u;a.prototype.after=function(a){this.log.FINE("running after handler...");this.afterRun=(new Date).valueOf();try{this.onAfter(a)}catch(b){this.log.ERROR("onAfter error: "+b),this._onError(b)}};a.prototype.onAfter=function(a){};a.prototype.runOnce=function(a){this._runOnceTriggered||this.scriptExecuted?this.log.FINEST("runOnce has been already executed."):(this._runOnceTriggered=(new Date).valueOf(),this.run(a))};a.CANCELL_ALL=!1;a.prototype.runCounter=0;
a.prototype.run=function(b){if(this.cancelled||a.CANCELL_ALL)return this._handleCancel(),!1;if(this.isRunning)return this.log.FINE("loader is currently in progress, try again later."),!1;this.lastRun&&(this.log.FINE("Running again. Run count: "+(this.runCounter+1)),this.reset());this.lastRun=this.isRunning=(new Date).valueOf();this.runCounter++;this.load(b);b?this.execute():this.waitForDependenciesAndExecute();return!0};a.prototype._setTimeout=function(a,b){this._wasTimed=(new Date).valueOf();return c.setTimeout(a,
b)};a.prototype._handleCancel=function(){this.addState("CANCELLED");this.log.INFO("loader is cancelled.");try{this.onCancel()}catch(a){this.log.ERROR("Exception at onCancel"+a),this._onError(a)}};a.prototype.waitForDependenciesAndExecute=function(){this.cancelled?this._handleCancel():this.loadedDependencies?this.execute():this.loadingDependenciesFailed?(this.log.INFO("script execution failed before running: dependencies failed to load."),this._markFailure(),this._markFinished()):this._setTimeout(this.waitForDependenciesAndExecute.bind(this),
30)};a.prototype.execute=function(){this.log.FINE("entering execute...");this._triggerExecution()};a.prototype._triggerExecution=function(){if(this.cancelled)this._handleCancel();else if(!this.scriptExecuted){var a=!0;if(this.shouldWaitForDocWriteProtection())a=!1;else{if(!this._beforeEntered){this._beforeEntered=(new Date).valueOf();a=!1;try{a=this.before()}catch(b){this.log.ERROR("`before` thrown an exception"),this.log.ERROR(b,!0),this._onError(b)}if(a){this.log.INFO("before calback cancelled execution.");
this._markFailure();this._markFinished();return}}a=this.loadExecutionURLsAndHTML(this._triggerExecution.bind(this))}if(!this.scriptExecuted)if(this.unexpectedFail&&(a=!0),a){this._flushDocWrites();this.scriptLoadingFailed||this.injectHTMLFailed||this.unexpectedFail?this._markFailure():(this.log.FINE("Executing..."),this.scriptExecuted=(new Date).valueOf(),this.addState("EXECUTED"),this._executeScript());if(this.cancelled)return this._handleCancel(),!1;this.afterRun||(this.afterRun=(new Date).valueOf(),
this.after(0<this.scriptExecuted));this._flushDocWrites();this._markFinished();this.log.INFO("* stopped ["+(0<this.scriptExecuted?"executed":"not executed")+"] *")}else this._setTimeout(this._triggerExecution.bind(this),30)}};a.prototype._markFailure=function(){this.log.INFO("Script execution failed.");this.scriptExecuted=-(new Date).valueOf();this.addState("FAILED_TO_EXECUTE")};a.prototype._markFinished=function(){this.runIsFinished=(new Date).valueOf();this.isRunning=!1;a.LOCK_DOC_WRITE===this&&
(this._flushDocWrites(),d.unlockDocumentWrites(),a.LOCK_DOC_WRITE=!1);this.onFinished(!0)};a.prototype.onFinished=u;a.prototype.onFinished=u;a.prototype.shouldWaitForDocWriteProtection=function(){if(this.willSecureDocumentWrite())if(!a.LOCK_DOC_WRITE)a.LOCK_DOC_WRITE=this,this._secureWriteAndCollectForExecution();else if(a.LOCK_DOC_WRITE!==this)return this._lockedDocWriteInformed||(this._lockedDocWriteInformed=(new Date).valueOf(),this.log.WARN("Tag will wait till document.write be available."),this.log.FINE(a.LOCK_DOC_WRITE,
!0)),!0;return!1};a.prototype.runWithoutDependencies=function(){this.run(!0)};a.prototype.loadExecutionURLsAndHTML=function(a){if(this.cancelled)return this._handleCancel(),!0;this._loadExecutionURLsAndHTMLInformed||(this._loadExecutionURLsAndHTMLInformed=!0,this.log.INFO("tag is loaded, trying execution..."));this._triggerURLsLoading(a);return this.loadURLsNotFinished||(this._flushDocWrites(),this._triggerHTMLInjection(),this._flushDocWrites(),this.injectHTMLNotFinished||(this._flushDocWrites(),
this.log.INFO("url and html awaiting has ended..."),this._docWriteNotFlushed))?!1:(this._docWriteFlushed&&this.log.INFO("flushed document.write..."),!0)};a.prototype._triggerURLsLoading=function(a){!this._urlLoadTriggered&&this.config.url&&(this._urlLoadTriggered=!0,this.log.INFO("tag has url option set to: "+this.config.url),this.log.INFO("loading url and delaying execution till link is loaded"),this.loadURLs(!1,a))};a.prototype._triggerHTMLInjection=function(){!this._injectHTMLTriggered&&this.config.html&&
(this._injectHTMLTriggered=!0,this.log.FINE("tag has html option set to: "+this.config.html),this.log.INFO("injecting html and delaying execution till is ready"),this.injectHTML())};a.prototype.STATE={INITIAL:0,STARTED:1,CANCELLED:2,LOADING_DEPENDENCIES:4,LOADED_DEPENDENCIES:8,LOADING_URL:16,LOADED_URL:32,EXECUTED:64,EXECUTED_WITH_ERRORS:128,FAILED_TO_LOAD_DEPENDENCIES:256,FAILED_TO_LOAD_URL:512,FAILED_TO_EXECUTE:1024,TIMED_OUT:2048,UNEXPECTED_FAIL:4096};a.prototype.addState=function(a){if(this.STATE.hasOwnProperty(a)){this.state|=
this.STATE[a];try{this.onStateChange(a)}catch(b){this.log.ERROR(b),this._onError(b)}}};a.prototype.onStateChange=u;a.prototype.cancel=function(){this.cancelled=(new Date).valueOf()};a.prototype.state=a.prototype.STATE.INITIAL;a.prototype._markLoadedSuccesfuly=function(){this.loadedDependencies=(new Date).valueOf();this.onDependenciesLoaded()};a.prototype._secureWriteAndCollectForExecution=function(){this._securedWrites||(this._securedWrites=[],d.redirectDocumentWritesToArray(this._securedWrites,this.log))};
a.prototype.dependenciesLoaded=function(a,b){return 0===this.getDependenciesToBeLoaded(a,b).length};a.prototype.getDependenciesToBeLoaded=function(a,b){var d=b||[];this.injectionLocationReady()||d.push("html injection location");for(var l=0;l<this.dependencies.length;l++)if(this.dependencies[l]!==this){var g=this.dependencies[l].scriptExecuted;(!g||0>=+g)&&d.push("dependant Tag with name -> "+(this.dependencies[l].config?this.dependencies[l].config.name:"anonymous"))}for(l=0;l<this.genericDependencies.length;l++)this.genericDependencies[l](this)||
d.push("this.genericDependencies["+l+"] (index: "+l+")");""!==d&&c.maxFrequent(function(){var a=d.join(", ");a?this.log.FINE("Dependencies check: Waiting for: "+a):this.log.FINE("Dependencies check: No basic dependencies.")}.bind(this),5E3,this._lockObjectDepsLoaded);return d};a.prototype.docWriteAsksToWaitForBody=function(){return!(!this.config.delayDocWrite||!this.config.usesDocumentWrite)};a.prototype.injectionLocationReady=function(){return this.docWriteAsksToWaitForBody()&&!b.bodyReady()?!1:
this.config.dontWaitForBody||!this.isLoadingAsynchronously()?!0:!!d.getHTMLLocationForTag(this)};a.prototype._loadingOutOfTimeFrames=function(){return 0>this.getTimeout()?!1:(new Date).valueOf()-this.loadStarted>this.getTimeout()};a.prototype.loadDependencies=function(){this._loadDependencies()};a.prototype._loadDependencies=function(a){a=a||[];var c=this.dependencies;if(-1===b.indexInArray(a,this)){a[a.length]=this;for(var d=0;d<c.length;d++)c[d].load(a)}};a.prototype.onError=u;a.prototype._onError=
function(a){try{this.onError(a)}catch(b){}};a.prototype._triggerOnLoadTimeout=function(){this.onLoadTimeout()};a.prototype.onLoadTimeout=u;a.prototype.onScriptsLoadSuccess=u;a.prototype.onScriptLoadError=u;a.prototype.onDependenciesLoaded=u;a.prototype.onBeforeLoad=u;a.prototype.load=function(a){if(!this.loadStarted){this.loadStarted=(new Date).valueOf();try{this.onBeforeLoad()}catch(b){this.log.ERROR("onBeforeLoad error: "+b),this._onError(b)}this.addState("LOADING_DEPENDENCIES");this.log.INFO("Load started.");
try{!a&&this.config.loadDependenciesOnLoad&&this.loadDependencies()}catch(c){throw this.log.ERROR("loadDependencies: unexpected exception occured: \n"+c+"\ntrying to finish... "),c;}h.call(this)}};a.prototype._singleUrlLoadHandler=function(a,b,c){++this.urlsLoaded;a||++this.urlsFailed;if(this.urlsLoaded===b.length)if(this.loadURLsNotFinished=!1,a&&0===this.urlsFailed){this.log.INFO("succesfully loaded "+this.urlsLoaded+" urls.");this.addState("LOADED_URL");this.urlsLoaded=(new Date).valueOf();try{c&&
c(!0)}catch(l){this.log.ERROR("Callback error:"+l),this._onError(l)}finally{this.onScriptsLoadSuccess()}}else{a="error loading urls. Failed "+this.urlsFailed;this.log.ERROR(a);this._onError(a);this.addState("FAILED_TO_LOAD_URL");this.urlsLoaded=-(new Date).valueOf();try{this.scriptLoadingFailed=!0,c&&c(!1)}catch(d){this.log.ERROR("Callback error:"+d),this._onError(d)}finally{this.onScriptLoadError(a)}}};a.prototype.loadURLs=function(a,b){var c=a||this.config.url;this.addState("LOADING_URL");this.log.FINE("loading URL(s) ...");
try{!c||c instanceof Array||(c=[c]);for(var l=0;l<c.length;l++){this.loadURLsNotFinished=!0;this.log.FINE("loading URL: "+c[l]+" ...");var d=c[l],d=this.prepareURL(d);this.loadURL(d,function(a){this._singleUrlLoadHandler(a,c,b)}.bind(this))}}catch(k){this.log.ERROR("loadURLs thrown unexpected exception! : "+k),this.loadURLsNotFinished=!1,this.addState("UNEXPECTED_FAIL"),this.unexpectedFail=(new Date).valueOf(),this._onError(k)}};a.prototype.prepareLocationObject=function(a){return a};a.prototype.prepareURL=
function(a){return a};a.prototype.prepareHTML=function(a){return a};a.prototype.loadURL=function(a,b){this.addState("LOADING_URL");d.loadScript({onsuccess:function(){this.log.FINE("succesfully loaded "+a);try{b&&b(!0)}catch(c){this.log.ERROR("error at callback for "+a+":"+c)}}.bind(this),onerror:function(){this.log.ERROR("error loading "+a);try{b&&b(!1)}catch(c){this.log.ERROR("error at callback for error at "+a+":"+c)}}.bind(this),url:a,node:this.config.urlLocation||document.body,async:this.isLoadingAsynchronously(),
noMultipleLoad:this.config.noMultipleLoad})};a.prototype.reset=function(){this.log.FINE("resetting.");this._securedWrites=this.delayDocWrite=this.scriptLoadingFailed=this.scriptExecuted=this.runIsFinished=this.loadingTimedOut=this.loadingDependenciesFailed=this.loadedDependencies=this.loadURLsNotFinished=this.loadStarted=this.injectHTMLFailed=this.filtersRunTriggered=this.beforeRun=this.afterRun=this._urlLoadTriggered=this._runOnceTriggered=this._lockedDocWriteInformed=this._loadExecutionURLsAndHTMLInformed=
this._injectHTMLTriggered=void 0;this.state=0;this.unexpectedFail=void 0;this.urlsLoaded=this.urlsFailed=0;this._beforeEntered=this.cancelled=this._lastRun=this.isRunning=this.waitForDependenciesFinished=void 0;this.addState("INITIAL")};a.prototype.isLoadingAsynchronously=function(){return this._wasTimed?!0:!(!this.config.async&&!this.forceAsynchronous)};a.prototype.willSecureDocumentWrite=function(){return this.config.usesDocumentWrite&&this.isLoadingAsynchronously()};a.prototype.injectHTML=function(a){var b=
!this.docWriteAsksToWaitForBody(),c=this.prepareHTML(this.config.html);c&&f.injectHTMLForLoader(this,a,b,c)};a.prototype.clone=function(){return new a(this.config)}})();(function(){function a(c){b.setIfUnset(c,{filterTimeout:c&&c.filterTimeout||this.FILTER_WAIT_TIMEOUT,PACKAGE:c&&c.PACKAGE,dedupe:!1,needsConsent:!1,inactive:!1,variables:null,runner:null});a.superclass.apply(this,arguments);this.namedVariables={};this.parameters=[];this.filters=[];this.session=null;if(c){this.addState("INITIAL");try{a.register(this)}catch(d){this.log.WARN("Problem with registering tag "+
this.config.name),this.log.WARN(d,!0)}if(c.filters)for(var k=0;k<c.filters.length;k++)this.addFilter(c.filters[k]);c.parameters&&(this.parameters=this.parameters.concat(c.parameters));if(c.variables)for(var e in c.variables)if(c.variables.hasOwnProperty(e)&&(k=this.getParameterByTokenName(e))){var g=c.variables[e];k.variable=g;void 0!==g.defaultValue&&(k.defaultValue=g.defaultValue);void 0!==g.uv&&(k.uv=g.uv)}this.log.FINEST("Initializing variables.");this.initPageVariablesForParameters();this.onTagInit()}}
function h(a,b){var c=g.initPageVariable(a.namedVariables[b]);return a.namedVariables[b]=c}var b=qubit.opentag.Utils,d=qubit.opentag.TagsUtils,c=qubit.opentag.filter.BaseFilter,f=qubit.opentag.GenericLoader,g=qubit.opentag.TagHelper,n=new qubit.opentag.Log("BaseTag -> ");b.clazz("qubit.opentag.BaseTag",a,f);a.prototype.valueForToken=function(a,b){var c=this.getParameterByTokenName(a);if(c)return void 0===b&&this.loadingTimedOut&&(b=!0),this.getParameterValue(c,b);if(this.namedVariables&&this.namedVariables[a]&&
(c=h(this,a)))return c.getRelativeValue(b)};a.prototype.LOADING_TIMEOUT=5E3;a.prototype.FILTER_WAIT_TIMEOUT=-1;a.prototype.run=function(a){if(this.config&&this.config.runner){a=!1;try{this.log.INFO("Running custom runner..."),this.addState("AWAITING_CALLBACK"),a=this._runner=(new Date).valueOf(),this.config.runner.call(this)}catch(b){this.log.ERROR("Error while running custom runner: "+b)}return a}this._runner=!1;return this.start(a)};a.prototype.start=function(b){return a.superclass.prototype.run.call(this,
b)};a.prototype.startOnce=function(b){return a.superclass.prototype.runOnce.call(this,b)};a.prototype.getFilters=function(){return this.filters};a.prototype.runOnceIfFiltersPass=function(){this._runOnceIfFiltersPassTriggered||this.scriptExecuted||(this._runOnceIfFiltersPassTriggered=(new Date).valueOf(),this.runIfFiltersPass())};a.prototype.runIfFiltersPass=function(){var a=this.filtersState();this.addState("FILTER_ACTIVE");this.filtersRunTriggered||(this.filtersRunTriggered=(new Date).valueOf());
if(a===c.state.SESSION)this.addState("AWAITING_CALLBACK"),this.log.FINE("tag is in session and will be manually triggered by custom starter"),this.awaitingCallback=(new Date).valueOf();else if(a===c.state.PASS){this.filtersPassed=(new Date).valueOf();this.log.FINE("tag passed filters tests");try{this.onFiltersPassed()}catch(b){this.log.ERROR("error running onFiltersDelayed:"+b)}this.run()}else if(a===c.state.FAIL)this.log.FINE("tag failed to pass filters"),this._markFiltersFailed(),this._markFinished();
else if(0<a){var k=this.config.filterTimeout;if(0>k||(new Date).valueOf()-this.filtersRunTriggered>k){if(!this._awaitingForFilterInformed){this.log.INFO("filters found indicating for tag to wait for applicable conditions - waiting...");this._awaitingForFilterInformed=(new Date).valueOf();try{this.onFiltersDelayed()}catch(d){this.log.ERROR("error running onFiltersDelayed:"+d)}}this._setTimeout(this.runIfFiltersPass.bind(this),a)}else this._markFiltersFailed(),this._markFinished(),this.filtersRunTimedOut=
(new Date).valueOf(),this.log.WARN("awaiting for filters timed out.")}try{this.onFiltersCheck(a)}catch(e){this.log.ERROR(e)}return a};a.prototype._markFiltersFailed=function(){this.addState("FILTERS_FAILED");this.filtersPassed=-(new Date).valueOf()};a.prototype.STATE={INITIAL:0,FILTER_ACTIVE:1,AWAITING_CALLBACK:2,FILTERS_FAILED:4,STARTED:8,CANCELLED:16,LOADING_DEPENDENCIES:32,LOADED_DEPENDENCIES:64,LOADING_URL:128,LOADED_URL:256,EXECUTED:512,EXECUTED_WITH_ERRORS:1024,FAILED_TO_LOAD_DEPENDENCIES:2048,
FAILED_TO_LOAD_URL:4096,FAILED_TO_EXECUTE:8192,TIMED_OUT:16384,UNEXPECTED_FAIL:32768};a.prototype.addState=function(b){a.superclass.prototype.addState.call(this,b);try{a.onStateChange(this)}catch(c){this.log.ERROR(c)}this.stateStack=[];b=this.STATE;var k=this.state,d=this.stateStack;k&b.INITIAL&&d.push("Initial state.");k&b.FILTER_ACTIVE&&d.push("Tag running with filters pass triggered.");k&b.FILTERS_FAILED&&d.push("Filters failed to pass.");k&b.AWAITING_CALLBACK&&d.push("Awaiting callback to run this tag. Not pooling.");
k&b.STARTED&&d.push("Tag is initialized and loading has been started.");k&b.LOADING_DEPENDENCIES&&d.push("Dependencies are being loaded.");k&b.LOADED_DEPENDENCIES&&d.push("Dependencies loading process has been finished.");k&b.LOADING_URL&&d.push("External URL is being loaded.");k&b.LOADED_URL&&d.push("External URL has been loaded.");k&b.EXECUTED&&d.push("Main script has been executed.");k&b.EXECUTED_WITH_ERRORS&&d.push("Main script has been executed but errors occured.");k&b.FAILED_TO_LOAD_DEPENDENCIES&&
d.push("Dependencies has failed to load.");k&b.FAILED_TO_LOAD_URL&&d.push("URL location failed to load.");k&b.FAILED_TO_EXECUTE&&d.push("Script failed to execute.");k&b.TIMED_OUT&&d.push("Script timed out awaiting for dependencies.");k&b.UNEXPECTED_FAIL&&d.push("Script occured UNEXPECTED exception and is failed.");k&b.CANCELLED&&d.push("Tag has been cancelled.")};a.prototype.onTagInit=u;a.onStateChange=u;a.prototype.onFiltersDelayed=u;a.prototype.onFiltersPassed=u;a.prototype.onFiltersCheck=u;a.prototype.state=
a.prototype.STATE.INITIAL;a.prototype.arePageVariablesLoaded=function(a){return g.allParameterVariablesReadyForTag(this,a)};a.prototype.getDependenciesToBeLoaded=function(b,c){var d=c||[];this.arePageVariablesLoaded(b)||d.push("page variables");return a.superclass.prototype.getDependenciesToBeLoaded.call(this,b,d)};a.prototype.prepareURL=function(a){return this.replaceTokensWithValues(a)};a.prototype.prepareLocationObject=function(a){return this.replaceTokensWithValues(a)};a.prototype.prepareHTML=
function(a){a&&(a=this.replaceTokensWithValues(a));return a};a.prototype.replaceTokensWithValues=function(a){if(!a||-1===a.indexOf("${"))return a;var b=this.parameters;if(b)for(var c=0;c<b.length;c++){var d=this.getVariableForParameter(b[c]);if(d){var e=b[c].token,g=this.valueForToken(e);a=d.replaceToken(e,a,g)}}return a};a.prototype.getParameter=function(a){var b=this.parameters,c=null;if(b)for(var d=0;d<b.length;d++)b[d].name===a&&(c=b[d]);return c};a.prototype.setParameterValueByTokenName=function(a,
b){var c=this.getParameterByTokenName(a);return null!==c?(c.variable={value:b},!0):!1};a.prototype.getParameterValue=function(a,c){var d="string"===typeof a?this.getParameter(a):a;if(d){var e=this.getVariableForParameter(d);if(e)try{var g;c&&(g=b.gevalAndReturn(d.defaultValue).result);return g=e.getRelativeValue(c,g)}catch(f){this.log.ERROR("error while trying to resolve variable value:"+f),this.log.ERROR("Variable defaults string is invalid: "+d.defaultValue)}}};a.prototype.filtersState=function(){return d.filtersState(this.filters,
this.session,this)};a.prototype.addFilter=function(a){this.session&&a.setSession(this.session);this.filters.push(a)};a.prototype.reset=function(){a.superclass.prototype.reset.call(this);this.resetFilters();this._runner=this.filtersRunTriggered=this._runOnceIfFiltersPassTriggered=this.pingSent=this.dedupePingSent=this.filtersPassed=void 0};a.prototype.resetFilters=function(){for(var a=0;a<this.filters.length;a++)this.filters[a].reset()};a.prototype.getParameterByTokenName=function(a){var b=null;if(this.parameters)for(var c=
this.parameters,d=0;d<c.length;d++)c[d].token===a&&(b=c[d]);return b};a.prototype.removeFilter=function(a){b.removeFromArray(this.filters,a)};var e=0,m=[],r={};a.register=function(a){n.FINEST('registering tag named "'+a.config.name+'", instance of:');n.FINEST(a,!0);var c=b.addToArrayIfNotExist(m,a);-1!==c&&n.FINE("tag already exists in tags registry.");a._tagIndex=-1===c?m.length-1:c};a.prototype.unregister=function(b){a.unregister(b||this)};a.unregister=function(a){n.FINEST('Un-registering tag named "'+
a.config.name+'", instance of:');n.FINEST(a,!0);var c=b.removeFromArray(m,a);c&&0!==c.length||n.FINEST("tag "+a.config.name+" is already unregisterd.");a._tagIndex=-1};a.getTags=function(){return m};a.getAccessorsMap=function(){return r};a.prototype.getTags=function(){return m};a.prototype.initPageVariablesForParameters=function(){var a=this.parameters;if(a)for(var b=0;b<a.length;b++)a[b].variable=g.validateAndGetVariableForParameter(a[b]);if(this.namedVariables)for(var c in this.namedVariables)this.namedVariables.hasOwnProperty(c)&&
(this.namedVariables[c]=g.initPageVariable(this.namedVariables[c]))};a.prototype.getPageVariables=function(){var a=this.parameters,c=[];if(a)for(var d=0;d<a.length;d++){var e=this.getVariableForParameter(a[d]);null!==e&&b.addToArrayIfNotExist(c,e)}if(this.namedVariables)for(var g in this.namedVariables)b.addToArrayIfNotExist(c,h(this,g));return c};a.prototype.getAccessorString=function(){this._accessorsMapKey||(this._accessorsMapKey="_"+e++,r[this._accessorsMapKey]=this);return"qubit.opentag.BaseTag.getAccessorsMap()."+
this._accessorsMapKey};a.prototype.getVariableForParameter=function(a){var b=g.validateAndGetVariableForParameter(a);(!b||b.config.empty)&&this.namedVariables&&this.namedVariables[a.token]&&(b=h(this,a.token));return b};a.prototype.checkVariablesState=function(){var a=[];this.log.FINE("Tag has been timed out, showing variables:");for(var b=g.getAllVariablesWithParameters(this),c=0;c<b.length;c++){var d=b[c].parameter,e=b[c].variable,f;f=d&&d.token?this.valueForToken(d.token):e.getRelativeValue(!0);
e={name:e.config.name,exists:e.exists(),token:d?d.token:null,value:f,variable:e};a.push(e);this.log.FINE(" Variable Name: "+e.name+", Exists: "+e.exists+", Token: "+(d?d.token:"<param is not assigned>")+", Value:"+f)}return a};a.prototype._triggerOnLoadTimeout=function(){this.checkVariablesState();this.onLoadTimeout()}})();(function(){var a=qubit.opentag.Utils,h=new qubit.opentag.Log("Tags -> "),b=function(){};a.clazz("qubit.opentag.Tags",b);b.getAllTagsByState=function(){return qubit.opentag.Container.getAllTagsByState(b.getTags())};
b.findTagByName=function(a){for(var b=this.getTags(),f=[],g=0;g<b.length;g++)b[g].config.name===a&&f.push(b[g]);return f};b.findTagByMatch=function(a){for(var b=this.getTags(),f=[],g=0;g<b.length;g++)b[g].config.name.match(a)&&f.push(b[g]);return f};b.getTags=function(){h.FINEST("getTags");return qubit.opentag.BaseTag.getTags()};b.resetAllTags=function(){h.WARN("reseting all tags!");for(var a=b.getTags(),c=0;c<a.length;c++)a[c].reset()};b.getContainersPageVariables=function(){for(var a=b.getContainers(),
c=[],f=0;f<a.length;f++)c=c.concat(a.getPageVariables());return c};b.getAllPageVariables=function(){for(var a=b.getTags(),c=[],f=0;f<a.length;f++)c=c.concat(a[f].getPageVariables());return c};b.cancelAll=function(){for(var a=b.getTags(),c=0;c<a.length;c++)a[c].cancel()};b.resetAll=function(){for(var a=b.getTags(),c=0;c<a.length;c++)a[c].reset()};b.getPageVariableByName=function(a){for(var c=b.getAllPageVariables(),f=[],g=0;g<c.length;g++)c[g].config.name===a&&f.push(c[g]);return f};b.getLoadTime=
function(a){var b=a.beforeRun,f=a.runIsFinished;return isNaN(f)?{tag:a,loadTime:null}:{tag:a,loadTime:f-b}};b.getLoadTimes=function(a){var c=[];if(a instanceof qubit.opentag.BaseTag)return c.push([b.getLoadTime(a[f])]),c;a=a||b.getTags();if(a instanceof Array)for(f=0;f<a.length;f++)a[f]instanceof qubit.opentag.BaseTag&&c.push(b.getLoadTime(a[f]));else for(var f in a)a[f]instanceof qubit.opentag.BaseTag&&c.push(b.getLoadTime(a[f]));return c};b.getContainers=function(){return qubit.opentag.Container.getContainers()};
h.INFO("*** Qubit TagSDK *** ",!0,"font-size: 22px; color:#CCC;text-shadow:#fff 0px 1px 0, #555 0 -1px 0;")})();y={};v=void 0;y.update=function(){var a,h;h=function(){return Math.floor(1+65536*Math.random()).toString(36).substring(1)};window.__pageViewId__||(a=(new Date).getTime().toString(36),window.__pageViewId__=a+h()+h()+h());return window.__pageViewId__};q.PostData=function(a,h,b){var d,c,f,g,n,e,m;m=2;n=!1;e=function(){0<m&&setTimeout(function(){n||(m-=1,d())},5E3)};c=navigator.userAgent.toLowerCase();
f=-1!==c.indexOf("msie");c.indexOf("msie 9");c=-1!==c.indexOf("msie 7")||-1!==c.indexOf("msie 6");g=("https:"===document.location.protocol?"https:":"http:")+a;b=b||"POST";d=function(){var a;try{a=null;try{a=new XMLHttpRequest}catch(c){}a&&!f?a.open(b,g,!0):"undefined"!==typeof XDomainRequest?(a=new XDomainRequest,a.open(b,g)):a=null;try{a.withCredentials=!1}catch(d){}a.setRequestHeader&&a.setRequestHeader("Content-Type","text/plain;charset=UTF-8");a.onload=function(){n=!0};a.onreadystatechange=function(){};
a.ontimeout=function(){};a.onerror=function(){};a.onprogress=function(){};a.send(h)}catch(k){try{try{q.fileLoader.load(g)}catch(s){window.console&&window.console.log&&window.console.log(k)}}catch(m){}}e()};c?q.fileLoader.load(g):d()};(function(){function a(){}var h=qubit.opentag.Utils,b=new qubit.opentag.Log("Ping -> ");h.clazz("qubit.opentag.Ping",a);a.prototype.send=function(a,c){for(var f="c="+a.clientId+"&p="+a.containerId+"&l="+a.tellLoadTimesProbability+"&pv="+y.update()+"&d=",g=[],h=0;h<c.length;h++){var e=
c[h].tag,m=c[h].loadTime,r=e.config.ID;!e.pingSent&&r&&null!==m?void 0!==r?(g.push('"'+r+'":'+m),e.pingSent=!0):b.WARN("send: tag `"+e.config.name+"` has no ID assigned! Time load will not be sent."):e.pingSent?b.FINEST("send: ping already sent for `"+e.config.name+"`, ignoring."):null===m&&b.FINEST("send:tried to send null load times for `"+e.config.name+"`, ignoring.")}a.pingServerUrl&&0<g.length?(f+=encodeURIComponent("{"+g.join(",")+"}"),f="//"+a.pingServerUrl+"/tag2?"+f,b.FINE("send: sending pings "+
f),q.PostData(f,null,"GET")):(g.length||b.FINE("send: no pings to sent"),a.pingServerUrl||b.WARN("send: config.pingServerUrl is unset!"))};a.prototype.sendErrors=function(a,c){b.WARN("Errors sending is disabled.")};a.prototype.sendDedupe=function(a,c){for(var f="c="+a.clientId+"&p="+a.containerId+"&l="+a.tellLoadTimesProbability+"&pv="+y.update()+"&dd=",g=[],h=0;h<c.length;h++){var e=c[h],m=e.config.ID;void 0===m?b.WARN("sendDedupe: tag `"+e.config.name+"` has no ID assigned! Deduplicaton time load will not be sent."):
e.dedupePingSent||(g.push(m),e.dedupePingSent=!0)}0<g.length&&a.pingServerUrl?(f+=encodeURIComponent("["+g.join(",")+"]"),q.PostData("//"+a.pingServerUrl+"/tag2?"+f,null,"GET")):(g.length||b.FINE("sendDedupe: no dedupe pings to sent"),a.pingServerUrl||b.WARN("sendDedupe: config.pingServerUrl is unset!"))}})();v={_cookieName:"_qst_s",_sessionCookie:"_qsst_s",update:function(a){var h,b;h=qubit.Cookie.get(v._cookieName,!0);b=qubit.Cookie.get(v._sessionCookie,!0);if(h){if(h=parseInt(h,10),!b||parseInt(b,
10)<(new Date).getTime()-18E5)h+=1}else h=1;qubit.Cookie.set(v._cookieName,h,365,a,!0);qubit.Cookie.set(v._sessionCookie,(new Date).getTime().toString(),null,a,!0);return h}};var x={};(function(){function a(a){return 10>a?"0"+a:a}function h(a){c.lastIndex=0;return c.test(a)?'"'+a.replace(c,function(a){var b=n[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function b(c,d){var l,p,k,s,n=f,w,t=d[c];if(t instanceof Date)l=t,t=isFinite(l.valueOf())?
l.getUTCFullYear()+"-"+a(l.getUTCMonth()+1)+"-"+a(l.getUTCDate())+"T"+a(l.getUTCHours())+":"+a(l.getUTCMinutes())+":"+a(l.getUTCSeconds())+"Z":null;else if(t instanceof String||t instanceof Number||t instanceof Boolean)t=t.valueOf();"function"===typeof e&&(t=e.call(d,c,t));switch(typeof t){case "string":return h(t);case "number":return isFinite(t)?String(t):"null";case "boolean":case "null":return String(t);case "object":if(!t)return"null";f+=g;w=[];if("[object Array]"===Object.prototype.toString.apply(t)){s=
t.length;for(l=0;l<s;l+=1)w[l]=b(l,t)||"null";k=0===w.length?"[]":f?"[\n"+f+w.join(",\n"+f)+"\n"+n+"]":"["+w.join(",")+"]";f=n;return k}if(e&&"object"===typeof e)for(s=e.length,l=0;l<s;l+=1)"string"===typeof e[l]&&(p=e[l],(k=b(p,t))&&w.push(h(p)+(f?": ":":")+k));else for(p in t)Object.prototype.hasOwnProperty.call(t,p)&&(k=b(p,t))&&w.push(h(p)+(f?": ":":")+k);k=0===w.length?"{}":f?"{\n"+f+w.join(",\n"+f)+"\n"+n+"}":"{"+w.join(",")+"}";f=n;return k}}var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,g,n={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},e;"function"!==typeof x.stringify&&(x.stringify=function(a,c,d){var h;g=f="";if("number"===typeof d)for(h=0;h<d;h+=1)g+=" ";else"string"===typeof d&&(g=d);if((e=c)&&"function"!==typeof c&&("object"!==typeof c||"number"!==typeof c.length))throw Error("JSON.stringify");return b("",{"":a})});"function"!==
typeof x.parse&&(x.parse=function(a,b){function c(a,d){var e,g,f=a[d];if(f&&"object"===typeof f)for(e in f)Object.prototype.hasOwnProperty.call(f,e)&&(g=c(f,e),void 0!==g?f[e]=g:delete f[e]);return b.call(a,d,f)}var e;a=String(a);d.lastIndex=0;d.test(a)&&(a=a.replace(d,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,
"")))return e=eval("("+a+")"),"function"===typeof b?c({"":e},""):e;throw new SyntaxError("JSON.parse");})})();(function(){function a(a){for(var b=[],c=0;c<a.length;c++)b.push([new RegExp(a[c][0],"g"),"\\"+a[c][1]]);return b}function h(a,b){for(var c=0;c<b.length;c++)if(b[c][1]===a)return b[c][0];return null}function b(b){this._regexDefs=n;this._defs=g;b&&b.definitions&&(this._regexDefs=a(b.definitions),this._defs=b.definitions)}function d(a){for(var b={},c="",d=0;d<a.length;d++){var g=a.charAt(d);
switch(g){case "=":case "&":case "?":case "/":case ",":case ":":isNaN(b[c])&&(b[c]=a.split(c).length-1);c="";break;default:c+=g}}a=[];for(var f in b)b.hasOwnProperty(f)&&(c=b[f],c>=m&&f.length>=e&&a.push([f,c]));return a=a.sort(function(a,b){return a[0].length===b[0].length?0:b[0].length>a[0].length?1:-1})}var c=qubit.Define,f=qubit.Cookie,g=[["www.google.co","G"],['"landing":',"L"],['"time":',"A"],['"url":',"U"],['"sessionStartTime":',"S"],['"pageViews":',"P"],['"sessionCount":',"B"],['"sessionLandingPage":',
"E"],['"referrer":',"R"],['"url":"http://www.',"J"],['"url":"https://www.',"M"],["http://www.","W"],["https://www.","V"],["%2Fen%2Ftsuk%2F","K"],["http%3A%2F%2Fwww","F"],["http%3A%2F%2F","D"],["http://","H"],["https://","X"],[".co.uk/","Q"],[".co.uk","O"]],n=a(g);c.clazz("qubit.opentag.compression.Encoder",b);b.prototype.encode=function(a,b){for(var c=a.replace(/\\/g,"\\\\"),e=d(c),g=0;g<this._regexDefs.length;g++)var h=this._regexDefs[g],c=c.replace(h[0],h[1]);for(var c=c.replace(/;/g,"\\*"),c=c.replace(/=/g,
"\\+"),c=c.replace(/\n/g,"\\N"),c=c.replace(/ /g,"\\_"),c=c.replace(/\t/g,"\\T"),c=c.replace(/,/g,"\\C"),h=[],m=g=0;g<e.length;g++){var n=new RegExp(e[g][0].replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),n=c.replace(n,"\\"+m+"-");n!==c&&(h.push(e[g][0]),m++,c=n)}if(!b){e=[];for(g=0;g<c.length;g++)f.cookieAlphabetMap.hasOwnProperty(c.charAt(g))?e.push(c.charAt(g)):e.push("\\"+c.charCodeAt(g)+".");c=e.join("")}return 0<h.length?"Y"+h.join("&")+"?"+c:"N"+c};var e=4,m=2;b.prototype.decode=function(a){var b=
null;if("N"===a.charAt(0))a=a.substring(1);else if("Y"===a.charAt(0)){var c=a.indexOf("?");0<=c&&(b=a.substring(1,c),b=b.split("&"),a=a.substring(c+1))}for(var c="",d=!1,e=!1,g="",f=0;f<a.length;f++){var m=a.charAt(f);"\\"===m||d||e?d||e?(d=!1,"\\"===m?c+="\\":"*"===m?c+=";":"+"===m?c+="=":"N"===m?c+="\n":"_"===m?c+=" ":"T"===m?c+="\t":"C"===m?c+=",":null!==h(m,this._defs)?(m=h(m,this._defs),c+=m):isNaN(+("-"+m))?e?(c="."===m?c+String.fromCharCode(+g):b&&"-"===m?c+b[+g]:c+("\\"+g+m),g="",e=!1):c+=
"\\"+m:(e=!0,g+=m)):d=!0:c+=m}g&&(c+="\\"+g);d&&(c+="\\");return c}})();(function(){function a(a){this.testBinary=!0;this.binSupported=f;a&&(d.FINEST("Created compressor instance."),this.compressor=new qubit.compression.Compressor,this.encoder=new qubit.opentag.compression.Encoder({}))}var h=qubit.Define,b=qubit.Cookie,d=new qubit.opentag.Log("CookieCompressor -> "),c=h.global(),f=!!c.chrome||void 0!==c.mozIndexedDB;h.clazz("qubit.opentag.compression.CookieCompressor",a);a.prototype.compress=function(a,
c){if("string"!==typeof a||""===a)return a;d.FINEST("Compressing...");var e,f=this.encoder.encode(a);if(this.binSupported)return e=this.compressor.compress(f),e=this.encoder.encode(e,!0),d.FINEST("Binary compression ratio: "+e.length/a.length),"B"+e;if(this.testBinary){e=this.compressor.compress(f);e=this.encoder.encode(e,!0);b.set("__qtag_test_bin__",e);var h=b.get("__qtag_test_bin__");b.rm("__qtag_test_bin__");if(h===e)return d.FINEST("Binary compression ratio: "+e.length/a.length),"B"+e;d.FINEST("Binary cookie saving trial failed.")}e=
this.compressor.compressAnsi(f);e=!c&&f.length<=e.length?"E"+f:"C"+e;d.FINEST("Compression ratio: "+e.length/a.length);return e};a.prototype.decompress=function(a){if("string"!==typeof a||""===a)return a;d.FINEST("Decompressing...");var b=a.charAt(0);a=a.substring(1);switch(b){case "E":return this.encoder.decode(a);case "C":return a=this.compressor.decompressAnsi(a),this.encoder.decode(a);case "B":return a=this.compressor.decompress(this.encoder.decode(a)),this.encoder.decode(a);default:throw"This code is not supported! Code: "+
b;}}})();(function(){var a=qubit.Cookie,h=qubit.opentag.Utils,b=new qubit.opentag.Log("Session -> "),d=function(){};h.clazz("qubit.opentag.Session",d);var c=new qubit.opentag.compression.CookieCompressor({});d.readCompressedCookie=function(b){b=a.get(b);return c.decompress(b)};d.setupSession=function(f){var g,n,e,m,r;g={};g.sessionCount=v.update(f.cookieDomain);r="qtag_"+f.containerId;var l="x_qtag_"+f.containerId;e=a.get(r,!0);var p=!!e;null===e&&(e=a.get(l),e=c.decompress(e));if(e)try{e=x.parse(e)}catch(k){e=
{sc:0,sessionCount:0,pageViews:0,sessionStartTime:0,referrer:[],sessionLandingPage:"",__v:{}}}else e={sc:0,sessionCount:0,pageViews:0,sessionStartTime:0,referrer:[],sessionLandingPage:"",__v:{}};n=(new Date).getTime();g.sessionCount!==parseInt(e.sc,10)?(e.sessionStartTime=n,e.sc=g.sessionCount,e.sessionCount+=1,e.referrer.push({url:d.getReferrer(),landing:h.getUrl().substring(0,300),time:n}),e.sessionLandingPage=h.getUrl().substring(0,300)):d.isReferrerDifferent()&&!d.referrerIsSameAsPrevious(e.referrer,
n,18E5)&&(e.referrer.push({url:d.getReferrer(),landing:h.getUrl().substring(0,300),time:n}),e.sessionLandingPage=h.getUrl().substring(0,300),e.sessionStartTime=n,e.sessionCount+=1);g.sessionCount=e.sessionCount;g.sessionStartTime=e.sessionStartTime;g.pageStartTime=n;e.pageViews+=1;g.pageViews=e.pageViews;g.sessionLandingPage=e.sessionLandingPage;g.referrer=e.referrer;5<g.referrer.length&&g.referrer.splice(2,g.referrer.length-5);m=x.stringify(e);for(n=0;c.compress(m).length>f.maxCookieLength&&5>n;)3<=
e.referrer.length?e.referrer.splice(2,1):2===e.referrer.length?e.referrer=[e.referrer[0]]:1===e.referrer.length&&(e.referrer=[]),m=x.stringify(e),n+=1;g.referrer=e.referrer;p&&a.rm(r);r=c.compress(m);a.rm(l);a.set(l,r,365,f.cookieDomain);g.setVariable=function(b,d,k){e.__v[b]=[d,k?k:0];b=c.compress(x.stringify(e));a.set(l,b,365,f.cookieDomain)};g.getCookie=function(d,e){var k=a.get(d);if(k&&(e||0===d.indexOf("x_"))){b.FINE("getCookie() : Comressed cookie accessed:\n"+d+"="+k);try{k=c.decompress(k)}catch(g){b.ERROR("Cookie failed to decompress: "+
g)}}else k=a.decode(k);return k};g.getVariable=function(a){var b;if(a=e.__v[a])if(b=a[1],0===b||b>(new Date).getTime())return a[0];return null};g.on=function(a,b,c){b.attachEvent?b.attachEvent("on"+a,c):b.addEventListener&&b.addEventListener(a,c,!1)};return g};d.referrerIsSameAsPrevious=function(a,b,c){var e,m;return 0<a.length?(e=d.getReferrer(),m=h.getUrl().substring(0,300),a=a[a.length-1],a.url===e&&a.landing===m&&a.time+c>b):!1};d.isReferrerDifferent=function(){var a,b;b=d.getReferrer();a=b.indexOf("://");
if(-1===a)return!0;try{return 0!==b.substring(a+3).indexOf(d.getDomain())?!0:!1}catch(c){return!0}};d.getReferrer=function(){return document.referrer?document.referrer.substring(0,300):"direct"};d.getDomain=function(){return document.location.host}})();(function(){function a(b){this.runQueue=[];this.log=new qubit.opentag.Log("",function(){return this.CLASS_NAME+"["+this.config.name+"]"}.bind(this),!0);this.tags={};this.config={cookieDomain:"",maxCookieLength:1E3,gzip:!0,delayDocWrite:!1,clientId:"",
name:"",tellLoadTimesProbability:0,pingServerUrl:null,trackSession:!1,containerId:""};this.ignoreTagsState=!1;b&&(this.setConfig(b),this.isTellingLoadTimes=this.config.tellLoadTimesProbability>Math.random(),b.name||(this.config.name="Cont-"+r++),a.register(this),this.log.FINE("container registered."),this.ping=new qubit.opentag.Ping(this.config),this.config.trackSession&&(this.session=n.setupSession(this.config)),this.session&&(this.log.INFO("Session attached:"),this.log.INFO(this.session,!0)));return this}
function h(a,b,c){a[c]&&(p[c]=p[c]||1,c+="("+p[c]+")",p[c]++);a[c]=b}var b=qubit.opentag.Utils,d=qubit.opentag.filter.BaseFilter,c=qubit.opentag.BaseTag,f=qubit.opentag.Timed,g=qubit.opentag.Tags,n=qubit.opentag.Session,e=qubit.Cookie,m=new qubit.opentag.Log("Container -> "),r=1;window.opentag_consentGiven=function(){a.consentIsGiven=!0;for(var b=a.getContainers(),c=0;c<b.length;c++)try{b[c].run()}catch(d){m.ERROR("error running consent dependant containers: "+d)}}.bind(this);b.clazz("qubit.opentag.Container",
a);var l=[];a.register=function(a){b.addToArrayIfNotExist(l,a)};a.prototype.unregister=function(){a.unregister(this)};a.unregister=function(a){b.addToArrayIfNotExist(l,a);m.FINEST('Un-registering container named "'+a.config.name+'", instance of:');m.FINEST(a,!0);(a=b.removeFromArray(l,a))&&0!==a.length||m.FINE("container is already unregisterd.")};a.prototype.hasConsent=function(){return"Accepted"===e.get("qubitconsent",!0)};a.prototype.register=function(b){a.register(b||this)};a.getContainers=function(){return l};
a.prototype.getContainers=function(){return a.getContainers()};a.prototype.onTagRegistered=function(a){};a.prototype.registerTag=function(a){var b=a.config.name;if(this.tags[b])this.log.FINE("Tag with name `"+b+"` already is registered!");else{this.tags[b]=a;try{this.onTagRegistered(a)}catch(c){this.log.ERROR("onTagRegistered exception: "+c)}}};a.prototype.registerTags=function(a){for(var b=0;b<a.length;b++)this.registerTag(a[b])};a.prototype.setConfig=function(a){this.log.FINEST("Setting configuration:");
this.log.FINEST(a,!0);for(var b in a)this.config[b]=a[b]};a.prototype.run=function(){this.log.FINE("starting loading");this.runTags({command:"runOnceIfFiltersPass"})};a.prototype.runWithoutFilters=function(){this.log.FINE("starting loading");this.runTags({command:"run"})};a.prototype.getTagByname=function(a){return this.tags[a]};a.prototype.containerScriptLoadedSynchronously=function(){var a,b,c,d,e;d=document.getElementsByTagName("script");a=0;for(b=d.length;a<b;a+=1)if(c=d[a],(e=c.getAttribute("src"))&&
0<e.indexOf(""+this.config.clientId+"-"+this.config.profileName+".js"))return null===c.getAttribute("async")&&(!1===c.getAttribute("defer")||""===c.getAttribute("defer")||null===c.getAttribute("defer"));return!0};a.prototype.runTags=function(c){if(a.OFF||b.global().QUBIT_CONTAINERS_OFF)this.log.INFO("Container are DISABLED."),this.log.INFO("To enable, set Container.OFF to true and set QUBIT_CONTAINERS_OFF to false."),this.log.WARN("Container disabled -will stop here.");else{var d=this.containerScriptLoadedSynchronously(),
e="runIfFiltersPass";c&&c.command&&(e=c.command);this.runningStarted=(new Date).valueOf();this.log.FINE("triggering runningStarted at "+this.runningStarted);c={};for(var g in this.tags)try{var f=this.tags[g];if(this.includedToRun(f)){this.log.FINE("triggering tag named: "+g);d||(f.forceAsynchronous=!0);this.config.delayDocWrite&&(f.delayDocWrite=!0);f.session=f.session||this.session;if(0<f.dependencies.length)for(var h=0;h<f.dependencies.length;h++){var l=f.dependencies[h],m=l.config.name;!c[m]&&
this.tags[m]&&(c[m]=l,l[e]())}c[g]||(c[g]=f,f[e]())}}catch(n){this.log.ERROR("Error running tag with name '"+g+"'.\n Error: "+n)}this.waitForAllTagsToFinish()}};a.prototype.includedToRun=function(b){if(b.config.inactive)return!1;var d=a.consentIsGiven||!b.config.needsConsent||this.hasConsent();b=b.state===c.prototype.STATE.INITIAL;return this.ignoreTagsState||d&&b};a.prototype.waitForAllTagsToFinish=function(){if(!this._waitForAllTagsToFinishWaiting){var a=this.log,c=this.allTagsFinished();if(!this._showFinishedOnce&&
c){this._showFinishedOnce=!0;this.runningFinished=(new Date).valueOf();var c=this.getAllTagsByState(),d=null===c.awaiting?0:b.keys(c.awaiting).length;a.INFO("********************************************************",0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");a.INFO("Startup tags have ended their processing.",0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");a.INFO("Finished in "+(this.runningFinished-this.runningStarted)+"ms.",0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");
if(c.run){var e=b.keys(c.run).length;a.INFO("Successfully run tags["+e+"]:",0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");a.INFO(c.run,!0)}else a.INFO("No successfully run tags.",0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");c.failed?(e=b.keys(c.failed).length,a.INFO("Failed to run["+e+"]:",0," ;color: #0F7600;font-size: 12px;font-weight:bold; "+(null===c.failed?"":"color: #DF5500;")),a.INFO(c.failed,!0)):a.INFO("No failed tags.",0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");
c.awaiting?(e=b.keys(c.awaiting).length,a.INFO("There is still "+d+" tag(s) ready to be fired by awaiting filters that can run.",0," ;color: #0F7600;font-size: 12px;font-weight:bold; color: #DC9500;"),a.INFO("Filter ready tags["+e+"]:",0," ;color: #0F7600;font-size: 12px;font-weight:bold; color: #DC9500;"),a.INFO(c.awaiting,!0)):a.INFO("No filter ready tags.",0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");c.consent?(e=b.keys(c.consent).length,a.INFO("Consent awaiting tags["+e+"]:",0," ;color: #0F7600;font-size: 12px;font-weight:bold; "),
a.INFO(c.consent,!0)):a.INFO("No consent awaiting tags.",0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");c.other?(e=b.keys(c.other).length,a.INFO("Other unloaded tags["+e+"]:",0," ;color: #0F7600;font-size: 12px;font-weight:bold; "),a.INFO(c.other,!0)):a.INFO("No unloaded tags.",0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");a.INFO("********************************************************",0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");this.sendPingsNotTooOften();if(this.onTagsInitiallyRun)this.onTagsInitiallyRun()}else c?
(a.INFO("********************************************************"),a.WARN("All tags seem to finished current jobs."),a.INFO("********************************************************")):(this._waitForAllTagsToFinishWaiting=!0,this._showFinishedOnce=!1,f.setTimeout(function(){this._waitForAllTagsToFinishWaiting=!1;this.waitForAllTagsToFinish()}.bind(this),100))}};a.prototype.onTagsInitiallyRun=u;a.prototype.resetAllTags=function(){m.WARN("reseting all tags!");for(var a in this.tags)this.tags.hasOwnProperty(a)&&
this.tags[a].reset()};a.prototype.reset=function(){m.WARN("reseting container!");this._showFinishedOnce=this.runningStarted=this._waitForAllTagsToFinishWaiting=this.runningFinished=void 0;this.resetAllTags()};a.prototype.sendPingsNotTooOften=function(){this._sndLck=this._sndLck||{};f.runIfNotScheduled(this.sendPings.bind(this),2E3,this._sndLck)};a.prototype.sendPings=function(){if(this.isTellingLoadTimes){var a=this.getAllTagsByState(),c=this,b;a.run&&(b=g.getLoadTimes(a.run),this.log.INFO("sending standard load pings"),
this.lastPingsSentTime=(new Date).valueOf(),this.ping.send(this.config,b));b=g.getLoadTimes();for(var d=[],e=0;e<b.length;e++)(function(a){a=b[a].tag;a.config.dedupe&&a.sendDedupePing&&d.push(a)})(e);0<d.length&&(this.log.INFO("sending deduplication pings"),this.lastDedupePingsSentTime=(new Date).valueOf(),this.ping.sendDedupe(this.config,d));if(a.other){b=g.getLoadTimes(a.other);for(var f=[],e=0;e<b.length;e++)(function(a){var d=b[a].tag;f.push(b[a]);var e=d.onAfter;d.onAfter=function(a){e.call(d,
a);c.sendPingsNotTooOften();a&&d.log.INFO("SENDING LOAD STATS")}})(e)}if(a.awaiting){b=g.getLoadTimes(a.awaiting);f=[];for(e=0;e<b.length;e++)(function(a){var d=b[a].tag;f.push(b[a]);var e=d.onAfter;d.onAfter=function(a){e.call(d,a);c.sendPingsNotTooOften();a&&d.log.INFO("SENDING LOAD STATS")}})(e);0<f.length&&this.ping.send(this.config,f)}}};a.prototype.getAllTagsByState=function(){return a.getAllTagsByState(this.tags)};a.getAllTagsByState=function(a){var b=null,e=null,g=null,f=null,l=null,m=c.prototype.STATE.FILTERS_FAILED,
n;for(n in a){var p=a[n];if(p instanceof c){var r=p.config.name;0<p.scriptExecuted?(b=b||{},h(b,p,r)):0>p.scriptExecuted||p.state>m?(f=f||{},h(f,p,r)):p.filtersState()===d.state.SESSION||0<p.filtersState()?(g=g||{},h(g,p,r)):p.config.needsConsent?(l=l||{},h(l,p,r)):(e=e||{},h(e,p,r))}}return{run:b,failed:f,awaiting:g,consent:l,other:e}};var p={};a.prototype.allTagsFinished=function(){for(var a in this.tags)if(this.tags.hasOwnProperty(a)){var b=this.tags[a];if(b instanceof qubit.opentag.BaseTag){var c=
b.filtersState();if(0>b.filtersState()&&!(b.finished()||b.config.runner&&!b.isRunning)&&c!==d.state.SESSION)return!1}}return!0};a.prototype.getPageVariables=function(){var a=[],c;for(c in this.tags)if(this.tags.hasOwnProperty(c))for(var d=this.tags[c].getPageVariables(),e=0;e<d.length;e++)b.addToArrayIfNotExist(a,d[e]);return a};a.getPageVariableByName=function(a){for(var b=this.getAllPageVariables(),c=[],d=0;d<b.length;d++)b[d].config.name===a&&c.push(b[d]);return c}})();(function(){function a(b){h.setIfUnset(b,
a.defaultConfig);if(this.singleton){var d=qubit.opentag.Utils.getObjectUsingPath(this.PACKAGE_NAME+"."+this.CLASS_NAME);if(d.__instance)return d.__instance.log.FINEST("Returning singleton instance."),d.__instance;d.__instance=this}a.superclass.call(this,b)}var h=qubit.opentag.Utils;h.clazz("qubit.opentag.LibraryTag",a,qubit.opentag.BaseTag);a.defaultConfig={vendor:null,imageUrl:null,description:"Provide description.",async:!1,isPrivate:!1,upgradeable:!0,html:"",parameters:[]};a.prototype.pre=function(){this.log.FINEST("emtpy pre called")};
a.prototype.post=function(){this.log.FINEST("emtpy post called")};a.prototype.before=function(){a.superclass.prototype.before.call(this);if(this.config.html||this.config.script)return log.WARN("config.html or config.script is set while using pre. Cancelling running pre."),!1;this.log.INFO("Running PRE script execution...");try{var b=this.config;if(b&&b.pre)if("function"===typeof b.pre)this.pre=b.pre,this.pre();else{var d=this.replaceTokensWithValues(String(b.pre));this.config.prePostWindowScope?h.geval(d):
(this.pre=h.expressionToFunction(d).bind(this),this.pre())}else this.pre()}catch(c){return this.log.ERROR(this.config.name+" exception while running pre: "+c),!0}return!1};a.prototype.after=function(b){a.superclass.prototype.after.call(this,b);if(this.config.html||this.config.script)log.WARN("config.html or config.script is set while using post. Cancelling running post.");else{this.log.INFO("Running POST script execution...");try{var d=this.config;if(d&&d.post)if("function"===typeof d.post)this.post=
d.post,this.post(b);else{var c=this.replaceTokensWithValues(String(d.post));this.config.prePostWindowScope?h.geval(c):(this.post=h.expressionToFunction(c).bind(this),this.post(b))}else this.post(b)}catch(f){this.log.ERROR(this.config.name+" exception while running pre: "+f)}}};a.define=function(b,d){b=b.replace(/^[\.]+/g,"").replace(/[\.]+$/g,"").replace(/\.+/g,".");var c=d.config,f=d.CONSTRUCTOR,g={},n;for(n in d)"config"!==n&&(g[n]=d[n]);g.CONSTRUCTOR=function(a){a=a||{};var b=h.objectCopy(c,{maxDeep:5}),
d;for(d in b)a.hasOwnProperty(d)||(a[d]=b[d]);b=qubit.opentag.LibraryTag.call(this,a);f&&f.call(this,a);if(b)return b};g=qubit.opentag.Utils.defineClass(b,a,g);h.namespace("qubit.opentag.libraries."+b,g);return g}})();(function(){function a(b){h.setIfUnset(b,{url:null,html:"",locationPlaceHolder:"NOT_END",locationObject:"BODY",prePostWindowScope:!0,async:!0});a.superclass.call(this,b)}var h=qubit.opentag.Utils;h.clazz("qubit.opentag.CustomTag",a,qubit.opentag.LibraryTag)})();qubit.opentag.Utils.namespace("qubit.opentag.filter.pattern.PatternType",
{CONTAINS:"Contains",MATCHES_EXACTLY:"Matches Exactly",STARTS_WITH:"Starts with",ENDS_WITH:"Ends with",REGULAR_EXPRESSION:"Regular Expression",ALL_URLS:"All URLs"});(function(){function a(b){this._lockObject={};var f={patternType:d.CONTAINS,pattern:""};if(b)for(var g in b)b.hasOwnProperty(g)&&(f[g]=b[g]);a.superclass.call(this,f)}var h=qubit.opentag.Utils,b=qubit.opentag.Timed,d=qubit.opentag.filter.pattern.PatternType;h.clazz("qubit.opentag.filter.URLFilter",a,qubit.opentag.filter.BaseFilter);a.prototype.getURL=
function(a){return a||h.getUrl()};a.prototype.match=function(a){a=this.getURL(a);var f=!0,g=this.config.pattern;switch(this.config.patternType){case d.CONTAINS:f=0<=a.toLowerCase().indexOf(g.toLowerCase());break;case d.MATCHES_EXACTLY:f=a.toLowerCase()===this.config.pattern.toLowerCase();break;case d.STARTS_WITH:f=0===a.toLowerCase().indexOf(g.toLowerCase());break;case d.ENDS_WITH:f=a.lastIndexOf(g.toLowerCase())+g.length===a.length;break;case d.REGULAR_EXPRESSION:f=(new RegExp(g)).test(a);break;
case d.ALL_URLS:f=!0}b.maxFrequent(function(){this.log.FINEST("[ Filter "+this.config.name+"] Checking if patternType '"+this.config.patternType+"' match '"+g+"' pattern: "+(f?"Yes -> "+f:"No")+", include: "+this.config.include)}.bind(this),1E3,this._lockObject);return f}})();(function(){function a(a){q.INFO("init, config passed:");q.INFO(a,!0);this.config={filters:[],profileName:"",qTagClientId:"",pageVars:{},scriptLoaders:{},tellLoadTimesProbability:0,pingServerUrl:"",qtag_domain:"",delayDocWrite:!1,
maxCookieLength:3E3,containerName:""};this.config.qtag_track_session=!0;for(var b in a)a.hasOwnProperty(b)&&(this.config[b]=a[b])}function h(a,c){q.FINE("getting filters");for(var e=[],h=0;h<a.length;h++){var k=a[h];if(-1!==d.indexInArray(k.scriptLoaderKeys,c)){var l=!1;switch(y(k)){case v:l=!0}k.instance=l||k.starter||"function"===typeof k.pattern?new g({include:1===+k.filterType,name:k.name,customStarter:k.starter,customScript:k.pattern}):new f({include:1===+k.filterType,name:k.name,patternType:b(k),
pattern:k.pattern});void 0!==k.priority&&(k.instance.config.order=+k.priority);e.push(k.instance)}}return e.sort(function(a,b){return+a.priority>+b.priority})}function b(a){switch(a.patternType){case I:case J:return null;case H:case "1"+H:return c.MATCHES_EXACTLY;case F:case "1"+F:return c.CONTAINS;case G:case "1"+G:return c.REGULAR_EXPRESSION;case A:case "1"+A:return c.ALL_URLS;default:return null}}var d=qubit.opentag.Utils,c=qubit.opentag.filter.pattern.PatternType,f=qubit.opentag.filter.URLFilter,
g=qubit.opentag.filter.SessionVariableFilter,n=qubit.opentag.LibraryTag,e=qubit.opentag.CustomTag,m=qubit.opentag.pagevariable.DOMText,r=qubit.opentag.pagevariable.BaseVariable,l=qubit.opentag.pagevariable.URLQuery,p=qubit.opentag.pagevariable.Cookie,k=qubit.opentag.pagevariable.Expression,q=new qubit.opentag.Log("OldTagRunner -> ");d.clazz("qubit.opentag.OldTagRunner",a);a.prototype.run=function(){if(!this._run){this._run=(new Date).valueOf();q.FINE("entering run");this.container=new qubit.opentag.Container({cookieDomain:this.config.qtag_domain,
maxCookieLength:this.config.maxCookieLength,delayDocWrite:this.config.delayDocWrite,gzip:!0,clientId:this.config.qTagClientId,containerId:this.config.profileName,name:this.config.containerName,tellLoadTimesProbability:this.config.tellLoadTimesProbability,pingServerUrl:this.config.pingServerUrl,trackSession:this.config.qtag_track_session});var a=this.getTags();this.container.registerTags(a);this.container.run()}};a.prototype.getTags=function(){var a=this.config.filters,b=this.config.scriptLoaders,
c=this.config.pageVars,d=[],g;for(g in b)if(b.hasOwnProperty(g)){var f=b[g],q=h(a,g),s,v=c;s=f.pageVars;var C=[],y=void 0;for(y in s)if(s.hasOwnProperty(y)){var A=s[y],z=v[y];if(z){var B={name:z.name,value:z.value};switch(z.type){case u:z=new k(B);break;case w:z=new l(B);break;case t:z=new p(B);break;case x:z=new m(B);break;default:z=new r(B)}B={token:A.token};A.defaultValue&&(B.defaultValue=A.defaultValue);z&&(B.variable=z);C.push(B)}}s=C;C="";1===f.locationId?C="HEAD":2===f.locationId?C="BODY":
3===f.locationId&&(C=f.locationDetail);v=f.dedupe;q={name:f.name,filters:q,parameters:s,ID:f.id,url:f.url,html:f.html,template:!!f.template,locationPlaceHolder:1===+f.positionId?"NOT_END":"END",locationObject:C,async:f.async,needsConsent:f.needsConsent,usesDocumentWrite:f.usesDocWrite,genericDependencies:f.genericDependencies};void 0!==f.prePostWindowScope&&(q.prePostWindowScope=f.prePostWindowScope);v&&(q.dedupe=!0);f.runner&&(q.runner=f.runner);f.pre&&(q.pre=f.pre);f.post&&(q.post=f.post);f.script&&
(q.script=f.script);f=null;f=q.template?new n(q):new e(q);b[g].instance=f;d.push(f)}for(g in b)if(b.hasOwnProperty(g)&&(a=[],f=b[g],f.dependencies)){for(c=0;c<f.dependencies.length;c++)a.push(b[f.dependencies[c]].instance);f=f.instance;f.dependencies=a.concat(f.dependencies)}return d};var u="2",w="3",t="4",x="5",v="3",y=function(a){a=parseInt(a.patternType,10);if(10>a||100===a)return"1";if(10<=a&&20>a)return"2";if(110===a)return v},A="1",F="2",G="3",H="4",I="100",J="110"})();qubit.opentag.Utils.namespace("qubit.opentag.data.category.ABMultiVariateTesting",
{id:4,name:"AB & Multi-Variate Testing"});qubit.opentag.Utils.namespace("qubit.opentag.data.category.AdvertisingNetwork",{id:10,name:"Advertising Network"});qubit.opentag.Utils.namespace("qubit.opentag.data.category.AffiliateNetworks",{id:5,name:"Affiliate Networks"});qubit.opentag.Utils.namespace("qubit.opentag.data.category.AudienceManagement",{id:9,name:"Audience Management"});qubit.opentag.Utils.namespace("qubit.opentag.data.category.DSP",{id:13,name:"DSP"});qubit.opentag.Utils.namespace("qubit.opentag.data.category.DSPAdServer",
{id:14,name:"DSP (Ad Server)"});qubit.opentag.Utils.namespace("qubit.opentag.data.category.DigitalMediaAgencies",{id:12,name:"Digital Media Agencies"});qubit.opentag.Utils.namespace("qubit.opentag.data.category.EmailServiceProviderESP",{id:15,name:"Email Service Provider (ESP)"});qubit.opentag.Utils.namespace("qubit.opentag.data.category.FeedManagementShoppingComparison",{id:16,name:"Feed Management (Shopping Comparison)"});qubit.opentag.Utils.namespace("qubit.opentag.data.category.LiveChatCustomerServiceEngine",
{id:17,name:"Live Chat & Customer Service Engine"});qubit.opentag.Utils.namespace("qubit.opentag.data.category.MerchandisingRichMedia",{id:18,name:"Merchandising & Rich Media"});qubit.opentag.Utils.namespace("qubit.opentag.data.category.PersonalisationPlatform",{id:19,name:"Personalisation Platform"});qubit.opentag.Utils.namespace("qubit.opentag.data.category.RatingsReviewEngine",{id:6,name:"Ratings & Review Engine"});qubit.opentag.Utils.namespace("qubit.opentag.data.category.ReTargeting",{id:8,name:"Re-Targeting"});
qubit.opentag.Utils.namespace("qubit.opentag.data.category.SearchEngine",{id:7,name:"Search Engine"});qubit.opentag.Utils.namespace("qubit.opentag.data.category.Social",{id:3,name:"Social"});qubit.opentag.Utils.namespace("qubit.opentag.data.category.TagManagement",{id:11,name:"Tag Management"});qubit.opentag.Utils.namespace("qubit.opentag.data.category.WebAnalytics",{id:2,name:"Web Analytics"});qubit.opentag.Utils.namespace("qubit.opentag.data.category.ABMultiVariateTesting",{id:1,name:"Web Utilities / JavaScript Tools"})})()}catch(e$$25){try{window.debug&&
console.log(e$$25)}catch(ex$$39){}};
