(function(){var F,B;function J(){function a(d){e.events.push(d);l(e.listeners,function(a){if(!a.disposed&&c(a.type,d.meta.type))try{a.callback.call(a.context,d)}catch(b){console&&console.error&&console.error("Error emitting UV event",b.stack)}});b.shift();0<b.length&&a(b[0])}function l(a,b){for(var d=a.length,c=0;c<d;c++)b(a[c],c)}function k(a){var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function c(a,b){return"string"===typeof a?a===b:a.test(b)}function d(a,b){for(var c=a.length,
d=[],e=0;e<c;e++)b(a[e])&&d.push(a[e]);return d}var b=[],e={emit:function(c,f){f=k(f||{});f.meta=f.meta||{};f.meta.type=c;b.push(f);1===b.length&&a(b[0]);e.listeners=d(e.listeners,function(a){return!a.disposed})},on:function(a,b,d){var r={type:a,callback:b,disposed:!1,context:d||window};e.listeners.push(r);var q={replay:function(){l(e.events,function(e){r.disposed||c(a,e.meta.type)&&b.call(d,e)});return q},dispose:function(){r.disposed=!0;return q}};return q},once:function(a,b,c){var d=e.on(a,function(){b.apply(c||
window,arguments);d.dispose()});return d},events:[],listeners:[]};return e}function L(){var a=G.uv;if(!a||!a.emit)return!1;if(!K){K=!0;for(var l=0;l<E.length;l++){var k=E[l];k.on?a.on.apply(a,k.on):k.emit&&a.emit.apply(a,k.emit)}a.on(/.*/,function(a){var d=a.meta.type,b=H[d];b?(b.current=a,b.history.push(a)):H[d]={current:a,history:[a]}}).replay();I=!0}return!0}(function(){Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");
var l=Array.prototype.slice.call(arguments,1),k=this,c=function(){},d=function(){return k.apply(this instanceof c?this:a,l.concat(Array.prototype.slice.call(arguments)))};c.prototype=this.prototype;d.prototype=new c;return d})})();var C={__anonymous__:!0},y=null;try{y=(0,eval)("this")}catch(M){}if(!y)try{y=function(){return this}()}catch(N){}var C=y,h=C.qubit||{};C.qubit||(C.qubit=h);if(h.VERSION&&"3.3.1"!==h.VERSION)try{console.warn("There is already 'qubit.VERSION' set to: "+h.VERSION)}catch(O){}h.VERSION=
"3.3.1";try{"object"===typeof module&&(module.exports=C)}catch(P){}var x=function(){};(function(){function a(){}function l(d,b,c,g,f){d=d.split(".");var m=a.NAMESPACE_BASE||C,r=null,q=null;f&&(m=y);f=m;m=c||m;for(c=0;c<d.length-1;c+=1)q=d[c],m[q]=m[q]||{},m=m[q];r=m;q=d[d.length-1];y.TAGSDK_NS_OVERRIDE&&(g=!1);void 0!==y.TAGSDK_NS_FORCED_OVERRIDE_OPTION&&(g=!y.TAGSDK_NS_FORCED_OVERRIDE_OPTION);void 0!==b?void 0!==r[q]&&g||(r[q]=b):r[q]=r[q]||{};b&&(b.CLASSPATH=d.join("."),d.splice(d.length-1,1),b.PACKAGE_NAME=
d.join("."));return{root:f,object:r,instance:r[q]}}a.global=function(){return y};a.STANDARD_CS_NS="qubit.cs";a.clientSpaceClasspath=function(){return window.qubit.CLIENT_CONFIG?"qubit.cs.d"+window.qubit.CLIENT_CONFIG.id:a.STANDARD_CS_NS};a.globalNamespace=function(a,b,c,g){return l(a,b,c,g,!0)};a.namespace=function(a,b,c,g){return l(a,b,c,g,!1)};a.clientNamespace=function(c,b,e,g){return a.namespace(a.clientSpaceClasspath()+"."+c,b,e,g)};a.clazz=function(c,b,e,g,f){a.namespace(c,b,g,!0);"function"===
typeof e&&(b.SUPER=e,b.superclass=e,b.prototype=new e(f),b.prototype.SUPER=e,b.prototype.CLASS=b);c=c.split(".");b.prototype?(b.prototype.CLASSPATH=c.join("."),b.prototype.CLASS_NAME=c[c.length-1],c.splice(c.length-1,1),b.prototype.PACKAGE_NAME=c.join(".")):(b.CLASSPATH=c.join("."),b.STATIC_NAME=c[c.length-1],c.splice(c.length-1,1),b.PACKAGE_NAME=c.join("."));return b};a.clazz("qubit.Define",a);a.clientClazz=function(c,b,e,g,f){return a.clazz(a.clientSpaceClasspath()+"."+c,b,e,g,f)};a.STANDARD_VS_NS=
"qubit.vs";a.vendorsSpaceClasspath=function(c){var b=h.VENDOR_SPACE_CP,b=void 0===b||null===b?a.STANDARD_VS_NS:b;return c?b?b+"."+c:c:b};var k=a.vendorsSpaceClasspath(),c;c=k?a.namespace(k,{},null,!0).instance:a.global();a.getVendorSpace=function(){return c};a.vendorNamespace=function(c,b,e,g){c=a.vendorsSpaceClasspath(c);return a.namespace(c,b,e,g)};a.vendorClazz=function(c,b,e,g,f){c=a.vendorsSpaceClasspath(c);return a.clazz(c,b,e,g,f)}})();(function(){function a(a){}for(var l={},k=0;93>k;k++)l["abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ*!-#$&+()@'%./:<>?[\"]^_`{|}~\\;=".charAt(k)]=
k;h.Define.clazz("qubit.Cookie",a);a.cookieAlphabet="abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ*!-#$&+()@'%./:<>?[\"]^_`{|}~\\;=";a.cookieAlphabetMap=l;a.decode=function(a){return unescape(a)};a.encode=function(a){return escape(a)};a.set=function(b,c,d,f,m){if(d){var r=new Date;r.setTime(r.getTime()+864E5*d);d="; expires="+r.toGMTString()}else d="";m||(b=a.encode(b),c=a.encode(c));b=b+"="+c+d+"; path=/;";f&&(b+=" domain="+f);document.cookie=b};var c,d={};a.resetCache=function(){c=
null;d={}};a.getCached=function(b,e){var g=b+"="+!!e;if(void 0!==d[g])return d[g];var f=b+"=";c||(c=document.cookie.split(";"));for(var m=0;m<c.length;m++){for(var r=c[m];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(f))return f=r.substring(f.length,r.length),e||(f=a.decode(f)),d[g]=f}return d[g]=null};a.get=function(b,c){for(var d=b+"=",f=document.cookie.split(";"),m=0;m<f.length;m++){for(var r=f[m];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(d))return d=r.substring(d.length,
r.length),c||(d=a.decode(d)),d}return null};a.getAllForName=function(b,c){if(!b)return[];for(var d=b+"=",f=document.cookie.split(";"),m=[],r=0;r<f.length;r++){for(var q=f[r];" "===q.charAt(0);)q=q.substring(1,q.length);0===q.indexOf(d)&&(q=q.substring(d.length,q.length),c&&(q=a.decode(q)),m.push(q))}return m};a.getAll=function(b){for(var c=document.cookie.split(";"),d=[],f=0;f<c.length;f++){for(var m=c[f];" "===m.charAt(0);)m=m.substring(1,m.length);var r=m.substring(0,m.indexOf("=")),m=m.substring(r.length+
1,m.length);b&&(m=a.decode(m));d.push([r,m])}return d};a.rm=function(b,c){a.set(b,"",-1,c)}})();(function(){function a(a,b){for(var c=g.length,f=0;f<c;f++)if(a===g[f][0])return g[f][1];g[g.length]=[a,b];return!1}function l(n,b,c,f,p){var d=!1,m=!1,q=!1,r=!1,k=!1,s=k=!1;b&&(d=(k=!!b.all)||b.nodes,r=k||b.win,m=k,s=!!b.emptyForMaxDeep,q=b.noFunctions&&!k,void 0!==b.noOwn&&(m=!!b.noOwn),void 0!==b.noFunctions&&(q=!!b.noFunctions),void 0!==b.win&&(r=!!b.win),void 0!==b.nodes&&(d=!!b.nodes),k=!!b.copyReference);
if(void 0===c||c)void 0!==c&&c--;else return s?void 0:n;if(!(n&&n instanceof Object))return n;if(!d){try{if(n instanceof Node)return n}catch(t){if(n instanceof ActiveXObject&&void 0!==n.nodeType)return n}if(n===document)return n}if(!r&&n===e)return n;d=n instanceof Array?[]:{};n instanceof Date&&(d=new Date(n));!q&&n instanceof Function&&(q=String(n).replace(/\s+/g,""),d=q.indexOf("{[nativecode]}")+14===q.length?function(){return n.apply(p||this,arguments)}:function(){return n.apply(this,arguments)});
void 0===f&&(g=[],f=0);if(q=a(n,d))return q;if(d instanceof Array)for(q=0;q<n.length;q++)d[d.length]=n[q]===n[q]?l(n[q],b,c,f+1,n):n[q];else{var q=0,h;for(h in n){if(m||n.hasOwnProperty(h))d[h]=n[h]===n[h]?l(n[h],b,c,f+1,n):n[h];q++}}b.proto&&(d.prototype=l(n.prototype,b,c,f+1,n));k&&(d.___copy_ref=n);return d}function k(a,b,c,d,p,m,q,g){c=c||{};void 0===c.hasOwn&&(c.hasOwn=!0);if(!c.objectsOnly||a instanceof Object)if(void 0===g||g){void 0!==g&&g--;if(!c||!c.nodes)try{if(a instanceof Node)return}catch(r){if(a instanceof
ActiveXObject&&void 0!==a.nodeType)return}if(a!==e){void 0===d&&(f=[],d=0);var l;a:{for(l=0;l<d&&l<f.length;l++)if(a===f[l]){l=!0;break a}l=!1}if(!(l||(f[d]=a,p=p||a,p&&m&&p[m]!==p[m]||b(a,p,m,q)))){m=0;l="";for(var s in a){if(!c.hasOwn||a.hasOwnProperty(s))try{var h=a[s];c.track&&(l=q?q+"."+s:s);k(h,b,c,d+1,p,s,l,g)}catch(t){}m++}}}}}var c=h.Define,d=h.Cookie,b=function(){},e=c.global();c.clazz("qubit.opentag.Utils",b);b.global=c.global;b.namespace=c.namespace;b.clazz=c.clazz;b.getObjectUsingPath=
function(a,b){b=b||e;for(var c=a.split("."),f=0;f<c.length;f++)b&&c[f]&&(b=b[c[f]]);return b};b.getParentObject=function(a){var c=a.lastIndexOf(".");a=a.substring(0,c);return b.getObjectUsingPath(a)};b.variableExists=function(a){return void 0!==a&&null!==a};b.ANON_VARS=[];b.getAnonymousAcessor=function(a){var c=b.indexInArray(a,b.ANON_VARS);-1===c&&(c=b.addToArrayIfNotExist(b.ANON_VARS,a));return"qubit.opentag.Utils.ANON_VARS["+c+"]"};b.replaceAll=function(a,b,c){return a.replace(new RegExp(b.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,
"\\$1"),"g"),c)};b.secureText=function(a){"string"!==typeof a&&(a+="");a=a.replace(/</g,"&lt;");return a=a.replace(/>/g,"&gt;")};b.getUrl=function(){return document.location.href};b.getQueryParam=function(a){var c,f,d,p;c=b.getUrl();if(0<c.indexOf("?"))for(p=c.substring(c.indexOf("?")+1).split("&"),c=0,f=p.length;c<f;c+=1)if(d=p[c],0<d.indexOf("=")&&(d=d.split("="),2===d.length&&d[0]===a))return d[1];return null};b.getElementValue=function(a){return(a=document.getElementById(a))?a.textContent||a.innerText:
null};var g=[];b.objectCopy=function(a,b){b=b||{};var c=l(a,b,b.maxDeep);g=[];return c};var f=[];b.traverse=function(a,b,c){k(a,b,c,void 0,void 0,void 0,void 0,c.maxDeep)};b.prepareQuotedString=function(a){return"string"===typeof a?'"'+a.replace(/\"/g,'\\"')+'"':a};b.expressionToFunction=function(a,c){return b.gevalAndReturn("function ("+(c||"")+") {"+a+"}").result};b.defineWrappedClass=function(a,b,f,d,p){var e=function(){return p?p.apply(this,arguments):b.apply(this,arguments)};c.clazz(a,e,b,d);
for(var m in f)f.hasOwnProperty(m)&&"CONSTRUCTOR"!==m&&(e.prototype[m]=f[m]);return e};b.copyAandAddFromB=function(a,b,c){a=this.objectCopy(a,{maxDeep:c||8});for(var f in b)b.hasOwnProperty(f)&&(a[f]=b[f]);return a};b.keys=function(a){if(a instanceof Object){if(Object.keys)return Object.keys(a);var b=[],c;for(c in a)a.hasOwnProperty(c)&&(b[b.length]=c);return b}throw"keys() called on non-object!";};b.getSrcElement=function(a){var b;a=a||window.event;a.srcElement?b=a.srcElement:a.target&&(b=a.target);
return b};b.addToArrayIfNotExist=function(a,b,c){for(var f=0,d=!1;f<a.length;f+=1)if(c&&c(a[f],b)||a[f]===b){d=!0;break}d||(a[a.length]=b,f=-1);return f};b.indexInArray=function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1};b.existsInArray=function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return!0;return!1};b.removeFromArray=function(a,b){for(var c=0,f=0;c<a.length;)a[c]===b?(a.splice(c,1),f++):c++;return f};b.addClass=function(a,c){var f;try{a.classList.add(c)}catch(d){null===
a.className?a.className=c:(f=a.className.split(" "),b.addToArrayIfNotExist(f,c),a.className=f.join(" "))}};b.removeClass=function(a,c){var f;try{a.classList.remove(c)}catch(d){null===a.className?a.className="":(f=a.className.split(" "),b.removeFromArray(f,c),a.className=f.join(" "))}};b.gevalAndReturn=function(a){var c=y;c.qubitopentagutilsgevalandreturn__var_test__=void 0;c.qubitopentagutilsgevalandreturn__var_test__error=void 0;b.geval("try{this.qubitopentagutilsgevalandreturn__var_test__=("+a+
");}catch(ex){this.qubitopentagutilsgevalandreturn__var_test__error = ex;}");a=c.qubitopentagutilsgevalandreturn__var_test__;var f=c.qubitopentagutilsgevalandreturn__var_test__error;try{c.qubitopentagutilsgevalandreturn__var_test__=void 0,c.qubitopentagutilsgevalandreturn__var_test__error=void 0,delete c.qubitopentagutilsgevalandreturn__var_test__,delete c.qubitopentagutilsgevalandreturn__var_test__error}catch(d){}return{result:a,error:f}};b.trim=function(a){try{return String(a).trim()}catch(b){return String(a).replace(/^\s+|\s+$/g,
"")}};b.setIfUnset=function(a,b){if(a&&b)for(var c in b)b.hasOwnProperty(c)&&!a.hasOwnProperty(c)&&(a[c]=b[c])};var m=Math.floor(1E12*Math.random());b.UUID=function(){e.__qubit_uuid_cnt_43567bdfhgtb4vt5yeh978__||(e.__qubit_uuid_cnt_43567bdfhgtb4vt5yeh978__=(new Date).valueOf());return m+"."+ ++e.__qubit_uuid_cnt_43567bdfhgtb4vt5yeh978__};b.overrideFromLeftToRight=function(a,b){if(a&&b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a};b.geval=function(a){return window&&window.execScript?window.execScript(""===
a?" ":a):e.eval.call(e,a)};var r=[];b.bodyAvailable=function(a){if(document.body){if(r){for(var b=0;b<r.length;b++)try{r[b]()}catch(c){}r=!1}a()}else r.push(a)};b.rmCookiesMatching=function(a){for(var b=d.getAll(),c=0;c<b.length;c++){var f=b[c][0];0===f.match(a)&&d.rm(f)}};var q=[],t=!1,s=!1;b.bodyReady=function(a){if(s)return a&&a(),!0;if(t=t||!(!document.body||"complete"!==document.readyState)){s=!0;for(var b=0;b<q.length;b++)try{q[b]()}catch(c){e.console&&e.console.trace&&e.console.trace(c)}a&&
a()}else a&&q.push(a);return t};var p=e.onload;e.onload=function(a){try{b.bodyReady()}catch(c){try{window.qubit.opentag.Utils.bodyReady()}catch(f){}}var d=!1;try{d=p}catch(e){}d&&d(a)};(function(){var a,c=!1,f=1,d,p,e,m;p=function(a){!0===a&&(f-=1);if(!f||!0!==a&&!c){if(!document.body)return setTimeout(p,1);c=!0;if(!0!==a&&(f-=1,0<f))return;for(;0<d.length;)a=d.shift(),a()}};m=function(){if(!c){try{document.documentElement.doScroll("left")}catch(a){setTimeout(m,1);return}p()}};e=function(){if(!d){d=
[];if("complete"===document.readyState)return setTimeout(p,1);if(document.addEventListener)document.addEventListener("DOMContentLoaded",a,!1),window.addEventListener("load",p,!1);else if(document.attachEvent){document.attachEvent("onreadystatechange",a);window.attachEvent("onload",p);var b=!1;try{b=null===window.frameElement||void 0===window.frameElement}catch(c){}document.documentElement.doScroll&&b&&m()}}};document.addEventListener?a=function(){document.removeEventListener("DOMContentLoaded",a,
!1);p()}:document.attachEvent&&(a=function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",a),p())});(function(a){e();c?setTimeout(a,1):d.push(a)})(function(){t=!0;b.bodyReady()})})()})();(function(){function a(b,c,f){this.collectLogs=!!a.isCollecting();this.collectLocally=f;this.collection=[];this.getPrefix=function(){var a="";c&&("function"===typeof c?a=c(this.ref):c.CLASS_NAME?a=c.CLASS_NAME:c.constructor&&c.constructor.name&&(a=c.constructor.name),a&&(a+=" -> "));
return(b||"")+a}}function l(b,c,f,n,e,m,q,g){var k=d>=g;if(0<=a.getCollectLevel()||k)c=e?[n,q,f]:[c+b.getPrefix()+n,m,f],c[3]=g,b.collect(c,g),k&&b.printMessage.apply(b,c)}var k=h.Define,c=null;k.clazz("qubit.opentag.Log",a);a.LEVEL_FINEST=4;a.LEVEL_FINE=3;a.LEVEL_INFO=2;a.LEVEL_WARN=1;a.LEVEL_ERROR=0;a.LEVEL_NONE=-1;a.MAX_LOG_LEN=1E4;a.prototype.MAX_LOG_LEN=-1;var d=a.LEVEL_NONE,d=a.LEVEL_INFO,b=a.LEVEL_NONE,b=a.LEVEL_FINE,e=!0;a.setLevelFromCookie=function(){var b=h.Cookie.get("qubit.opentag.Log.LEVEL");
if(b&&(b=+b,!isNaN(b)&&0<b)){var c=a.LEVEL_FINE;a.setCollectLevel(b>c?b:c);a.setLevel(+b)}};a.setCollecting=function(a){e=!!a};a.isCollecting=function(){return e||a.COLLECT};a.setLevel=function(a){d=+a};a.setCollectAndLevel=function(b){a.setLevel(b);a.setCollectLevel(b)};a.getLevel=function(){return d};a.setCollectLevel=function(a){b=+a};a.getCollectLevel=function(){return b};var g=[];a.logsCollection=g;a.rePrintAll=function(b,f,p,n){var e=d;void 0!==b&&(d=b);try{if(a.isCollecting()){try{p||c.clear()}catch(m){}var q=
n||a.logsCollection,g=0;for(p=0;p<q.length;p++)(function(c){var n=q[c];c=n[3];void 0!==c&&d>=c&&(g++,f?h.opentag.Timed.setTimeout(function(){void 0!==b&&(d=b);try{a.print.apply(a,n)}finally{d=e}},g*f):a.print.apply(a,n))})(p)}}catch(k){}finally{d=e}};var f=k.global(),m=!!(f.webkitMediaStream||f.webkitURL||f.mozContact);a.isStyleSupported=function(){return m};var r={};a.setConsole=function(a){return c=a||r};a.delayPrint=-1;var q=(new Date).valueOf();a.prototype.printMessage=function(b,c,f,n){if(0<
a.delayPrint){var d=a.delayPrint,e=q-(new Date).valueOf();0<e&&(d+=e);try{h.opentag.Timed.setTimeout(function(){this.print(b,c,f,n)}.bind(this),d)}catch(m){setTimeout(function(){this.print(b,c,f,n)}.bind(this),d)}q=(new Date).valueOf()+d}else this.print(b,c,f,n)};a.prototype.print=function(b,c,f,n){a.print(b,c,f,n)};a.print=function(b,f,p,n){if(!(void 0!==n&&d<n))try{if(c&&c.log)if(f&&a.isStyleSupported())if(p&&c[p])c[p]("%c"+b,f);else c.log("%c"+b,f);else if(p&&c[p])c[p](b);else c.log(b)}catch(e){}};
a.prototype.collect=function(b,c){void 0===c&&(c=a.getCollectLevel());var f=!1,n=this.collectLogs&&a.isCollecting()&&a.getCollectLevel()>=+c;n&&(g.push(b),f=!0);this.collectLocally&&n&&(this.collection.push(b),f=!0);0<a.MAX_LOG_LEN&&g.length>a.MAX_LOG_LEN&&g.splice(0,g.length-a.MAX_LOG_LEN);if(0<a.MAX_LOG_LEN||0<this.MAX_LOG_LEN)n=a.MAX_LOG_LEN,0<this.MAX_LOG_LEN&&(n=this.MAX_LOG_LEN),this.collection.length>n&&this.collection.splice(0,this.collection.length-n);return f?b:null};a.clearAllLogs=function(){try{c.clear()}catch(a){}finally{g.splice(0,
g.length)}};a.getCollectedByLevel=function(a,b){b=b||g;for(var c=[],n=0;n<b.length;n++){var f=b[n];f[0][4]===a&&c.push(f)}return c};a.prototype.rePrint=function(b,c,f){a.rePrintAll(b,c,!f,this.collection)};a.prototype.FINEST=function(b,c){l(this,"FINEST: ",!1,b,c,"color:#CCCCCC;",!1,a.LEVEL_FINEST)};a.prototype.FINE=function(b,c){l(this,"FINE: ",!1,b,c,"color:#999999;",!1,a.LEVEL_FINE)};a.prototype.INFO=function(b,c,f){l(this,"INFO: ","info",b,c,f,f,a.LEVEL_INFO)};a.prototype.WARN=function(b,c){l(this,
"WARN: ","warn",b,c,"color:#26A110;",!1,a.LEVEL_WARN)};a.prototype.ERROR=function(b,c){l(this,"ERROR: ","error",b,c,"color:red;",!1,a.LEVEL_ERROR)};a.setConsole(k.global().console);a.setLevelFromCookie()})();(function(){function a(a){a&&(l.FINEST("Config:"),l.FINEST(a,!0),this._rate=a.rate||10,this._smallestRate=-1,a.start&&this.startPooling(),this.config=a);this.inervals=[];this._lck_obj={};this._binded_pool=this._pool.bind(this)}var l=new h.opentag.Log("Timer -> ");h.Define.clazz("qubit.opentag.Timer",
a);a.prototype.timers=[];a.prototype.startPooling=function(a){a&&this.config.dynamic&&(0>this._smallestRate||this._smallestRate>a)&&(this._smallestRate=Math.min(Math.floor(a/2),1500));this.started||(this.started=!0,setTimeout(this._binded_pool,0))};a.prototype._pool=function(){this.maxFrequent(function(){var a="";this.config&&this.config.name&&(a="["+this.config.name+"]");l.FINEST(a+"Pooling in progress...")},5E3,this._lck_obj);this.callTimers();0!==this.timers.length?setTimeout(this._binded_pool,
this._smallestRate>this._rate?this._smallestRate:this._rate):(this.started=!1,this._smallestRate=-1)};a.prototype.callTimers=function(){this.lastCalled=(new Date).valueOf();for(var a=0;a<this.timers.length;a++){var d=this.timers[a];if((new Date).valueOf()>=d.time){try{d.execute()}catch(b){l.ERROR("Error calling timer: "+b)}this.timers.splice(a,1);--a}}};a.prototype.cancellAll=function(){this.timers=[];l.WARN("Cancelling all stack.")};a.prototype.setRate=function(a){this._rate=a};a.prototype.maxFrequent=
function(a,d,b){b||(a.__maxFrequent__timer_opentag_qubit_=a.__maxFrequent__timer_opentag_qubit_||{},b=a.__maxFrequent__timer_opentag_qubit_);var e=b.____last__timed__max__frequent____;if(!e||(new Date).valueOf()-e>d)e=(new Date).valueOf(),b.____last__timed__max__frequent____=e,a()};a.prototype.runIfNotScheduled=function(a,d,b){b=b||a;if(b.__lastRun__&&(new Date).valueOf()<d+b.__lastRun__)return this.schedule(a,d,b);b.__lastRun__=(new Date).valueOf();a();return!0};a.prototype.schedule=function(a,d,
b){if(b.___scheduled___)return!1;b.___scheduled___=(new Date).valueOf();this.setTimeout(function(){b.___scheduled___=!1;b.__lastRun__=(new Date).valueOf();a()},d);return!0};var k=1;a.prototype.setTimeout=function(a,d){var b={id:k++,time:(new Date).valueOf()+ +d,execute:a};this.timers.push(b);this.startPooling(d);return b};a.prototype.setInterval=function(a,d){l.FINEST("Native wrapper");var b=setInterval(a,d);this.inervals.push(b);return b}})();(function(){h.Define.namespace("qubit.opentag.Timed",
new h.opentag.Timer({rate:37,dynamic:!0}));var a=h.opentag.Timed;a.tillTrue=function(l,k,c){var d=function(){l()?k():a.setTimeout(d,c||33)};d()}})();var v;v=v||{};v.fileLoader={};v.fileLoader.load=function(a,l,k,c,d,b){var e,g,f,m;m=!1;f=function(b){return function(){m||(m=!0,b&&!g&&(g={url:document.location.href}),k(a,g,b))}};try{l&&(e=l(a))}catch(r){e=!1,k(a,"Exception loading pre",!0)}finally{!1!==e&&(l=v.fileLoader.createScriptEl(a,d,!1,b),k&&(l.onload=f(!1),l.onerror=f(!0),l.onreadystatechange=
function(){"complete"!==this.readyState&&"loaded"!==this.readyState||setTimeout(function(){f(!1)()},1)}),c||(c=window.document.getElementsByTagName("head")[0]),c.appendChild(l))}};v.fileLoader.createScriptEl=function(a,l,k,c){var d,b=document.createElement("script");b.type="text/javascript";b.src=v.fileLoader.tidyUrl(a)+(k?"?"+(new Date).getTime():"");!1!==l?(b.async="true",b.defer="true"):(b.async="false",!1!==b.async&&(b.async=!1),b.defer="false",!1!==b.defer&&(b.defer=!1));for(d in c)c.hasOwnProperty(d)&&
b.setAttribute(d,c[d]);return b};v.fileLoader.tidyUrl=function(a){return"http:"===a.substring(0,5)||"https:"===a.substring(0,6)?a:"//"+a};(function(){function a(a){this.log=new h.opentag.Log("Events -> ");this.calls={}}var l=h.Define,k=h.opentag.Utils;a.prototype.on=function(a,d){this.calls[a]||(this.calls[a]=[]);return k.addToArrayIfNotExist(this.calls[a],d)};a.prototype.call=function(a,d){var b=this.calls[a];if(b)for(var e=0;e<b.length;e++)try{b[e](d)}catch(g){this.log.ERROR("Error while running event: "+
g)}};a.prototype.remove=function(a,d){return this.calls[a]?k.removeFromArray(this.calls[a],d):null};a.prototype.removeAll=function(a){var d=0,b;for(b in this.calls)this.calls.hasOwnProperty(b)&&(d+=k.removeFromArray(this.calls[b],a));return d};a.prototype.clear=function(){this.calls={}};l.clazz("qubit.Events",a)})();(function(){function a(a){this.log=new h.opentag.Log("",function(){return this.CLASS_NAME+"["+this.config.name+"]"}.bind(this),"collectLogs");this.config={order:0,include:!0,name:"Filter-"+
k++,script:void 0,session:void 0,restartable:!0};this.runtimeId=l.UUID();this.session=null;if(a){for(var b in a)a.hasOwnProperty(b)&&(this.config[b]=a[b]);a.session&&this.setSession(a.session);this.register(this)}this.events=new h.Events({})}var l=h.opentag.Utils,k=0,c=[];h.Define.clazz("qubit.opentag.filter.BaseFilter",a);a.state={DISABLED:-3,SESSION:-2,PASS:-1,FAIL:0};a.prototype.EVENT_TYPES={RESTART_EVENT:"restart"};a.prototype.prepareForRestart=function(){this.config.restartable&&(this.events.call("restart",
this),this.reset())};a.prototype.onRestart=function(a){this.events.on("restart",a)};a.prototype.reset=function(){this.runtimeId=l.UUID();this.enable()};a.prototype.disable=function(){this.config.disabled=!0};a.prototype.enable=function(){this.config.disabled=!1};a.prototype.match=function(){return!0};a.prototype.setSession=function(a){this.session=a};a.prototype.getSession=function(){return this.session};a.prototype.getState=function(){var c=a.state.PASS;if(this.config.disabled)return a.state.DISABLED;
this.config.script&&(c=this.config.script.call(this,c));isNaN(+c)&&(this.log.WARN("filters should use a numerical state as a return for getState(): BaseFilter.state. Filter will fail. Returned: "+c),c=a.state.FAIL);this.lastState=+c;return c};a.getFilters=function(){return c};a.prototype.register=function(){a.register(this)};a.register=function(a){l.addToArrayIfNotExist(c,a)}})();h.Define.namespace("qubit.opentag.filter.pattern.PatternType",{CONTAINS:"CONTAINS",MATCHES_EXACTLY:"MATCHES_EXACTLY",STARTS_WITH:"STARTS_WITH",
ENDS_WITH:"ENDS_WITH",REGULAR_EXPRESSION:"REGULAR_EXPRESSION",ALL_URLS:"ALL_URLS"});(function(){function a(d){this._lockObject={};var b={patternType:c.CONTAINS,pattern:""};if(d)for(var e in d)d.hasOwnProperty(e)&&(b[e]=d[e]);a.SUPER.call(this,b)}var l=h.opentag.Utils,k=h.opentag.Timed,c=h.opentag.filter.pattern.PatternType;h.Define.clazz("qubit.opentag.filter.URLFilter",a,h.opentag.filter.BaseFilter);a.prototype.PATTERNS=c;a.prototype.getURL=function(a){return a||l.getUrl()};a.prototype.match=function(a){a=
this.getURL(a);var b=!0,e=this.config.pattern;switch(this.config.patternType){case c.CONTAINS:b=0<=a.toLowerCase().indexOf(e.toLowerCase());break;case c.MATCHES_EXACTLY:b=a.toLowerCase()===this.config.pattern.toLowerCase();break;case c.STARTS_WITH:b=0===a.toLowerCase().indexOf(e.toLowerCase());break;case c.ENDS_WITH:b=a.lastIndexOf(e.toLowerCase())+e.length===a.length;break;case c.REGULAR_EXPRESSION:b=(new RegExp(e)).test(a);break;case c.ALL_URLS:b=!0}k.maxFrequent(function(){this.log.FINEST("[ Filter "+
this.config.name+"] Checking if patternType '"+this.config.patternType+"' match '"+e+"' pattern: "+(b?"Yes -> "+b:"No")+", include: "+this.config.include)}.bind(this),1E3,this._lockObject);return b}})();(function(){function a(d){var b={};if(d){for(var e in d)d.hasOwnProperty(e)&&("customStarter"===e&&d[e]?this.customStarter=d[e]:"customScript"===e&&d[e]&&(this.customScript=d[e]),b[e]=d[e]);this.uid="f"+c++}this.tagsToRun=[];a.SUPER.call(this,b)}var l=h.opentag.filter.BaseFilter,k=h.opentag.Utils,
c=0;h.Define.clazz("qubit.opentag.filter.Filter",a,h.opentag.filter.URLFilter);a.prototype.customStarter=function(a,b,c){b(!1)};a.prototype.isSession=function(){return this.config.sessionDisabled||null===this.customStarter&&null===this.customScript?!1:!0};a.prototype.customScript=function(a){return!0};a.prototype.match=function(c){var b=!0;try{this.customScript&&(void 0===this._matchState&&(this._matchState=!!this.customScript(this.getSession())),b=this._matchState)}catch(e){this.log.FINE("Filter match throws exception:"+
e),b=!1}return b&&a.SUPER.prototype.match.call(this,c)};a.prototype.runTag=function(c){k.addToArrayIfNotExist(this.tagsToRun,c);if(this.starterExecuted)this._triggerTag(c);else if(!this._starterWasRun){this._starterWasRun=!0;var b=this.runtimeId,e=function(a){b!==this.runtimeId?this.log.FINE("Filter was cancelled (reset?)."):(this.reRun=a,this.starterExecuted=(new Date).valueOf(),this._processQueuedTagsToRun())}.bind(this);this.customStarter?this.customStarter(this.getSession(),e,c):a.prototype.customStarter.call(this,
this.getSession(),e,c)}};a.prototype._processQueuedTagsToRun=function(){for(var a=0;a<this.tagsToRun.length;a++)this._triggerTag(this.tagsToRun[a])};a.prototype._triggerTag=function(a){!0===this.reRun?a.run():a.runOnce()};a.prototype.getState=function(c){c&&this.setSession(c);c=a.SUPER.prototype.getState.call(this);if(c===l.state.DISABLED)return l.state.DISABLED;c===l.state.PASS&&this.isSession()&&(c=l.state.SESSION);this.config.script&&(c=this.config.script.call(this,c,this.getSession()));return this.lastState=
c};a.prototype.reset=function(){a.SUPER.prototype.reset.call(this);this.starterExecuted=this._starterWasRun=this._matchState=void 0;this.tagsToRun=[];this.reRun=void 0}})();v.GlobalEval={};v.GlobalEval.globalEval=function(a){window.execScript?window.execScript(""===a?" ":a):window.eval.call(window,a)};v.HtmlInjector={};v.HtmlInjector.inject=function(a,l,k,c,d){var b,e,g,f;if(0<=k.toLowerCase().indexOf("<script")){d=document.createElement("div");d.innerHTML="a"+k;e=d.getElementsByTagName("script");
g=[];k=0;for(b=e.length;k<b;k+=1)g.push(e[k]);f=[];k=0;for(b=g.length;k<b;k+=1){e=g[k];var m={attributes:v.HtmlInjector.getAttributes(e)};e.src?m.src=e.src:m.script=e.innerHTML;f.push(m);e.parentNode.removeChild(e)}d.innerHTML&&0<d.innerHTML.length&&(d.innerHTML=d.innerHTML.substring(1));v.HtmlInjector.doInject(a,l,d);v.HtmlInjector.loadScripts(f,0,c,a)}else d=document.createElement("div"),d.innerHTML=k,v.HtmlInjector.doInject(a,l,d),c&&c()};v.HtmlInjector.doInject=function(a,l,k){if(0<k.childNodes.length){for(var c=
document.createDocumentFragment();0<k.childNodes.length;)c.appendChild(k.removeChild(k.childNodes[0]));l?v.HtmlInjector.injectAtStart(a,c):v.HtmlInjector.injectAtEnd(a,c)}};v.HtmlInjector.injectAtStart=function(a,l){0===a.childNodes.length?a.appendChild(l):a.insertBefore(l,a.childNodes[0])};v.HtmlInjector.injectAtEnd=function(a,l,k){k||(k=1);a===document.body&&"complete"!==document.readyState&&50>k?setTimeout(function(){v.HtmlInjector.injectAtEnd(a,l,k+1)},100):a.appendChild(l)};v.HtmlInjector.loadScripts=
function(a,l,k,c){var d,b,e=!1;for(d=a.length;l<d;l+=1)if(b=a[l],b.src){e=!0;break}else v.GlobalEval.globalEval(b.script);e&&v.fileLoader.load(b.src,null,function(){v.HtmlInjector.loadScripts(a,l+1,k,c)},c,!1,b.attributes);k&&l===d&&k()};v.HtmlInjector.getAttributes=function(a){var l,k,c,d,b={};if(a){k=a.attributes;l=k.length;for(a=0;a<l;a++)c=k[a].value,d=k[a].name.toLowerCase(),""===c||"id"!==d&&"class"!==d&&"charset"!==d&&"data-"!==d.substr(0,5)||(b[d]=c);return b}};(function(){function a(){q=
q||{write:document.write,writeln:document.writeln}}function l(){document.write=q.write;document.writeln=q.writeln;q=null}var k=new h.opentag.Log("TagsUtils -> "),c=h.opentag.filter.BaseFilter,d=h.opentag.Utils,b=v.HtmlInjector,e=v.fileLoader,g=h.opentag.filter.Filter,f=function(){};h.Define.clazz("qubit.opentag.TagsUtils",f);var m=!1;f.bodyLoaded=function(){return m?!0:m=!(!document.body||"loading"===document.readyState)};f.bodyAvailable=function(a){return!!document.body};var r={};f.loadScript=function(a){var b=
a.url,c=function(c,n,f){r[b].error=n;f?(k.ERROR("Loading process error:"),k.ERROR(n,!0),r[b].state="failure",a.onerror()):(r[b].state="success",a.onsuccess())};if(r[b]){if(a.noMultipleLoad)return k.FINE(b+" is already loaded, with state: "+r[b].state),c(b,r[b].error,"failure"===r[b].state);r[b].count+=1}else r[b]={count:1,state:null};var n=!a.async,p=f.bodyLoaded();n&&p&&k.WARN("Script configured for synchronous injection while document seems to be already loaded. Secure option applies. Script will be appended in standard way.");
n&&!p?(k.WARN("Adding script element by using document.write. IE will error check fail broken url's."),f.writeScriptURL(b,function(a,n){c(b,n,!a)})):e.load(b,!1,c,a.node,a.async)};var q=null;f.redirectDocumentWritesToArray=function(b,c){c&&c.FINE("redirecting document.write methods...");a();document.write=function(a){b.push(a);c&&c.FINE("Received call from document.write with:"+a)};document.writeln=function(a){b.push(a);c&&c.FINE("Received call from document.writeln with:"+a)}};f.flushDocWritesArray=
function(a,b,c,n,p){if(b&&a){a=a.splice(0,a.length);try{return f.injectHTML(b,c,a.join("\n"),p||x),!0}catch(d){n&&n.ERROR("Loading html caused exception:"+d)}}else return n&&n.ERROR("Flushing location not found!"),!1;p&&p();return!0};f.unlockDocumentWrites=function(){q&&(k&&k.FINEST("Bringing back document.write"),l())};var t=f.prototype.PACKAGE_NAME+".TagsUtils._writeScriptURL_callbacks",s={};h.Define.namespace(t,s,y,!0);var p=0,n=(new Date).valueOf();f.writeScriptURL=function(b,c){var m="_"+n+"_"+
p++,w=t+"."+m,u=!1;s[m]=function(a){u||(u=!0,a?c(!1,"error while loading script "+b):c(!0),s[m]=void 0,delete f.writeScriptURL.callbacks[m])};var g='if(this.readyState === "loaded" || this.readyState === "complete"){ try {'+w+"(true)} catch (ex) {}}",r="try{"+w+"(false)}catch(ex){}",w="try{"+w+"(true)}catch(ex){}";b=e.tidyUrl(b);g="<script onload='"+r+"'  onerror='"+w+"' onreadystatechange='"+g+"' type='text/javascript'  src='"+b+"'>\x3c/script>";q?(l(),document.write(g),a()):document.write(g);d.bodyReady(function(){u||
(k.WARN("URL loaded but cannot tell if successful: "+b),u=!0,c(!0))})};f.writeScriptURL.callbacks={};var w=c.state.SESSION,u=c.state.PASS,A=c.state.FAIL;f.filtersState=function(a,b,n,f){a=a.sort(function(a,b){try{var c=b.config.order,n=a.config.order;isNaN(-n)&&(n=0);isNaN(-c)&&(c=0);return c-n}catch(f){return 0}});var p=u;if(!a||0===a.length)return p;for(var p=null,d=!1,e=!1,m=0,q,k,r=[],l,h,s=0;s<a.length;s++)if(l=a[s],l.setSession(b),l.match())if(q=l.getState(),0<q){if(0===m||m>q)m=q}else q===
c.state.DISABLED?(n.log.WARN("filter with name "+l.config.name+" is disabled"),d=!0):q===w?(e=!0,k=p=l,r.push(l)):p=l;else h=l;a=!1;null===p?(a=!0,p=d?u:A):p=p.config.include?q:q===u?A:u;0<m&&(p===u||a)&&(p=m);if(p===w||p===u&&e){if(!k.config.include)return A;p=w;if(k instanceof g&&k.isSession()&&f)for(f=0;f<r.length;f++)try{r[f].runTag(n)}catch(t){r[f].log.FINEST("trying custom starter failed:"+t)}}n.config.dedupe&&p===u&&h&&h instanceof g&&h.isSession()&&(n.sendDedupePing=!0,p=A);return p};f.injectHTML=
function(a,c,n,f){return b.inject(a,c?0:1,n,f||x)};f.getHTMLLocationForTag=function(a){a=a.prepareLocationObject(a.config.locationObject);switch(a){case "HEAD":a=document.getElementsByTagName("head")[0];break;case "BODY":a=document.body;break;default:a=a?document.getElementById(a):document.body}return a}})();(function(){function a(c){this.config={};this.handlers=[];this.log=new h.opentag.Log("",function(){return this.CLASS_NAME+"["+this.uniqueId+"]"}.bind(this),"collectLogs");this.parameters=null;
this.callHandlersOnRead=!1;if(c){this.uniqueId="BV"+b++;a.ALL_VARIABLES[this.uniqueId]=this;for(var d in c)c.hasOwnProperty(d)&&(this.config[d]=c[d],"value"===d&&(this.value=c.value));(c=a.register(this))&&c!==this&&(c.log.FINEST("Variable config already registered."),c.log.FINEST("Returning existing one."));return c}}function l(){if(g)return!1;for(var b=0;b<e.length;b++)try{e[b].getValue()}catch(m){d.ERROR("Value change update exception: "+m)}c.setTimeout(l,a.CHECK_POLL_RATE);return!0}var k=h.opentag.Utils,
c=h.opentag.Timed,d=new h.opentag.Log("BaseVariable -> "),b=0;h.Define.clazz("qubit.opentag.pagevariable.BaseVariable",a);a.ALL_VARIABLES={};var e=[];a.OBSERVED_VARIABLES=e;a.pageVariables=[];a.register=function(b){if(b instanceof a){for(var c=0;c<a.pageVariables.length;c++){var d=a.pageVariables[c];if(b===d)return d}a.pageVariables.push(b);return b}return null};a.prototype.getValue=function(){this._updateCurrentValue(this.value);return this.currentValue};a.prototype._updateCurrentValue=function(a){return this.valuesAreEqual(a,
this.currentValue)?!1:(this.oldValue=this.currentValue,this.currentValue=a,g&&!this.callHandlersOnRead||this._handleValueChanged(),!0)};a.prototype.getDefaultValue=function(){return this.defaultValue};a.prototype.setDefaultValue=function(a){this.defaultValue=a};a.prototype.exists=function(a){var b=k.variableExists(this.getValue());a&&(b=b||k.variableExists(this.getDefaultValue()));return b};a.prototype.getRelativeValue=function(a,b){var c=this.getValue();k.variableExists(c)||(c=b);var d;a&&!k.variableExists(c)&&
(d=this.getDefaultValue(),k.variableExists(d)&&(c=d));return c};a.prototype.replaceToken=function(a,b,c,d){var e=this.exists();c=e?this.getValue():c;a="\\$\\{"+a+"\\}";return d||c instanceof Array?(d=e?this.getValueAccessorString():k.getAnonymousAcessor(c),b.replace(new RegExp(a,"g"),d)):b.replace(new RegExp(a,"g"),c)};a.prototype.getAccessorString=function(){return"qubit.opentag.pagevariable.BaseVariable.ALL_VARIABLES."+this.uniqueId};a.prototype.getValueAccessorString=function(){return this.getAccessorString()+
".getValue()"};a.prototype.onValueChanged=function(a,b){-1===k.addToArrayIfNotExist(this.handlers,a)&&this.log.FINE("Attached value changed handler: "+a);!1!==b&&this.startObservingForChanges()};a.prototype.deatchOnValueChanged=function(a){0<k.removeFromArray(this.handlers,a)&&this.log.FINE("Dettached value changed handler: "+a)};a.prototype._handleValueChanged=function(){for(var a={oldValue:this.oldValue,newValue:this.currentValue,variable:this},b=0;b<this.handlers.length;b++)try{this.handlers[b](a)}catch(c){this.log.ERROR("Error while calling qprotocol variable change handler: "+
c)}};var g=!0;a.CHECK_POLL_RATE=333;a.prototype.startObservingForChanges=function(){this.addToObservedVariables();g&&(g=!1,l())};a.prototype.stopObservingForChanges=function(){this.removeFromObservedVariables();0===e.length&&(g=!0)};a.prototype.addToObservedVariables=function(){k.addToArrayIfNotExist(e,this)};a.prototype.removeFromObservedVariables=function(){k.removeFromArray(e,this)};a.prototype.getObservedVariables=function(){return e};a.prototype.valuesAreEqual=function(a,b){return a===b}})();
(function(){function a(c){this._lockExprObject={};a.SUPER.apply(this,arguments)}var l=h.opentag.Utils,k=h.opentag.Timed;h.Define.clazz("qubit.opentag.pagevariable.Expression",a,h.opentag.pagevariable.BaseVariable);a.prototype.getValue=function(){var c,d,b=this.value;try{if(b&&-1===b.indexOf("[#]")){var e=l.gevalAndReturn(b);c=e.result;this.failMessage=null;d=e.error}else c=a.parseUVArray(b)}catch(g){d=g}d&&(d="could not read value of expression: \n"+b+"\nexact cause: "+d,this.failMessage!==d&&(this.failMessage=
d),c=null);this._updateCurrentValue(c)&&k.maxFrequent(function(){this.failMessage&&this.log.FINEST(this.failMessage);this.log.FINEST("getting value from expression: "+c)}.bind(this),1E4,this._lockExprObject);return c};a.parseUVArray=function(a){var d=a.split("[#]");a=l.gevalAndReturn(d[0]).result;var b=[],d=d[1];0===d.indexOf(".")&&(d=d.replace(".",""));for(var e=0;e<a.length;e++){var g=l.getObjectUsingPath(d,a[e]);b.push(g)}return b};a.prototype.replaceToken=function(c,d,b,e){this.getValue()instanceof
Array&&(e=!0);return a.SUPER.prototype.replaceToken.call(this,c,d,b,e)}})();(function(){function a(k){a.SUPER.apply(this,arguments)}var l=h.opentag.Utils;h.Define.clazz("qubit.opentag.pagevariable.DOMText",a,h.opentag.pagevariable.BaseVariable);a.prototype.getValue=function(){this.log.FINEST("reading DOM element contents value");var a=l.getElementValue(this.value);this._updateCurrentValue(a);return a}})();(function(){function a(k){a.SUPER.apply(this,arguments);this._lockObject={}}var l=h.opentag.Timed;
h.Define.clazz("qubit.opentag.pagevariable.Cookie",a,h.opentag.pagevariable.BaseVariable);a.prototype.getValue=function(){var a=h.Cookie.get(this.value);l.maxFrequent(function(){this.log.FINEST("reading cookie value: "+a)}.bind(this),2E3,this._lockObject);this._updateCurrentValue(a);return a}})();(function(){function a(k){a.SUPER.apply(this,arguments)}var l=h.opentag.Utils;h.Define.clazz("qubit.opentag.pagevariable.URLQuery",a,h.opentag.pagevariable.BaseVariable);a.prototype.getValue=function(){var a=
l.getQueryParam(this.value);this._updateCurrentValue(a);return a}})();(function(){function a(l){a.SUPER.apply(this,arguments)}h.Define.clazz("qubit.opentag.pagevariable.UniversalVariable",a,h.opentag.pagevariable.Expression)})();var D=!1;try{"object"===typeof module&&module.exports&&(module.exports=J,D=!0)}catch(Q){}!D&&window&&(window.uv=J());var H={},E=[],K=!1,I=!1,G=h.Define.global(),D={allEventsByType:H,subscribe:function(a,l){if(I)G.uv.on(a,l);else E.push({on:[a,l]})},getEventHistory:function(a){return this.allEventsByType[a]},
publish:function(a,l){I?G.uv.emit(a,l):E.push({emit:[a,l]})},connect:function(){L()}};D.connect();h.Define.namespace("qubit.qprotocol.PubSub",D);(function(){function a(c){a.SUPER.apply(this,arguments)}var l=h.qprotocol.PubSub,k=h.opentag.Utils;h.Define.clazz("qubit.opentag.pagevariable.QProtocolVariable",a,h.opentag.pagevariable.BaseVariable);a.prototype.init=function(){if(this.initialized)return!1;this.initialized=(new Date).valueOf();this.callHandlersOnRead=!0;if(!this.handlerAttached){var a=this,
d=this.getValueAndPath(this.value);this.eventName=d[0];this.objectPath=d[1];this.updateValue();l.subscribe(this.eventName,function(b){a.updateValue(b)});this.handlerAttached=(new Date).valueOf()}};a.prototype.getValueAndPath=function(a){var d=a,b;if(d){var e=a.indexOf(":");-1!==e&&(d=a.substring(0,e),b=a.substring(e+1))}return[d,b]};a.prototype.getValue=function(){this.init();return this.currentValue};a.prototype.getEventsHistory=function(){return l.getEventHistory(this.eventName)};a.prototype.updateValue=
function(a){if(!a){var d=this.getEventsHistory();d&&(a=d.current)}d=this.objectPath;a=a&&d?k.getObjectUsingPath(d,a):a;this._updateCurrentValue(a);return a};a.prototype.startObservingForChanges=function(){};a.prototype.stopObservingForChanges=function(){}})();(function(){function a(){}function l(a,b){var c=[];try{var f=a.parameters;if(f)for(var n=0;n<f.length;n++)a.getVariableForParameter(f[n])===b&&c.push(f[n])}catch(d){}return c}var k=h.opentag.Utils,c=h.opentag.TagsUtils,d=h.opentag.Timed,b=h.opentag.pagevariable.BaseVariable,
e=h.opentag.pagevariable.Expression,g=h.opentag.pagevariable.DOMText,f=h.opentag.pagevariable.Cookie,m=h.opentag.pagevariable.URLQuery;h.Define.clazz("qubit.opentag.TagHelper",a);a.injectHTMLForLoader=function(a,b,f,p){if(p=void 0!==p?p:a.getHtml()){var n="END"===a.config.locationPlaceHolder,d=c.getHTMLLocationForTag(a);a.log.FINE("injecting html into page:");a.log.FINE(p);a.injectHTMLNotFinished=!0;try{d?c.injectHTML(d,n,p,function(){a.log.FINE("finished html injection.");a.injectHTMLNotFinished=
!1;if(b)try{b()}catch(c){a.log.ERROR("error while trying to run callback after html injection: "+c)}}.bind(a)):f&&"loading"===document.readyState?(document.write(p),a.injectHTMLNotFinished=!1):(a.injectHTMLFailed=(new Date).valueOf(),a.log.ERROR("location was not found or/and html is told to not to write at runtime or document is already loaded. Please check tag's configuration. Injection cancelled."))}catch(e){a.injectHTMLNotFinished=!1,a.injectHTMLFailed=(new Date).valueOf(),a.log.ERROR("error while trying to inject html: "+
e)}}};a.getAllVariablesWithParameters=function(a){for(var b=a.getPageVariables(),c=[],f=0;f<b.length;f++)for(var n=b[f],d=l(a,n),e=0;e<d.length;e++)c.push({parameter:d[e],variable:n});return c};var r={};a.allParameterVariablesReadyForTag=function(a,b){for(var c=a.log,f=!0,n=a.getPageVariables(),e=0;e<n.length;e++){var m=n[e];try{var g=l(a,m),k=m.exists();!k&&b&&(0<g.length&&(k=!!g[0].defaultValue),k=k||m.exists(!0));var h=m.config.name?m.config.name:"[unnamed]";d.maxFrequent(function(){c.FINEST("Variable '"+
h+"' exists? "+k)},5E3,r);if(!k){f=!1;break}}catch(v){d.maxFrequent(function(){c.ERROR("Error checking variable existence ");c.ERROR([m,v])},5E3,r);f=!1;break}}f&&!r.alreadyNotified&&(r={alreadyNotified:!0});d.maxFrequent(function(){c.FINEST("Checking page variables, variables are ready: "+f);f?(r.clear=!0,c.FINE("Variables ready.")):c.FINE("Variables not ready, waiting...")},2E3,r);return f};a.validateAndGetVariableForParameter=function(b){b.hasOwnProperty("variable")&&b.variable&&(b.variable=a.initPageVariable(b.variable));
return b.variable};a.initPageVariable=function(a){if(!a||a instanceof b)return a;if("string"===typeof a){var c=k.getObjectUsingPath(a);if(c&&c instanceof b)return c}switch(a.type){case "2":return new e(a);case "3":return new m(a);case "4":return new f(a);case "5":return new g(a);case "EPRESSION":return new e(a);case "URL_PARAMETER":return new m(a);case "COOKIE_VALUE":return new f(a);case "DOM_VALUE":return new g(a);default:return new b(a)}}})();(function(){function a(a){this.log=new g("",function(){return this.CLASS_NAME+
"["+this.config.name+"]"}.bind(this),"collectLogs");this.runCounter=this.urlsFailed=this.urlsLoaded=0;this.events=new h.Events({});this._depLoadedHandler=function(){this.dependenciesLoaded()&&this.awaitingDependencies&&(this.log.FINE("All dependencies has run successfuly. Triggering load."),this._triggerLoadingAndExecution())}.bind(this);this.config={name:"Tag-"+e++,async:!0,usesDocumentWrite:!1,timeout:this.LOADING_TIMEOUT,dependencies:[],url:null,urlLocation:null,locationPlaceHolder:"END",locationObject:null,
dontWaitForInjectionLocation:!1,noMultipleLoad:!1,loadDependenciesOnLoad:!1,restartable:!0};this.restartCounter=0;this.cancelled=!1;this.runtimeId=k.UUID();this.delayDocWrite=!1;this.dependencies=[];this._lockObject={count:0};this._lockObjectDepsLoaded={};this.genericDependencies=[];if(a){this.log.FINE("instance...");if(!a.name){var b="Tag-"+e++;this.config.name=b;this.log.WARN("Name was not specified for tag. Assigning auto: "+b)}this.addState("INITIAL");for(var c in a)this.config[c]=a[c];a.genericDependencies&&
(this.genericDependencies=this.genericDependencies.concat(a.genericDependencies));a.dependencies&&(this.dependencies=a.dependencies.concat(this.dependencies));a.PACKAGE&&(this._package=a.PACKAGE);this.onInit()}}function l(){if(this.cancelled)this._handleCancel();else{this.waitForDependenciesFinished=(new Date).valueOf();var a=this._fullBodyNeededAndUnLoaded(),b=this._bodyNeededButNotAvailable();a||b?this.waitForDependenciesFinished=!1:(this.timeoutCountdownStart||(this.timeoutCountdownStart=(new Date).valueOf()),
this.allDependenciesLoaded()?this._markLoadedSuccesfuly():this._loadingOutOfTimeFrames()?(this.loadingTimedOut=(new Date).valueOf(),this.allDependenciesLoaded(!0)?this._markLoadedSuccesfuly():(this.log.WARN("timed out while loading dependencies."),this.addState("TIMED_OUT"),this._markLoadingDependenciesFailed(),this._triggerOnLoadTimeout())):this.waitForDependenciesFinished=!1);if(this.waitForDependenciesFinished)this.addState("LOADED_DEPENDENCIES");else{this._setTimeout(l.bind(this),65);var c=((new Date).valueOf()-
this.loadStarted)/this.getTimeout(),e=Math.ceil(this.getTimeout()/3E3);this._lockObject.curr=c;d.maxFrequent(function(){a&&this.log.FINE("Full body needed. Waiting for full body.");b&&this.log.FINE("Interactive body needed. Waiting for body.");this.log.FINE("Waiting for dependencies, counting... "+this._lockObject.count++ +" ("+e+")")}.bind(this),3E3,this._lockObject)}}}var k=h.opentag.Utils,c=h.opentag.TagsUtils,d=h.opentag.Timed,b=h.opentag.TagHelper,e=0,g=h.opentag.Log;h.Define.clazz("qubit.opentag.GenericLoader",
a);a.prototype.EVENT_TYPES={AFTER_EVENT:"after",BEFORE_EVENT:"before",RESTART_EVENT:"restart"};a.prototype.onInit=x;a.prototype.LOADING_TIMEOUT=5E3;a.prototype.getHtml=function(){return this.config.html?this.config.html:this.htmlContent?k.trim(this.htmlContent):null};a.prototype._executeScript=function(){this.log.INFO("executing main script...");var a=!1;try{this.script(),a=!0,this.log.INFO("executed without errors.")}catch(b){this.addState("EXECUTED_WITH_ERRORS"),this.executedWithErrors=(new Date).valueOf(),
this.log.ERROR("Error while executing: "+b),this.log.ERROR("There was an error while executing instance of tag: "+this.CLASS_NAME+" from package: "+this.PACKAGE_NAME),this.log.ERROR(b,!0),this._onError(b)}finally{this._onExecute(a)}};a.prototype.getTimeout=function(){return this._getTimeout()};a.prototype._getTimeout=function(a){var b=+this.config.timeout,c=this.dependencies;if(-1!==b&&0<c.length){var d=0;a=a||[];if(-1===k.indexInArray(a,this)){a[a.length]=this;for(var e=0;e<c.length;e++){var g=c[e]._getTimeout(a);
g>d&&(d=g)}0<d&&(b+=d)}else return 0}return b};a.prototype._onExecute=function(a){this.onExecute(a)};a.prototype.onExecute=x;a.prototype._flushDocWrites=function(a){var b=!0;this._docWriteNotFlushed=!1;try{var d=c.getHTMLLocationForTag(this);d&&this._securedWrites&&0<this._securedWrites.length&&(this.log.FINE("flushing document.write proxy array"),this.log.FINE("flushing: "+this._securedWrites.join("\n")),(b=c.flushDocWritesArray(this._securedWrites,d,"END"===this.config.locationPlaceHolder,this.log,
a))?this._docWriteFlushed=(new Date).valueOf():this._docWriteNotFlushed=(new Date).valueOf())}catch(e){this.log.ERROR("Unexpected exception during flushing! "+e),this._onError(e)}a&&a();this._securedWrites&&0<this._securedWrites.length&&(b=!1,this._docWriteNotFlushed=(new Date).valueOf());return b};a.prototype.log=x;a.prototype.finished=function(){return!!this.runIsFinished};a.prototype.script=function(){this.log.INFO("Script run.")};a.prototype.before=function(){this.log.FINE("running before handler...");
this.beforeRun=(new Date).valueOf();try{this.events.call("before",this)}catch(a){this.log.ERROR("onBefore error: "+a),this._onError(a)}};a.prototype.onBefore=function(a){this.events.on("before",a)};a.prototype.after=function(a){this.log.FINE("running after...");this.afterRun=(new Date).valueOf();try{this.events.call("after",{success:a,tag:this})}catch(b){this.log.ERROR("onAfter error: "+b),this._onError(b)}};a.prototype.onAfter=function(a){this.events.on("after",a)};a.prototype.runOnce=function(){this._runOnceTriggered||
this.scriptExecuted||(this._runOnceTriggered=(new Date).valueOf(),this.run())};a.CANCEL_ALL=!1;a.prototype.run=function(){if(!isNaN(this.config.runningLimit)&&this.config.runningLimit<=this.runCounter)return this.log.FINE("running has been stopped as limit is reached."),!1;if(this.cancelled||a.CANCEL_ALL)return this._handleCancel(),!1;if(this.isRunning)return this.log.FINE("loader is currently in progress, try again later."),!1;this.lastRun&&(this.log.FINE("Running again. Run count: "+(this.runCounter+
1)),this.reset());this.lastRun=this.isRunning=(new Date).valueOf();this.runCounter++;this._ignoreDeps=!!this.ignoreDependencies;return this._ignoreDeps||this.dependenciesLoaded()?this._triggerLoadingAndExecution():(this.log.FINE("Dependencies (other loaders) not ready. Attaching handlers."),this._attachDepsEventsToContinue(),!1)};a.prototype._triggerLoadingAndExecution=function(){this.awaitingDependencies=-(new Date).valueOf();this.load();this._ignoreDeps?this.execute():this.waitForDependenciesAndExecute();
return!0};a.prototype._attachDepsEventsToContinue=function(){this.log.FINE("Attaching success events to dependencies...");this.awaitingDependencies=(new Date).valueOf();for(var a=this.dependencies,b=0;b<a.length;b++)try{a[b].events.on("success",this._depLoadedHandler)}catch(c){this.log.WARN("Cannot set event for dependency -> ",a[b]),this.log.WARN("Exception: ",c)}this.log.FINE("Attached "+a.length+" handlers.")};a.prototype.dependenciesLoaded=function(){for(var a=this.dependencies,b=0;b<a.length;b++)if(a[b]!==
this&&!(0<+a[b].scriptExecuted))return!1;return!0};a.prototype._setTimeout=function(a,b){this._wasTimed=(new Date).valueOf();var c=this.runtimeId,e=function(){if(this.runtimeId===c)return a()}.bind(this);return d.setTimeout(e,b)};a.prototype._handleCancel=function(){this.addState("CANCELLED");this.log.INFO("loader is cancelled.");try{this.onCancel()}catch(a){this.log.ERROR("Exception at onCancel"+a),this._onError(a)}};a.prototype.waitForDependenciesAndExecute=function(){this.loadedDependencies?this.execute():
this.loadingDependenciesFailed?(this.log.INFO("script execution failed before running: dependencies failed to load."),this._markFailure(),this._markFinished()):this._setTimeout(this.waitForDependenciesAndExecute.bind(this),30)};a.prototype.execute=function(){this.log.FINE("entering execute...");this._triggerExecution()};a.prototype._triggerExecution=function(){if(this.cancelled)this._handleCancel();else if(!this.scriptExecuted){var a=!0;if(this.shouldWaitForDocWriteProtection())a=!1;else{if(!this._beforeEntered){this._beforeEntered=
(new Date).valueOf();a=!1;try{a=this.before()}catch(b){this.log.ERROR("`before` thrown an exception"),this.log.ERROR(b,!0),this._onError(b)}if(a){this.log.INFO("before callback cancelled execution.");this._markFailure();this._markFinished();return}}a=this.loadExecutionURLsAndHTML(this._triggerExecution.bind(this))}if(!this.scriptExecuted)if(this.unexpectedFail&&(a=!0),a){this._flushDocWrites();this.scriptLoadingFailed||this.injectHTMLFailed||this.unexpectedFail?this._markFailure():(this.log.FINE("Executing..."),
this.scriptExecuted=(new Date).valueOf(),this.addState("EXECUTED"),this._executeScript());if(this.cancelled)return this._handleCancel(),!1;a=0<this.scriptExecuted;try{this.afterRun||(this.afterRun=(new Date).valueOf(),this.after(a))}catch(c){this.executedWithErrors=(new Date).valueOf()}this.executedWithErrors||a&&this.events.call("success");this._flushDocWrites();this._markFinished();this.log.INFO("* stopped ["+(0<this.scriptExecuted?"executed":"not executed")+"] *")}else this._setTimeout(this._triggerExecution.bind(this),
30)}};a.prototype._markFailure=function(){this.log.INFO("Script execution failed.");this.scriptExecuted=-(new Date).valueOf();this.addState("FAILED_TO_EXECUTE")};a.prototype._markFinished=function(){this.runIsFinished=(new Date).valueOf();this.isRunning=!1;a.LOCK_DOC_WRITE===this&&(this._flushDocWrites(),c.unlockDocumentWrites(),a.LOCK_DOC_WRITE=!1);this.onFinished(!0)};a.prototype.onFinished=x;a.prototype.onCancel=x;a.prototype.onFinished=x;a.prototype.shouldWaitForDocWriteProtection=function(){if(this.willSecureDocumentWrite())if(!a.LOCK_DOC_WRITE)a.LOCK_DOC_WRITE=
this,this._secureWriteAndCollectForExecution();else if(a.LOCK_DOC_WRITE!==this)return this._lockedDocWriteInformed||(this._lockedDocWriteInformed=(new Date).valueOf(),this.log.WARN("Tag will wait till document.write be available."),this.log.FINE(a.LOCK_DOC_WRITE,!0)),!0;return!1};a.prototype.runWithoutDependencies=function(){this.ignoreDependencies=!0;this.run()};a.prototype.loadExecutionURLsAndHTML=function(a){if(this.cancelled)return this._handleCancel(),!0;this._loadExecutionURLsAndHTMLInformed||
(this._loadExecutionURLsAndHTMLInformed=!0,this.log.INFO("tag is loaded, trying execution..."));this._triggerURLsLoading(a);return this.loadURLsNotFinished||(this._flushDocWrites(),this._triggerHTMLInjection(),this._flushDocWrites(),this.injectHTMLNotFinished||(this._flushDocWrites(),this.log.INFO("url and html awaiting has ended..."),this._docWriteNotFlushed))?!1:(this._docWriteFlushed&&this.log.INFO("flushed document.write..."),!0)};a.prototype._triggerURLsLoading=function(a){!this._urlLoadTriggered&&
this.config.url&&(this._urlLoadTriggered=!0,this.log.INFO("tag has url option set to: "+this.config.url),this.log.INFO("loading url and delaying execution till link is loaded"),this.loadURLs(!1,a))};a.prototype._triggerHTMLInjection=function(){!this._injectHTMLTriggered&&this.getHtml()&&(this._injectHTMLTriggered=!0,this.log.FINE("tag has html option set to: "+this.getHtml()),this.log.INFO("injecting html and delaying execution till is ready"),this.injectHTML())};a.prototype.STATE={INITIAL:0,STARTED:1,
LOADING_DEPENDENCIES:2,LOADED_DEPENDENCIES:4,LOADING_URL:8,LOADED_URL:16,EXECUTED:32,EXECUTED_WITH_ERRORS:64,FAILED_TO_LOAD_DEPENDENCIES:128,FAILED_TO_LOAD_URL:256,FAILED_TO_EXECUTE:512,TIMED_OUT:1024,UNEXPECTED_FAIL:2048,CANCELLED:4096};a.prototype.addState=function(a){if(this.STATE.hasOwnProperty(a)){this.state|=this.STATE[a];try{this.onStateChange(a)}catch(b){this.log.ERROR(b),this._onError(b)}}};a.prototype.onStateChange=x;a.prototype.cancel=function(){this.cancelled=(new Date).valueOf()};a.prototype.unCancel=
function(){this.cancelled=!1};a.prototype.state=a.prototype.STATE.INITIAL;a.prototype._markLoadedSuccesfuly=function(){this.loadedDependencies=(new Date).valueOf();this.onAllDependenciesLoaded()};a.prototype._secureWriteAndCollectForExecution=function(){this._securedWrites||(this._securedWrites=[],c.redirectDocumentWritesToArray(this._securedWrites,this.log))};a.prototype._markLoadingDependenciesFailed=function(){this.addState("FAILED_TO_LOAD_DEPENDENCIES");this.loadingDependenciesFailed=(new Date).valueOf()};
a.prototype.allDependenciesLoaded=function(a,b){return 0===this.getDependenciesToBeLoaded(a,b).length};a.prototype.getDependenciesToBeLoaded=function(a,b){var c=b||[];this.injectionLocationReady()||c.push("injection location");var e,g=this.dependencies;for(e=0;e<g.length;e++)g[e]!==this&&(0<+g[e].scriptExecuted||c.push("dependant Tag with name -> "+(g[e].config?g[e].config.name:"anonymous")));for(e=0;e<this.genericDependencies.length;e++)this.genericDependencies[e](this)||c.push("this.genericDependencies["+
e+"] (index: "+e+")");""!==c&&d.maxFrequent(function(){var a=c.join(", ");a?this.log.FINE("Dependencies check: Waiting for: "+a):this.log.FINE("Dependencies check: No basic dependencies.")}.bind(this),5E3,this._lockObjectDepsLoaded);return c};a.prototype.docWriteAsksToWaitForBody=function(){return!(!this.delayDocWrite||!this.config.usesDocumentWrite)};a.prototype._bodyNeededButNotAvailable=function(){return this._dontWaitForInjections()?!1:this._isBodyLocationNeeded()&&!c.bodyAvailable()};a.prototype._isBodyLocationNeeded=
function(){return this.isLoadingAsynchronously()?this._isBodyLocationSet()?!0:"HEAD"===this.config.locationObject&&"END"===this.config.locationPlaceHolder:!1};a.prototype._isBodyLocationSet=function(){var a=this.config.locationObject;return!a||"BODY"===a};a.prototype._fullBodyNeededAndUnLoaded=function(){if(this._dontWaitForInjections())return!1;var a=!1;this._isBodyLocationNeeded()&&(a="END"===this.config.locationPlaceHolder);return(a=a||this.fullbodyNeeded||this.docWriteAsksToWaitForBody())&&!k.bodyReady()};
a.prototype._dontWaitForInjections=function(){return this.config.dontWaitForInjectionLocation||this.dontWaitForInjectionLocation||a.dontWaitForInjectionLocation};a.prototype.injectionLocationReady=function(){return this._dontWaitForInjections()?!0:this._fullBodyNeededAndUnLoaded()?!1:this.isLoadingAsynchronously()?!!c.getHTMLLocationForTag(this):!0};a.prototype._loadingOutOfTimeFrames=function(){return 0>this.getTimeout()?!1:(new Date).valueOf()-this.timeoutCountdownStart>this.getTimeout()};a.prototype.loadDependencies=
function(){this._loadDependencies()};a.prototype.addClientDependenciesList=function(a,b){return this.addDependenciesList(a,h.Define.clientSpaceClasspath())};a.prototype.addDependenciesList=function(b,c){if(b&&0!==b.length){this.failedDependenciesToParse||(this.failedDependenciesToParse=[]);for(var d=this.dependencies,e=0;e<b.length;e++){var g=b[e],l=!1;if(g instanceof a)d.push(g);else if("string"===typeof g){var p=g;c&&(g=c+"."+g);var n=k.getObjectUsingPath(g);n?n instanceof a?d.push(n):l=!0:this.failedDependenciesToParse.push(p)}else l=
!0;l&&(this.log.WARN("Bad object type passed to deps, ignoring."),this.badDepsObjects=this.badDepsObjects||[],k.addToArrayIfNotExist(this.badDepsObjects,g))}}};a.prototype._loadDependencies=function(a){a=a||[];var b=this.dependencies;if(-1===k.indexInArray(a,this)){a[a.length]=this;for(var c=0;c<b.length;c++)b[c].load(a)}};a.prototype.onError=x;a.prototype._onError=function(a){try{this.onError(a)}catch(b){}};a.prototype._triggerOnLoadTimeout=function(){this.onLoadTimeout()};a.prototype.onLoadTimeout=
x;a.prototype.onScriptsLoadSuccess=x;a.prototype.onScriptLoadError=x;a.prototype.onAllDependenciesLoaded=x;a.prototype.onBeforeLoad=null;a.prototype.load=function(){if(!this.loadStarted){this.loadStarted=(new Date).valueOf();try{if(this.onBeforeLoad)this.onBeforeLoad()}catch(a){this.log.ERROR("onBeforeLoad error: "+a),this._onError(a)}this.addState("LOADING_DEPENDENCIES");this.log.INFO("Load started.");try{!this._ignoreDeps&&this.config.loadDependenciesOnLoad&&this.loadDependencies()}catch(b){throw this.log.ERROR("loadDependencies: unexpected exception occured: \n"+
b+"\ntrying to finish... "),b;}l.call(this)}};a.prototype._singleUrlLoadHandler=function(a,b,c){++this.urlsLoaded;a||++this.urlsFailed;if(this.urlsLoaded===b.length)if(this.loadURLsNotFinished=!1,a&&0===this.urlsFailed){this.log.INFO("succesfully loaded "+this.urlsLoaded+" urls.");this.addState("LOADED_URL");this.urlsLoaded=(new Date).valueOf();try{c&&c(!0)}catch(d){this.log.ERROR("Callback error:"+d),this._onError(d)}finally{this.onScriptsLoadSuccess()}}else{a="error loading urls. Failed "+this.urlsFailed;
this.log.ERROR(a);this._onError(a);this.addState("FAILED_TO_LOAD_URL");this.urlsLoaded=-(new Date).valueOf();try{this.scriptLoadingFailed=!0,c&&c(!1)}catch(e){this.log.ERROR("Callback error:"+e),this._onError(e)}finally{this.onScriptLoadError(a)}}};a.prototype.loadURLs=function(a,b){var c=a||this.config.url;this.addState("LOADING_URL");this.log.FINE("loading URL(s) ...");try{!c||c instanceof Array||(c=[c]);for(var d=0;d<c.length;d++){this.loadURLsNotFinished=!0;var e=c[d],e=this.prepareURL(e);this.log.FINE("loading URL: "+
e+" ...");this.loadURL(e,function(a){this._singleUrlLoadHandler(a,c,b)}.bind(this))}}catch(g){this.log.ERROR("loadURLs thrown unexpected exception! : "+g),this.loadURLsNotFinished=!1,this.addState("UNEXPECTED_FAIL"),this.unexpectedFail=(new Date).valueOf(),this._onError(g)}};a.prototype.prepareLocationObject=function(a){return a};a.prototype.prepareURL=function(a){return a};a.prototype.prepareHTML=function(a){return a};a.prototype.loadURL=function(a,b,e){this.addState("LOADING_URL");c.loadScript({onsuccess:function(){this.log.FINE("succesfully loaded "+
a);try{b&&b(!0)}catch(c){this.log.ERROR("error at callback for "+a+":"+c)}}.bind(this),onerror:function(){this.log.ERROR("error loading "+a);try{b&&b(!1)}catch(c){this.log.ERROR("error at callback for error at "+a+":"+c)}}.bind(this),url:a,node:e||this.config.urlLocation,async:this.isLoadingAsynchronously(),noMultipleLoad:this.config.noMultipleLoad})};a.prototype.onRestart=function(a){this.events.on("restart",a)};a.prototype.prepareForRestart=function(){if(this.config.restartable){var a=this.restartCounter+
1;this.events.call("restart",this);this.reset();this.restartCounter=a}};a.prototype.restart=function(){this.config.restartable&&(this.prepareForRestart(),this.run())};a.prototype.reset=function(){this.log.FINE("resetting.");this._securedWrites=this.delayDocWrite=this.scriptLoadingFailed=this.scriptExecuted=this.runIsFinished=this.loadingTimedOut=this.loadingDependenciesFailed=this.loadedDependencies=this.loadURLsNotFinished=this.loadStarted=this.injectHTMLFailed=this.filtersRunTriggered=this.beforeRun=
this.afterRun=this._urlLoadTriggered=this._runOnceTriggered=this._lockedDocWriteInformed=this._loadExecutionURLsAndHTMLInformed=this._injectHTMLTriggered=void 0;this.state=0;this.unexpectedFail=void 0;this.urlsLoaded=this.urlsFailed=0;this.timeoutCountdownStart=this.awaitingDependencies=this._beforeEntered=this.cancelled=this.lastRun=this.isRunning=this.waitForDependenciesFinished=void 0;this.restartCounter=0;this.runtimeId=k.UUID();this.addState("INITIAL")};a.prototype.isLoadingAsynchronously=function(){return this._wasTimed?
!0:!(!this.config.async&&!this.forceAsynchronous)};a.prototype.willSecureDocumentWrite=function(){return this.config.usesDocumentWrite&&this.isLoadingAsynchronously()};a.prototype.injectHTML=function(a){var c=!this.docWriteAsksToWaitForBody(),e=this.prepareHTML(this.getHtml());e&&b.injectHTMLForLoader(this,a,c,e)};a.prototype.clone=function(){return new a(this.config)}})();(function(){function a(b){k.setIfUnset(b,{filterTimeout:b&&b.filterTimeout||this.FILTER_WAIT_TIMEOUT,PACKAGE:b&&b.PACKAGE,dedupe:!1,
needsConsent:!1,inactive:!1,variables:null,runner:null,disabled:!1,locked:!1,reRunOnVariableChange:!1});a.SUPER.apply(this,arguments);this.namedVariables={};this._runtimeMarkers={};this.parameters=[];this.filters=[];this.owningContainer=this.session=null;this.oldDedupePingSent=this.dedupePingSent=this.oldPingSent=this.pingSent=!1;this.reRunCounter=0;if(b){this.addState("INITIAL");try{a.register(this)}catch(c){this.log.WARN("Problem with registering tag "+this.config.name),this.log.WARN(c,!0)}this.setupConfig(b);
this.uniqueRefString=null;if(b.init)try{b.init.call(this,b)}catch(e){this.log.ERROR("init call failed:"+e)}this.onTagInit();this.handleVariableChange=this._handleVariableChange.bind(this)}}function l(a,b){var c=a.namedVariables,d=e.initPageVariable(c[b]);return c[b]=d}var k=h.opentag.Utils,c=h.opentag.TagsUtils,d=h.opentag.filter.BaseFilter,b=h.opentag.GenericLoader,e=h.opentag.TagHelper,g=h.opentag.pagevariable.BaseVariable,f=h.Cookie,m=h.Define,r=new h.opentag.Log("BaseTag -> ");m.clazz("qubit.opentag.BaseTag",
a,b);a.prototype.setupConfig=function(a){if(a){a.filters&&this.addFilters(a.filters);a.parameters&&this.addParameters(a.parameters);if(a.variables)for(var b in a.variables)if(a.variables.hasOwnProperty(b)){var c=this.getParameterByTokenName(b);if(c){var e=a.variables[b];c.variable=e;void 0!==e.defaultValue&&(c.defaultValue=e.defaultValue);void 0!==e.uv&&(c.uv=e.uv)}}a.locked&&this.lock()}};a.prototype.valueForToken=function(a,b){var c=this.getParameterByTokenName(a);if(c)return void 0===b&&this.loadingTimedOut&&
(b=!0),this.getParameterValue(c,b);if((c=this.namedVariables)&&c[a]&&(c=l(this,a)))return c.getRelativeValue(b)};a.prototype.addParameters=function(a){this.parameters=this.parameters.concat(a)};a.prototype.LOADING_TIMEOUT=5E3;a.prototype.FILTER_WAIT_TIMEOUT=-1;a.prototype._isVariable=function(a){return null!==a&&void 0!==a};a.prototype.run=function(){if(this.destroyed)throw"Tag is destroyed.";this.resolveAllDynamicData();this.runPostInitialisationSection();var a=this.parameters;if(a)for(var b=0;b<
a.length;b++){var c=this.getVariableForParameter(a[b]);if(!this._isVariable(c)){this.log.ERROR("Parameter is missing variable!");this.log.ERROR(a[b]);this._markLoadingDependenciesFailed();this._markFinished();return}}if(this.config.runner){a=!1;try{this.log.INFO("Running custom runner..."),this.addState("AWAITING_CALLBACK"),a=this._runner=(new Date).valueOf(),this.config.runner.call(this)}catch(e){this.log.ERROR("Error while running custom runner: "+e)}return a}this._runner=!1;return this.start()};
a.prototype.lock=function(){this.locked=!0;this._unlock=null};a.prototype.unlock=function(){this.locked=!1;this._unlock&&(this._unlock(),this._unlock=!1)};a.prototype.start=function(){return this.locked?(this.log.WARN("Tag is locked. Running delegated."),this._unlock=function(){return a.SUPER.prototype.run.call(this)}.bind(this),!1):a.SUPER.prototype.run.call(this)};a.prototype.startOnce=function(){return this.locked?(this._unlock=function(){return a.SUPER.prototype.runOnce.call(this)}.bind(this),
!1):a.SUPER.prototype.runOnce.call(this)};a.prototype.getFilters=function(){return this.filters};a.prototype.runOnceIfFiltersPass=function(){this._runOnceIfFiltersPassTriggered||this.scriptExecuted||(this._runOnceIfFiltersPassTriggered=(new Date).valueOf(),this.runIfFiltersPass())};a.prototype.runIfFiltersPass=function(){if(this.destroyed)throw"Tag is destroyed.";this.resolveAllDynamicData();this.runPostInitialisationSection();var a=this.filtersState(!0);this.addState("FILTER_ACTIVE");this.filtersRunTriggered||
(this.filtersRunTriggered=(new Date).valueOf());if(a===d.state.SESSION)this.addState("AWAITING_CALLBACK"),this.log.FINE("tag is in session and will be manually triggered by custom starter"),this.awaitingCallback=(new Date).valueOf();else if(a===d.state.PASS){this.filtersPassed=(new Date).valueOf();this.log.FINE("tag passed filters tests");try{this.onFiltersPassed()}catch(b){this.log.ERROR("error running onFiltersDelayed:"+b)}this.run()}else if(a===d.state.FAIL)this.log.FINE("tag failed to pass filters"),
this._markFiltersFailed(),this._markFinished();else if(0<a){var c=this.config.filterTimeout;if(0>c||(new Date).valueOf()-this.filtersRunTriggered>c){if(!this._awaitingForFilterInformed){this.log.INFO("filters found indicating for tag to wait for applicable conditions - waiting...");this._awaitingForFilterInformed=(new Date).valueOf();try{this.onFiltersDelayed()}catch(e){this.log.ERROR("error running onFiltersDelayed:"+e)}}this._setTimeout(this.runIfFiltersPass.bind(this),a)}else this._markFiltersFailed(),
this._markFinished(),this.filtersRunTimedOut=(new Date).valueOf(),this.log.WARN("awaiting for filters timed out.")}try{this.onFiltersCheck(a)}catch(p){this.log.ERROR(p)}return a};a.prototype._markFiltersFailed=function(){this.addState("FILTERS_FAILED");this.filtersPassed=-(new Date).valueOf()};a.prototype.STATE={INITIAL:0,FILTER_ACTIVE:1,AWAITING_CALLBACK:2,FILTERS_FAILED:4,STARTED:8,LOADING_DEPENDENCIES:16,LOADED_DEPENDENCIES:32,LOADING_URL:64,LOADED_URL:128,EXECUTED:256,EXECUTED_WITH_ERRORS:512,
FAILED_TO_LOAD_DEPENDENCIES:1024,FAILED_TO_LOAD_URL:2048,FAILED_TO_EXECUTE:4096,TIMED_OUT:8192,UNEXPECTED_FAIL:16384,CANCELLED:32768};a.prototype.addState=function(b){a.SUPER.prototype.addState.call(this,b);try{a.onStateChange(this)}catch(c){this.log.ERROR(c)}this.stateStack=[];b=this.STATE;var e=this.state,d=this.stateStack;e&b.INITIAL&&d.push("Initial state.");e&b.FILTER_ACTIVE&&d.push("Tag running with filters pass triggered.");e&b.FILTERS_FAILED&&d.push("Filters failed to pass.");e&b.AWAITING_CALLBACK&&
d.push("Awaiting callback to run this tag. Not pooling.");e&b.STARTED&&d.push("Tag is initialised and loading has been started.");e&b.LOADING_DEPENDENCIES&&d.push("Dependencies are being loaded.");e&b.LOADED_DEPENDENCIES&&d.push("Dependencies loading process has been finished.");e&b.LOADING_URL&&d.push("External URL is being loaded.");e&b.LOADED_URL&&d.push("External URL has been loaded.");e&b.EXECUTED&&d.push("Main script has been executed.");e&b.EXECUTED_WITH_ERRORS&&d.push("Main script has been executed but errors occured.");
e&b.FAILED_TO_LOAD_DEPENDENCIES&&d.push("Dependencies has failed to load.");e&b.FAILED_TO_LOAD_URL&&d.push("URL location failed to load.");e&b.FAILED_TO_EXECUTE&&d.push("Script failed to execute.");e&b.TIMED_OUT&&d.push("Script timed out awaiting for dependencies.");e&b.UNEXPECTED_FAIL&&d.push("Script occured UNEXPECTED exception and is failed.");e&b.CANCELLED&&d.push("Tag has been cancelled.")};a.prototype.onTagInit=x;a.prototype.postInitialisationSection=x;a.onStateChange=x;a.prototype.onFiltersDelayed=
x;a.prototype.onFiltersPassed=x;a.prototype.onFiltersCheck=x;a.prototype.state=a.prototype.STATE.INITIAL;a.prototype.arePageVariablesLoaded=function(a){return e.allParameterVariablesReadyForTag(this,a)};a.prototype.getDependenciesToBeLoaded=function(b,c){var e=c||[];this.arePageVariablesLoaded(b)||e.push("page variables");return a.SUPER.prototype.getDependenciesToBeLoaded.call(this,b,e)};a.prototype.resolveAllDynamicData=function(){this.resolvePageVariables();this.resolveDependencies();this.resolveFilters()};
a.prototype.resolveDependencies=function(){var a=this.failedDependenciesToParse;a&&(this.failedDependenciesToParse=null,this.addDependenciesList(a,m.clientSpaceClasspath()));return this.dependencies};a.prototype.addClientVariablesMap=function(a){return this.unresolvedClientVariablesMap=this._addVariablesMap(a,m.clientSpaceClasspath())};a.prototype.resolvePageVariables=function(){var a=this.unresolvedClientVariablesMap;a&&(this.unresolvedClientVariablesMap=null,this.addClientVariablesMap(a));if(a=
this.unresolvedVariablesMap)this.unresolvedVariablesMap=null,this.addVariablesMap(a);return this.getPageVariables()};a.prototype.addVariablesMap=function(a){return this.unresolvedVariablesMap=this._addVariablesMap(a)};a.prototype._addVariablesMap=function(a,b){if(a){var c={},e=this.namedVariables,d;for(d in a)if(a.hasOwnProperty(d)){var p=a[d];if(p instanceof g)e[d]=p;else if("string"===typeof p){var f=p;b&&(p=b+"."+p);var m=k.getObjectUsingPath(p);m?e[d]=m instanceof g?m:p:c[d]=f}else this.log.ERROR("Added variable is of wrong type!"),
this.log.ERROR(p)}return c}};a.prototype.prepareURL=function(a){return this.replaceTokensWithValues(a)};a.prototype.prepareLocationObject=function(a){return this.replaceTokensWithValues(a)};a.prototype.prepareHTML=function(a){a&&(a=this.replaceTokensWithValues(a));return a};a.prototype._executeScript=function(){if(this.config&&this.config.script)if("function"===typeof this.config.script)this.script=this.config.script;else{var b=this.replaceTokensWithValues(String(this.config.script));this.script=
k.expressionToFunction(b).bind(this)}a.SUPER.prototype._executeScript.call(this)};a.prototype.replaceTokensWithValues=function(a){if(!a||-1===a.indexOf("${"))return a;var b=this.parameters;if(b)for(var c=0;c<b.length;c++){var e=this.getVariableForParameter(b[c]);if(e){var d=b[c].token,p=this.valueForToken(d);a=e.replaceToken(d,a,p)}}return a};a.prototype.getParameter=function(a){var b=this.parameters,c=null;if(b)for(var e=0;e<b.length;e++)b[e].name===a&&(c=b[e]);return c};a.prototype.setParameterValueByTokenName=
function(a,b){var c=this.getParameterByTokenName(a);return null!==c?(c.variable={value:b},!0):!1};a.prototype.getParameterValue=function(a,b){var c="string"===typeof a?this.getParameter(a):a;if(c){var e=this.getVariableForParameter(c);if(e)try{var d;b&&""!==c.defaultValue&&(d=k.gevalAndReturn(c.defaultValue).result);return d=e.getRelativeValue(b,d)}catch(p){this.log.ERROR("error while trying to resolve variable value:"+p),this.log.ERROR("Variable defaults string is invalid: "+c.defaultValue)}}};a.prototype.filtersState=
function(a){return c.filtersState(this.filters,this.session,this,a)};a.prototype.addFilter=function(a){k.addToArrayIfNotExist(this.filters,a)};a.prototype.addFilters=function(a){for(var b=0;b<a.length;b++)this.addFilter(a[b])};a.prototype.addClientFiltersList=function(a){return this.unresolvedClientFilterClasspaths=this.addFiltersList(a,m.clientSpaceClasspath())};a.prototype.resolveFilters=function(){var a=this.unresolvedClientFilterClasspaths;a&&(this.unresolvedClientFilterClasspaths=null,this.addClientFiltersList(a));
return this.filters};a.prototype.addFiltersList=function(a,b){for(var c=[],e=0;e<a.length;e++)try{var p=a[e],f=p,g=null;"string"===typeof p&&(g=p,b&&(p=b+"."+p),p=k.getObjectUsingPath(p));"function"===typeof p&&(p=new p);p||this.log.FINE("Filter "+f+" does NOT exists.");!p instanceof d&&(this.log.ERROR("Not a filter! ",p),p=null);p?this.addFilter(p):g&&k.addToArrayIfNotExist(c,g)}catch(m){this.log.FINE("Failed adding filter: "+a[e]),this.failedFilters=this.failedFilters||[],this.failedFilters.push(a[e])}return c};
a.prototype.reset=function(){a.SUPER.prototype.reset.call(this);this.filtersPassed=void 0;this.oldPingSent=this.pingSent=this.oldDedupePingSent=this.dedupePingSent=!1;this._runner=this.filtersRunTriggered=this._runOnceIfFiltersPassTriggered=void 0;this.reRunCounter=0;this.detachVariablesChangedListeners()};a.prototype.resetFilters=function(){for(var a=0;a<this.filters.length;a++)this.filters[a].reset()};a.prototype.getParameterByTokenName=function(a){var b=null;if(this.parameters)for(var c=this.parameters,
e=0;e<c.length;e++)c[e].token===a&&(b=c[e]);return b};a.prototype.removeFilter=function(a){k.removeFromArray(this.filters,a)};var q=0,t=[],s={},p={};a.register=function(a){r.FINEST('registering tag named "'+a.config.name+'", instance of:');r.FINEST(a,!0);var b=k.addToArrayIfNotExist(t,a);-1!==b&&r.FINE("tag already exists in tags registry.");a._tagIndex=-1===b?t.length-1:b;a.config.id?(b="Q"+a.config.id,p[b]=a,a.uniqueId=b):p[a.CLASSPATH]=a};a.getById=function(a){return p[String(a)]};a.prototype.getById=
a.getById;a.prototype.unregister=function(b){a.unregister(b||this)};a.prototype.destroy=function(){this.destroyed=!0;this.cancel();a.unregister(this)};a.unregister=function(a){r.FINEST('Un-registering tag named "'+a.config.name+'", instance of:');r.FINEST(a,!0);var b=k.removeFromArray(t,a);b&&0!==b.length||r.FINEST("tag "+a.config.name+" is already unregistered.");a._tagIndex=-1};a.getTags=function(){return t};a.getAccessorsMap=function(){return s};a.prototype.getTags=function(){return t};a.prototype.getPageVariables=
function(){var a=this.parameters,b=[];if(a)for(var c=0;c<a.length;c++){var e=this.getVariableForParameter(a[c]);this._isVariable(e)&&k.addToArrayIfNotExist(b,e)}if(this.namedVariables)for(var d in this.namedVariables)k.addToArrayIfNotExist(b,l(this,d));return b};a.prototype.getAccessorString=function(){this._accessorsMapKey||(this._accessorsMapKey="_"+q++,s[this._accessorsMapKey]=this);return"qubit.opentag.BaseTag.getAccessorsMap()."+this._accessorsMapKey};a.prototype.getVariableForParameter=function(a){var b,
c=this.namedVariables;c&&c[a.token]&&(b=l(this,a.token));b||(b=e.validateAndGetVariableForParameter(a));return b};a.prototype.printVariablesState=function(){var a=[];this.log.FINE("Tag has been timed out, showing variables:");for(var b=e.getAllVariablesWithParameters(this),c=0;c<b.length;c++){var d=b[c].parameter,p=b[c].variable,f;f=d&&d.token?this.valueForToken(d.token):p.getRelativeValue(!0);p={name:p.config.name,exists:p.exists(),token:d?d.token:null,value:f,variable:p};a.push(p);this.log.FINE(" Variable Name: "+
p.name+", Exists: "+p.exists+", Token: "+(d?d.token:"<param is not assigned>")+", Value:"+f)}return a};a.prototype._triggerOnLoadTimeout=function(){this.printVariablesState();this.onLoadTimeout()};a.prototype.getId=function(){return this._getUniqueId()};a.prototype._getUniqueId=function(){return this.config.id?this.config.id:0===String(this.CLASSPATH).indexOf(m.STANDARD_CS_NS)?this.CLASSPATH.substring(m.STANDARD_CS_NS.length+1):this.CLASSPATH+"#"+this.config.name};a.prototype.cookieSaysToRunEvenIfDisabled=
function(){var a=this._getUniqueId(),b=!!f.getCached("qubit.tag.forceAllToRun");b||(b=!!f.getCached("qubit.tag.forceRunning_"+a));return b};a.prototype.setCookieForcingTagToRun=function(){var a=this._getUniqueId();f.set("qubit.tag.forceRunning_"+a,"true");f.resetCache()};a.setCookieForcingTagsToRun=function(){f.set("qubit.tag.forceAllToRun","true");f.resetCache()};a.prototype.setCookieToDisable=function(){var a=this._getUniqueId();f.set("qubit.tag.disableRunning_"+a,"true");f.resetCache()};a.prototype.rmCookieToDisable=
function(){var a=this._getUniqueId();f.rm("qubit.tag.disableRunning_"+a);f.resetCache()};a.prototype.disabledByCookie=function(){var a=this._getUniqueId();return!!f.getCached("qubit.tag.disableRunning_"+a)};a.rmCookieForcingTagsToRun=function(){f.rm("qubit.tag.forceAllToRun");f.resetCache()};a.prototype.rmCookieForcingTagToRun=function(){var a=this._getUniqueId();f.rm("qubit.tag.forceRunning_"+a);f.resetCache()};a.rmAllDisablingCookies=function(){k.rmCookiesMatching("qubit.tag.disableRunning_");f.resetCache()};
a.rmAllCookiesForcingTagToRun=function(){k.rmCookiesMatching("qubit.tag.forceRunning_");a.rmCookieForcingTagsToRun()};a.prototype.onVariableChanged=function(a){this.attachVariablesChangedListeners(!0);this.events.on("variableChanged",a)};a.prototype._handleVariableChange=function(a){this.log.FINEST("Variable "+a.variable.CLASSPATH+" changed from : "+a.oldValue+"to:"+a.newValue);this.events.call("variableChanged",a);this.isRunning||!this.config.reRunOnVariableChange||!isNaN(this.config.reRunLimit)&&
this.config.reRunLimit<=this.reRunCounter||(a=this.reRunCounter+1,this.reset(),this.reRunCounter=a,this.resetFilters(),this.runIfFiltersPass())};a.prototype.attachVariablesChangedListeners=function(a){var b=this.getPageVariables();if(a=!!(this.config.reRunOnVariableChange||this.config.observeVariables||a))for(var c=0;c<b.length;c++)b[c].onValueChanged(this.handleVariableChange,a)};a.prototype.detachVariablesChangedListeners=function(){for(var a=this.getPageVariables(),b=0;b<a.length;b++)a[b].deatchOnValueChanged(this.handleVariableChange)};
a.prototype._markFinished=function(){this.log.FINE("Marked finished.");a.SUPER.prototype._markFinished.call(this);this.attachVariablesChangedListeners()};a.prototype.prepareForRestart=function(b){if(this.config.restartable&&(a.SUPER.prototype.prepareForRestart.call(this,!1),!b)){this.log.FINE("Restarting filters.");b=this.getFilters();for(var c=0;c<b.length;c++)b[c].prepareForRestart()}};a.prototype.restart=function(a){this.config.restartable&&(this.prepareForRestart(a),this.runIfFiltersPass())};
a.prototype.runPostInitialisationSection=function(){if(!this._postInitialisationRun&&(this._postInitialisationRun=!0,this.postInitialisationSection))try{this.postInitialisationSection()}catch(a){this.log.ERROR("Tag initialisation failed!",a)}}})();(function(){function a(a){if(a)if(a.alphabet)for(this.alphabet=a.alphabet,this.dict={},a=0;a<this.alphabet.length;a++)this.dict[this.alphabet[a]]=a;else this.alphabet=k,this.dict=b}function l(a,b){for(var c in b)if(a===b[c])return c;return null}for(var k=
[],c=Math.pow(2,8),d=0;d<c;d++)k.push(String.fromCharCode(d));for(var b={},c=0;c<k.length;c++)b[k[c]]=c;h.Define.clazz("qubit.compression.LZW",a);a.prototype.encode=function(a){for(var b=this.alphabet.length,c={},d=[],k=0,l=a.charAt(k++),h,s=this.dict;h=a.charAt(k++);){var p=l+h;if(s.hasOwnProperty(p)||c.hasOwnProperty(p))l=p;else{var n=s.hasOwnProperty(l)?s[l]:c[l];if(void 0===n)throw"Dictionary base is to small for those contents: "+l;d.push(n);c[p]=b++;l=h}}""!==l&&d.push(c.hasOwnProperty(l)?c[l]:
s[l]);return d};a.prototype.decode=function(a){for(var b=this.dict,c=this.alphabet.length,d,k={},h=l(a[0],b),t=h,s=[h],p=1;p<a.length;p++){var n=a[p];d=l(n,b);null===d&&(k.hasOwnProperty(n)&&(d=k[n]),null===d&&(d=t+h));s.push(d);h=d.charAt(0);k[c++]=t+h;t=d}return s.join("")}})();(function(){function a(a){}for(var l={},k=0;45>k;k++)l["abcdefghijklmnopqrstuvwxyz0123456789'%./:<>?[".charAt(k)]=k;for(var c={},k=0;45>k;k++)c['ABCDEFGHIJKLMNOPQRSTUVWXYZ*!-+()@{|}"]^_`~$&#'.charAt(k)]=k;for(var d={},k=
0;45>k;k++)d["abcdefghijklmnopqrstuvwxyz0123456789'%./:<>?[".charAt(k)]='ABCDEFGHIJKLMNOPQRSTUVWXYZ*!-+()@{|}"]^_`~$&#'.charAt(k);var b="abcdefghijklmnopqrstuvwxyz0123456789'%./:<>?[".split(""),e=b.length,g=new h.compression.LZW({});h.Define.clazz("qubit.compression.Compressor",a);a.prototype.compress=function(a,b){for(var c=(b||g).encode(a),d=[],e=0;e<c.length;e++)d.push(String.fromCharCode(c[e]));return d.join("")};a.prototype.compressAnsi=function(a,c){for(var k=(c||g).encode(a),l=[],h=0;h<k.length;h++){var s;
s=k[h];var p=0,n=0>s;n&&(s=-s);var w="",u=!0;do p=s%e,u?(w=d[b[p]],u=!1):w=b[p]+w,s=(s-p)/e;while(0<s);s=n?"-"+w:w;l.push(s)}return l.join("")};a.prototype.decompressAnsi=function(a,b){for(var d=[],k="",h=0;h<a.length;h++){var s=a.charAt(h);if(c.hasOwnProperty(s)){for(var s=k+s,k="",p=0,n=0,w=!0,u=0;u<s.length;u++){var A=s.charAt(s.length-1-u);w&&(w=!1,A="abcdefghijklmnopqrstuvwxyz0123456789'%./:<>?[".charAt(c[A]));p+=l[A]*Math.pow(e,n++)}s=p;d.push(s)}else k+=s}return(b||g).decode(d)};a.prototype.decompress=
function(a,b){for(var c=[],d=0;d<a.length;d++)c.push(a.charCodeAt(d));return(b||g).decode(c)}})();(function(){function a(a){for(var b=[],c=0;c<a.length;c++){var e=d(a[c][0]);b.push([new RegExp(e,"g"),"*"+a[c][1]])}return b}function l(a,b){for(var c=0;c<b.length;c++)if(b[c][1]===a)return b[c][0];return null}function k(b){this._regexDefs=m;this._defs=f;b&&b.definitions&&(this._regexDefs=a(b.definitions),this._defs=b.definitions)}function c(a,b){for(var c=[],d=0;d<a.length;d++){var e=!0;b&&(e=a.charCodeAt(d)<=
b);var f=g.cookieAlphabetMap.hasOwnProperty(a.charAt(d));e&&!f?c.push("*"+a.charCodeAt(d)+"."):c.push(a.charAt(d))}return c.join("")}function d(a){return a.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function b(a){for(var b={},c="",d=0;d<a.length;d++){var e=a.charAt(d);r[e]?c+=e:(isNaN(b[c])&&(b[c]=a.split(c).length-1),c="")}a=[];for(var f in b)b.hasOwnProperty(f)&&(c=b[f],c>=t&&f.length>=q&&a.push([f,c]));return a=a.sort(function(a,b){return a[0].length===b[0].length?0:b[0].length>a[0].length?
1:-1})}var e=h.Define,g=h.Cookie,f=[['","referrer":[{"url":"http://',"1-"],['","referrer":[{"url":"https://',"2-"],[',"referrer":[{"url":"http://',"3-"],[',"referrer":[{"url":"https://',"4-"],[',"sessionStartTime":',"5-"],["www.google.co.uk","6-"],["www.google.","7-"],['"sessionStartTime":',"8-"],['"landing":"',"9-"],["http%3A%2F%2Fwww","10-"],['"landing":',"L"],['"time":',"A"],['"pageViews":',"P"],['"sessionCount":',"B"],['"referrer":',"R"],['"url":"http://www.',"J"],['"url":"https://www.',"M"],
['"url":"',"I"],['"url":',"U"],["http://www.","W"],["https://www.","V"],["%2Fen%2Ftsuk%2F","K"],['"sessionLandingPage":',"F"],["http%3A%2F%2F","D"],["http://","H"],["https://","X"],['""',"O"],['",',"Y"],['":{}}',"z"],["<","S"],[">","G"],["[","Z"],["]","E"],["{","a"],["}","b"],["(","c"],[")","d"],["!","e"],["#","f"],["$","g"],["!","q"],["'","i"],[":","j"],["?","k"],["^","x"],["`","m"],["|","n"],["~","o"],["%","v"],[",","C"]],m=a(f);e.clazz("qubit.opentag.compression.Encoder",k);k.prototype.encode=
function(a,e){for(var n=a.replace(/\*/g,"**"),f=b(n),g=0;g<this._regexDefs.length;g++)var k=this._regexDefs[g],n=n.replace(k[0],k[1]);n=n.replace(/;/g,"*-");n=n.replace(/&/g,"*.");n=n.replace(/\\/g,"*/");n=n.replace(/=/g,"*+");n=n.replace(/\n/g,"*N");n=n.replace(/ /g,"*_");n=n.replace(/\t/g,"*T");n=n.replace(/"/g,"*Q");g=b(n);g.concat(f);for(var f=n.replace(/@/g,"@@"),k=[],m=0,l=0;m<g.length;m++){var h=new RegExp(d(g[m][0]),"g"),h=f.replace(h,"@"+l+"-");h!==f&&(k.push(g[m][0]),l++,f=h)}g=[f,k];f=
g[1];(k=0<f.length)&&(n=g[0]);n=e?c(n,e):c(n);return k?"Y"+f.join("*")+"@"+n:"N"+n};for(var r={},e=0;65>e;e++)r["abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ+_.".charAt(e)]=!0;var q=4,t=2;k.prototype.decode=function(a){var b=null;if("N"===a.charAt(0))a=a.substring(1);else if("Y"===a.charAt(0)){var c=a.indexOf("@");if(0<=c&&(b=a.substring(1,c),b=b.split("*"),a=a.substring(c+1),b&&0!==b.length&&a)){for(var c="",d=!1,e=!1,f="",g=0;g<a.length;g++){var k=a.charAt(g);"@"===k||d||e?d||
e?(d=!1,"@"===k?c+="@":isNaN(+("-"+k))?e?(c=b&&"-"===k&&b[+f]?c+b[+f]:c+("@"+f+k),f="",e=!1):c+="@"+k:(e=!0,f+=k)):d=!0:c+=k}f&&(c+="@"+f);d&&(c+="@");a=c}}b="";d=c=!1;e="";for(f=0;f<a.length;f++)g=a.charAt(f),"*"===g||c||d?c||d?(c=!1,isNaN(+("-"+g))?d?(b="."===g?b+String.fromCharCode(+e):"-"===g&&l(e+"-",this._defs)?b+l(e+"-",this._defs):b+("*"+e+g),e="",d=!1):"*"===g?b+="*":"-"===g?b+=";":"/"===g?b+="\\":"."===g?b+="&":"+"===g?b+="=":"N"===g?b+="\n":"_"===g?b+=" ":"T"===g?b+="\t":"Q"===g?b+='"':
null!==l(g,this._defs)?(g=l(g,this._defs),b+=g):b+="*"+g:(e+=g,d=!0)):c=!0:b+=g;e&&(b+="*"+e);c&&(b+="*");return b}})();(function(){function a(a){this.testBinary=!1;this.binSupported=d;a&&(c.FINEST("Created compressor instance."),this.compressor=new h.compression.Compressor,this.encoder=new h.opentag.compression.Encoder({}))}var l=h.Define,k=h.Cookie,c=new h.opentag.Log("CookieCompressor -> "),d=!1;l.clazz("qubit.opentag.compression.CookieCompressor",a);a.prototype.compress=function(a,d){if("string"!==
typeof a||""===a)return a;c.FINEST("Compressing...");var g=this.encoder.encode(a),f;if(this.binSupported||this.testBinary){f=this.compressor.compress(g);f='"B'+this.encoder.encode(f,128)+'"';k.set("__qtag_test_bin__",f,void 0,void 0,!0);var m=k.get("__qtag_test_bin__",!0);k.rm("__qtag_test_bin__");m&&m!==f&&(f=null,c.FINEST("Binary cookie saving trial failed."))}m=this.encoder.encode(this.compressor.compressAnsi(g));g=!d&&g.length<=m.length?"E"+g:"C"+m;if(f&&f.length<g.length)return c.FINEST("Binary compression ratio:"+
f.length/a.length),f;c.FINEST("Compression ratio: "+g.length/a.length);return g};a.prototype.decompress=function(a){if("string"!==typeof a||""===a)return a;'"'===a.charAt(0)&&(a=a.substring(1,a.length-1));c.FINEST("Decompressing...");var d=a.charAt(0);a=a.substring(1);switch(d){case "E":return this.encoder.decode(a);case "C":return a=this.compressor.decompressAnsi(this.encoder.decode(a)),this.encoder.decode(a);case "B":return a=this.compressor.decompress(this.encoder.decode(a)),this.encoder.decode(a);
default:throw"This code is not supported! Code: "+d;}}})();(function(){function a(c){k.setIfUnset(c,a.defaultConfig);if(this.singleton){var b=h.opentag.Utils.getObjectUsingPath(this.PACKAGE_NAME+"."+this.CLASS_NAME,C);if(b.__instance)return b.__instance.log.FINEST("Returning singleton instance."),b.__instance;b.__instance=this}a.SUPER.call(this,c)}function l(a,b){var c=a.toString(),c=c.replace(/\s*function\s*\([\w\s,_\d\$]*\)\s*\{/,""),c=c.substring(0,c.lastIndexOf("}")),c=c.replace(/(["']\s*\+\s*)\s*_*\w+\s*\.\s*valueForToken\s*\(\s*'([^']*)'\s*\)/g,
'$1"${$2}"'),c=c.replace(/\s*_*\w+\s*\.\s*valueForToken\s*\(\s*'([^']*)'\s*\)(\s*\+\s*["'])/g,'"${$1}"$2'),c=c.replace(/(["']\s*\+\s*)\s*_*\w+\s*\.\s*valueForToken\s*\(\s*"([^"]*)"\s*\)/g,'$1"${$2}"'),c=c.replace(/\s*_*\w+\s*\.\s*valueForToken\s*\(\s*"([^"]*)"\s*\)(\s*\+\s*["'])/g,'"${$1}"$2'),c=c.replace(/(\s*)_*\w+\s*\.\s*valueForToken\s*\(\s*'([^']*)'(\s*)\)/g,"$1${$2}$3"),c=c.replace(/(\s*)_*\w+\s*\.\s*valueForToken\s*\(\s*"([^"]*)"(\s*)\)/g,"$1${$2}$3"),c=b.replaceTokensWithValues(c);k.geval(c)}
var k=h.opentag.Utils,c=h.Define;h.Define.clazz("qubit.opentag.LibraryTag",a,h.opentag.BaseTag);a.defaultConfig={vendor:null,imageUrl:null,description:"",async:!1,isPrivate:!1,upgradeable:!0,html:"",parameters:[],prePostWindowScope:!1};a.prototype.pre=function(){this.log.FINEST("emtpy pre called")};a.prototype.post=function(){this.log.FINEST("emtpy post called")};a.prototype.before=function(){a.SUPER.prototype.before.call(this);this.log.INFO("Running PRE script execution...");try{var c=this.config;
if(c&&c.pre)if("function"===typeof c.pre)this.pre=c.pre;else{var b=this.replaceTokensWithValues(String(c.pre));this.pre=k.expressionToFunction(b).bind(this)}this.config.prePostWindowScope&&this.pre!==a.prototype.pre&&this.pre.toString?l(this.pre,this):this.pre()}catch(e){return this.log.ERROR(this.config.name+" exception while running pre: "+e),!0}return!1};a.prototype.after=function(c){a.SUPER.prototype.after.call(this,c);this.log.INFO("Running POST script execution...");try{var b=this.config;if(b&&
b.post)if("function"===typeof b.post)this.post=b.post;else{var e=this.replaceTokensWithValues(String(b.post));this.post=k.expressionToFunction(e).bind(this)}this.config.prePostWindowScope&&this.post!==a.prototype.post&&this.post.toString?l(this.post,this):this.post(c)}catch(g){this.log.ERROR(this.config.name+" exception while running post: "+g)}};a.define=function(d,b){d=d.replace(/^[\.]+/g,"").replace(/[\.]+$/g,"").replace(/\.+/g,".");d=h.Define.vendorsSpaceClasspath(d);var e={};b.getDefaultConfig&&
(e=b.getDefaultConfig());var g=b.CONSTRUCTOR,f={},m;for(m in b)"config"!==m&&(f[m]=b[m]);f=h.opentag.Utils.defineWrappedClass(d,a,f,y,function(a){a=a||{};a=k.overrideFromLeftToRight(e,a);var b=h.opentag.LibraryTag.call(this,a);g&&g.call(this,a);if(b)return b});m=c.STANDARD_VS_NS+".";0!==d.indexOf(m)&&k.namespace(m+d,f);return f};a.getLibraryByClasspath=function(a){return k.getObjectUsingPath(a,h.Define.getVendorSpace())}})();(function(){function a(k){l.setIfUnset(k,{url:null,html:"",locationPlaceHolder:"NOT_END",
locationObject:"BODY",async:!0});a.SUPER.call(this,k)}var l=h.opentag.Utils;h.Define.clazz("qubit.opentag.CustomTag",a,h.opentag.LibraryTag)})();(function(){var a=new h.opentag.Log("Tags -> "),l=h.opentag.Utils,k=h.opentag.filter.BaseFilter,c=function(){};h.Define.clazz("qubit.opentag.Tags",c);c.getById=function(a){return h.opentag.BaseTag.getById(String(a))};c.getAllTagsByState=function(){return h.opentag.Container.getAllTagsByState(c.getTags())};c.findTagByName=function(a){for(var c=this.getTags(),
d=[],f=0;f<c.length;f++)c[f].config.name===a&&d.push(c[f]);return d};c.findTagByMatch=function(a){for(var c=this.getTags(),d=[],f=0;f<c.length;f++)c[f].config.name.match(a)&&d.push(c[f]);return d};c.findTagContainers=function(a){for(var d=c.getContainers(),g=[],f=0;f<d.length;f++){var k=d[f].tags,l;for(l in k)if(k[l]===a){g.push(d[f]);break}}return g};c.getTags=function(){a.FINEST("getTags");return h.opentag.BaseTag.getTags()};c.resetAllTags=function(b){a.WARN("reseting all tags!");for(var d=c.getTags(),
g=0;g<d.length;g++)d[g].reset(),b||d[g].resetFilters()};c.getContainersPageVariables=function(){for(var a=c.getContainers(),d=[],g=0;g<a.length;g++)d=d.concat(a.getPageVariables());return d};c.getAllPageVariables=function(){for(var a=c.getTags(),d=[],g=0;g<a.length;g++)d=d.concat(a[g].getPageVariables());return d};c.cancelAll=function(){for(var a=c.getTags(),d=0;d<a.length;d++)a[d].cancel()};c.resetAll=function(a){for(var d=c.getTags(),g=0;g<d.length;g++)d[g].reset(),a||d[g].resetFilters()};c.getPageVariableByName=
function(a){for(var d=c.getAllPageVariables(),g=[],f=0;f<d.length;f++)d[f].config.name===a&&g.push(d[f]);return g};c.getLoadTime=function(a){var c=a.beforeRun,d=a.runIsFinished;return isNaN(d)?{tag:a,loadTime:null}:{tag:a,loadTime:d-c}};c.getLoadTimes=function(a){var d=[];if(a instanceof h.opentag.BaseTag)return d.push([c.getLoadTime(a[g])]),d;a=a||c.getTags();if(a instanceof Array)for(g=0;g<a.length;g++)a[g]instanceof h.opentag.BaseTag&&d.push(c.getLoadTime(a[g]));else for(var g in a)a[g]instanceof
h.opentag.BaseTag&&d.push(c.getLoadTime(a[g]));return d};c.forceAllContainersAndTagsToRunIfDisabled=function(){h.opentag.Container.setCookieForDisabledContainersToRun();h.opentag.BaseTag.setCookieForcingTagsToRun()};c.rmAllContainersAndTagsForcingFlags=function(){h.opentag.Container.rmCookieForDisabledContainersToRun();h.opentag.BaseTag.rmAllCookiesForcingTagToRun()};c.getContainers=function(){return h.opentag.Container.getContainers()};c.findAllTagsByClassPath=function(b){var d=(new Date).valueOf(),
g=[],f=[];try{f.push(h.opentag.CustomTag),f.push(h.opentag.LibraryTag)}catch(k){a.FINEST("Warning:Missing known libraries: CustomTag, LibraryTag")}for(var r=c.getTags(),q=0;q<r.length;q++){var t=r[q];0>l.indexInArray(f,t)&&0===t.PACKAGE_NAME.indexOf(b)&&(g.push(t),a.FINEST("findAllTagsByClassPath(): found: "+t.PACKAGE_NAME+" -> "+t.config.name))}a.FINE("findAllTags(): selection found in "+((new Date).valueOf()-d));return g};c.findAllTags=function(b,d){var g=h.opentag.BaseTag,f=[],k=(new Date).valueOf();
try{f.push(h.opentag.CustomTag),f.push(h.opentag.LibraryTag)}catch(l){a.FINEST("Warning:Missing known libraries: CustomTag, LibraryTag")}g=c.findAllInstances(b,g,f,d);a.FINE("findAllTags(): found in "+((new Date).valueOf()-k));return g};var d=function(b,c,d,f){var k=[];"string"===typeof b&&(b=l.getObjectUsingPath(b));if(b){var h={objectsOnly:!0};f&&(h.maxDeep=!0);h.track=!0;f=(new Date).valueOf();var q=function(b,f,p,n){if(c(b)){for(f=0;f<d.length;f++)if(d[f]===b)return!0;a.FINE("found ["+n+"]:"+
(b.config?b.config.name:p));l.addToArrayIfNotExist(k,b);return!0}return!1}.bind(this);l.traverse(b,q,h);a.FINE("Found in "+((new Date).valueOf()-f))}return k};c.findAllInstances=function(a,c,g,f){return d(a,function(a){return a instanceof c},g,f)};c.findAllInheriting=function(a,c,g,f){return d(a,function(a){return a.prototype instanceof c},g,f)};c.findAllFilters=function(b,d){var g=[];try{g.push(h.opentag.filter.Filter),g.push(h.opentag.filter.URLFilter)}catch(f){a.FINE("Warning: Missing known libraries: CustomTag, LibraryTag")}return c.findAllInheriting(b,
k,g,d)};a.INFO("*** Qubit TagSDK *** ",!0,"font-size: 22px; color:#CCC;text-shadow:#fff 0px 1px 0, #555 0 -1px 0;")})();F={};B=void 0;F.update=function(){var a,l;l=function(){return Math.floor(1+65536*Math.random()).toString(36).substring(1)};window.__pageViewId__||(a=(new Date).getTime().toString(36),window.__pageViewId__=a+l()+l()+l());return window.__pageViewId__};v.PostData=function(a,l,k,c){var d,b,e;d=navigator.userAgent.toLowerCase();b=-1!==d.indexOf("msie");d.indexOf("msie 9");d=-1!==d.indexOf("msie 7")||
-1!==d.indexOf("msie 6");e=("https:"===document.location.protocol?"https:":"http:")+a;k=k||"POST";a=function(){var a;try{a=null;try{a=new XMLHttpRequest}catch(d){}a&&!b?a.open(k,e,!0):"undefined"!==typeof XDomainRequest?(a=new XDomainRequest,a.open(k,e)):a=null;try{a.withCredentials=!1}catch(m){}a.setRequestHeader&&(c?a.setRequestHeader("Content-Type",c):a.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));a.onload=function(){};a.onreadystatechange=function(){};a.ontimeout=function(){};
a.onerror=function(){};a.onprogress=function(){};a.send(l)}catch(h){try{try{v.fileLoader.load(e)}catch(q){window.console&&window.console.log&&window.console.log(h)}}catch(t){}}};d?v.fileLoader.load(e):a()};(function(){function a(){}function l(a,d){var b={};b.clientId=""+d.clientId;b.containerId=""+a.getContainerId();b.classpath=""+a.PACKAGE_NAME;b.opentagStats=!0;a.sentPing?b.containerLoad=!1:(a.sentPing=(new Date).valueOf(),b.containerLoad=!0);b.isS3=!1;b.pageViewId=F.update();b.tags=[];return b}
var k=new h.opentag.Log("Ping -> ");h.Define.clazz("qubit.opentag.Ping",a);a.prototype.sendErrors=function(a,d){k.WARN("Errors sending is disabled.")};a.getPingID=function(a){if(a.config.id)return a.config.id;var d=a.PACKAGE_NAME.lastIndexOf(".");return-1!==d?a.PACKAGE_NAME.substring(d+1):a.PACKAGE_NAME};a.prototype.send=function(c,d){for(var b=c.config,e=l(c,b),g=e.tags,b=b.pingServerUrl,f=0;f<d.length;f++){var m=d[f].tag,h=d[f].loadTime;if(null!==h&&!isNaN(h)){var q={},t=a.getPingID(m);!m.pingSent&&
t&&null!==h?void 0!==t?(q.tagId=t,q.loadTime=h,q.fired=!0,g.push(q),m.pingSent=!0):k.WARN("send: tag `"+m.config.name+"` has no ID assigned! Time load will not be sent."):m.pingSent?k.FINEST("send: ping already sent for `"+m.config.name+"`, ignoring."):null===h&&k.FINEST("send: null load times for `"+m.config.name+"`, ignoring (ping not sent).")}}b&&(0<g.length||e.containerLoad)?(e=z.stringify(e),g="//"+b,k.FINE("send: sending pings "+g),v.PostData(g,e,"POST","text/plain;charset=UTF-8")):(g.length||
k.FINE("send: no pings to sent"),b||k.WARN("send: pingURL is unset!"))};a.prototype.sendDedupe=function(c,d){for(var b=c.config,e=l(c,b),b=b.pingServerUrl,g=e.tags,f=0;f<d.length;f++){var m=d[f],h=a.getPingID(m),q={};void 0===h?k.WARN("sendDedupe: tag `"+m.config.name+"` has no ID assigned! Deduplicaton time load will not be sent."):m.dedupePingSent||(q.tagId=""+h,q.fired=!1,q.loadTime=0,g.push(q),m.dedupePingSent=!0)}b&&(0<g.length||e.containerLoad)?(e=z.stringify(e),b="//"+b,k.FINE("send: sending pings "+
b),v.PostData(b,e,"POST","text/plain;charset=UTF-8")):(g.length||k.FINE("sendDedupe: no dedupe pings to sent"),b||k.WARN("sendDedupe: pingURL is unset!"))}})();B={_cookieName:"_qst_s",_sessionCookie:"_qsst_s",update:function(a){var l,k;l=h.Cookie.get(B._cookieName);k=h.Cookie.get(B._sessionCookie);if(l){if(l=parseInt(l,10),!k||parseInt(k,10)<(new Date).getTime()-18E5)l+=1}else l=1;h.Cookie.set(B._cookieName,l,365,a);h.Cookie.set(B._sessionCookie,(new Date).getTime().toString(),null,a);return l}};
var z={};(function(){function a(a){return 10>a?"0"+a:a}function l(a){d.lastIndex=0;return d.test(a)?'"'+a.replace(d,function(a){var b=g[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function k(c,d){var g,h,s,p,n=b,w,u=d[c];if(u instanceof Date)g=u,u=isFinite(g.valueOf())?g.getUTCFullYear()+"-"+a(g.getUTCMonth()+1)+"-"+a(g.getUTCDate())+"T"+a(g.getUTCHours())+":"+a(g.getUTCMinutes())+":"+a(g.getUTCSeconds())+"Z":null;else if(u instanceof String||
u instanceof Number||u instanceof Boolean)u=u.valueOf();"function"===typeof f&&(u=f.call(d,c,u));switch(typeof u){case "string":return l(u);case "number":return isFinite(u)?String(u):"null";case "boolean":case "null":return String(u);case "object":if(!u)return"null";b+=e;w=[];if("[object Array]"===Object.prototype.toString.apply(u)){p=u.length;for(g=0;g<p;g+=1)try{w[g]=k(g,u)||"null"}catch(A){w[g]='{"stack_exceeded": null}'}s=0===w.length?"[]":b?"[\n"+b+w.join(",\n"+b)+"\n"+n+"]":"["+w.join(",")+
"]";b=n;return s}if(f&&"object"===typeof f)for(p=f.length,g=0;g<p;g+=1){if("string"===typeof f[g]){h=f[g];try{s=k(h,u)}catch(v){s='{"stack_exceeded": null}'}s&&w.push(l(h)+(b?": ":":")+s)}}else for(h in u)if(Object.prototype.hasOwnProperty.call(u,h)){try{s=k(h,u)}catch(x){s='{"stack_exceeded": null}'}s&&w.push(l(h)+(b?": ":":")+s)}s=0===w.length?"{}":b?"{\n"+b+w.join(",\n"+b)+"\n"+n+"}":"{"+w.join(",")+"}";b=n;return s}}var c=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
d=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,b,e,g={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},f;"function"!==typeof z.stringify&&(z.stringify=function(a,c,d){var g;e=b="";if("number"===typeof d)for(g=0;g<d;g+=1)e+=" ";else"string"===typeof d&&(e=d);if((f=c)&&"function"!==typeof c&&("object"!==typeof c||"number"!==typeof c.length))throw Error("JSON.stringify");return k("",{"":a})});"function"!==
typeof z.parse&&(z.parse=function(a,b){function d(a,c){var e,f,g=a[c];if(g&&"object"===typeof g)for(e in g)Object.prototype.hasOwnProperty.call(g,e)&&(f=d(g,e),void 0!==f?g[e]=f:delete g[e]);return b.call(a,c,g)}var e;a=String(a);c.lastIndex=0;c.test(a)&&(a=a.replace(c,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,
"")))return e=eval("("+a+")"),"function"===typeof b?d({"":e},""):e;throw new SyntaxError("JSON.parse");})})();(function(){var a=h.Cookie,l=h.opentag.Utils,k=new h.opentag.Log("Session -> "),c=function(){};h.Define.clazz("qubit.opentag.Session",c);var d=new h.opentag.compression.CookieCompressor({});c.readCompressedCookie=function(b){b=a.get(b,!0);return d.decompress(b)};c.setupSession=function(b){var e=b.config,g,f,h,r,q;g={};g.sessionCount=B.update(e.cookieDomain);q="qtag_"+b.getContainerId();var t=
"x_qtag_"+b.getContainerId();h=a.get(q);b=!!h;null===h&&(h=a.get(t,!0),h=d.decompress(h));if(h)try{h=z.parse(h)}catch(s){h={sc:0,sessionCount:0,pageViews:0,sessionStartTime:0,referrer:[],sessionLandingPage:"",__v:{}}}else h={sc:0,sessionCount:0,pageViews:0,sessionStartTime:0,referrer:[],sessionLandingPage:"",__v:{}};f=(new Date).getTime();g.sessionCount!==parseInt(h.sc,10)?(h.sessionStartTime=f,h.sc=g.sessionCount,h.sessionCount+=1,h.referrer.push({url:c.getReferrer(),landing:l.getUrl().substring(0,
300),time:f}),h.sessionLandingPage=l.getUrl().substring(0,300)):c.isReferrerDifferent()&&!c.referrerIsSameAsPrevious(h.referrer,f,18E5)&&(h.referrer.push({url:c.getReferrer(),landing:l.getUrl().substring(0,300),time:f}),h.sessionLandingPage=l.getUrl().substring(0,300),h.sessionStartTime=f,h.sessionCount+=1);g.sessionCount=h.sessionCount;g.sessionStartTime=h.sessionStartTime;g.pageStartTime=f;h.pageViews+=1;g.pageViews=h.pageViews;g.sessionLandingPage=h.sessionLandingPage;g.referrer=h.referrer;5<g.referrer.length&&
g.referrer.splice(2,g.referrer.length-5);r=z.stringify(h);for(f=0;d.compress(r).length>e.maxCookieLength&&5>f;)3<=h.referrer.length?h.referrer.splice(2,1):2===h.referrer.length?h.referrer=[h.referrer[0]]:1===h.referrer.length&&(h.referrer=[]),r=z.stringify(h),f+=1;g.referrer=h.referrer;b&&a.rm(q);q=d.compress(r);a.rm(t);0<e.maxCookieLength&&a.set(t,q,365,e.cookieDomain,!0);g.setVariable=function(b,c,f){h.__v[b]=[c,f?f:0];b=d.compress(z.stringify(h));0<e.maxCookieLength?a.set(t,b,365,e.cookieDomain,
!0):a.rm(t)};g.getCookie=function(b,c){var e=a.get(b,!0);if(e&&(c||0===b.indexOf("x_"))){k.FINE("getCookie() : Comressed cookie accessed:\n"+b+"="+e);try{e=d.decompress(e)}catch(f){k.ERROR("Cookie failed to decompress: "+f)}}else null!==e&&(e=a.decode(e));return e};g.getVariable=function(a){var b;if(a=h.__v[a])if(b=a[1],0===b||b>(new Date).getTime())return a[0];return null};g.on=function(a,b,c){b.attachEvent?b.attachEvent("on"+a,c):b.addEventListener&&b.addEventListener(a,c,!1)};g.getTagCookie=function(){return c.readCompressedCookie(t)};
return c.lastSession=g};c.referrerIsSameAsPrevious=function(a,d,g){var f,h;return 0<a.length?(f=c.getReferrer(),h=l.getUrl().substring(0,300),a=a[a.length-1],a.url===f&&a.landing===h&&a.time+g>d):!1};c.isReferrerDifferent=function(){var a,d;d=c.getReferrer();a=d.indexOf("://");if(-1===a)return!0;try{return 0!==d.substring(a+3).indexOf(c.getDomain())?!0:!1}catch(g){return!0}};c.getReferrer=function(){return document.referrer?document.referrer.substring(0,300):"direct"};c.getDomain=function(){return document.location.host}})();
(function(){function a(){}var l=h.opentag.LibraryTag,k=h.Define;a.library=function(){return l.define.apply(l,arguments)};a.libraryRef=function(){return l.getLibraryByClasspath.apply(l.getLibraryByClasspath,arguments)};k.namespace("qubit.Quick",a)})();(function(){function a(b){this.runQueue=[];this.log=new h.opentag.Log("",function(){return this.CLASS_NAME+"["+this.config.name+"]"}.bind(this),!0);this.tags=[];this.config={cookieDomain:"",maxCookieLength:1E3,gzip:!0,delayDocWrite:!1,clientId:"",name:"",
tellLoadTimesProbability:null,pingServerUrl:null,trackSession:null,disabled:!1,containerId:"",scanTags:!1,noPings:!1,restartable:!0};this.ignoreTagsState=!1;if(b){this.setConfig(b);b.name||(this.config.name="Cont-"+q++);a.register(this);this.log.FINE("container registered.");a.NO_PINGS&&(this.config.noPings=!0);this.ping=new h.opentag.Ping(this.config);this._sendPingsTrigger=this.sendPings.bind(this);if(b.init)try{b.init.call(this,b)}catch(c){this.log.ERROR("init call failed:"+c)}var d=this;this._tagLoadedHandler=
function(a){d._containerAlreadySentPings&&(d.sendPingsNotTooOften(),a.success&&a.tag.log.INFO("[Other]SENDING LOAD STATS"))}}this.events=new h.Events({});return this}function l(a,b,c,d){a[c]&&(d[c]=d[c]+1||1,c+="("+d[c]+")");a[c]=b}var k=h.opentag.Utils,c=h.opentag.filter.BaseFilter,d=h.opentag.filter.Filter,b=h.opentag.BaseTag,e=h.opentag.Timed,g=h.opentag.Tags,f=h.opentag.Session,m=h.Cookie,r=new h.opentag.Log("Container -> "),q=1;try{window.opentag_consentGiven=function(){a.consentIsGiven=!0;for(var b=
a.getContainers(),c=0;c<b.length;c++)try{b[c].run()}catch(d){r.ERROR("error running consent dependant containers: "+d)}}.bind(this)}catch(t){r.WARN("opentag_consentGiven could not be set!")}h.Define.clazz("qubit.opentag.Container",a);var s=[];a.prototype.EVENT_TYPES={RESTART_EVENT:"restart"};a.register=function(a){k.addToArrayIfNotExist(s,a)};a.prototype.isTellingLoadTimes=function(){var a=this.config.tellLoadTimesProbability;null===a&&(a=0);return a>Math.random()};a.prototype.destroy=function(a){this.destroyed=
!0;this.unregister();for(var c=0;c<this.tags.length;c++){var d=this.tags[c];d.owningContainer===this&&(d.owningContainer=null,a&&d instanceof b&&d.destroy())}this.tags=[]};a.destroyAll=function(b){for(var c=a.getContainers(),d=0;d<c.length;d++)c[d].destroy(b)};a.findContainersByName=function(b){for(var c=a.getContainers(),d=[],e=0;e<c.length;e++)c[e].config.name===b&&d.push(c[e]);return d};a.getById=function(b){for(var c=a.getContainers(),d=0;d<c.length;d++)if(c[d].getContainerId()===b)return c[d];
return null};a.prototype.unregister=function(b){a.unregister(this,b)};a.unregister=function(a,c){k.addToArrayIfNotExist(s,a);r.FINEST('Un-registering container named "'+a.config.name+'", instance of:');r.FINEST(a,!0);var d=k.removeFromArray(s,a);if(c){for(var e=0;e<a.tags.length;e++){var f=a.tags[e];f.owningContainer===a&&(f.owningContainer=null,f instanceof b&&f.unregister())}a.tags=[]}d&&0!==d.length||r.FINE("container is already unregisterd.")};a.prototype.hasConsent=function(){return"Accepted"===
m.get("qubitconsent")};a.prototype.register=function(b){a.register(b||this)};a.getContainers=function(){return s};a.prototype.getContainers=function(){return a.getContainers()};a.prototype.onTagRegistered=function(a){};a.prototype.registerTag=function(a){if(null!==a.owningContainer)return this.log.FINE("Tag `"+a.config.name+"` is already registered!"),!1;this.tags.push(a);a.owningContainer=this;a.onAfter(this._tagLoadedHandler);try{this.onTagRegistered(a)}catch(b){this.log.ERROR("onTagRegistered exception: "+
b)}return!0};a.prototype.unregisterTag=function(a){a.owningContainer===this&&(a.owningContainer=null);for(var b=0;b<this.tags.length;)this.tags[b]===a?this.tags.splice(b,1):b++};a.prototype.registerTags=function(a){for(var b=0;b<a.length;b++)this.registerTag(a[b])};a.prototype.setConfig=function(a){this.log.FINEST("Setting configuration:");this.log.FINEST(a,!0);for(var b in a)this.config[b]=a[b]};a.prototype.run=function(){this.log.FINE("starting loading");this.runTags({command:"runOnceIfFiltersPass"})};
a.prototype.runWithoutFilters=function(){this.log.FINE("starting loading");this.runTags({command:"run"})};a.prototype.containerScriptLoadedSynchronously=function(){var a,b,c,d,e;d=document.getElementsByTagName("script");a=0;for(b=d.length;a<b;a+=1)if(c=d[a],(e=c.getAttribute("src"))&&0<e.indexOf(""+this.config.clientId+"-"+this.getContainerId()+".js"))return null===c.getAttribute("async")&&(!1===c.getAttribute("defer")||""===c.getAttribute("defer")||null===c.getAttribute("defer"));return!0};a.prototype.prepareSessionIfNeeded=
function(){var b=this.config.trackSession;if(!0!==b&&!1!==b)for(b=0;b<this.tags.length;b++){var c=this.tags[b];c.resolveAllDynamicData();for(var c=c.getFilters(),e=0;e<c.length;e++){var g=c[e];if(g instanceof d&&g.isSession()){this.trackSession=!0;break}}if(this.trackSession)break}else this.trackSession=b;a.TRACK_SESSION&&(this.trackSession=!0);this.trackSession&&(this.session=f.setupSession(this));this.session&&(this.log.INFO("Session attached:"),this.log.INFO(this.session,!0))};a.runtimeCounter=
a.runtimeCounter||1;a.prototype.runTags=function(b,c){if(this.destroyed)throw"Container has been destroyed.";if(c||!a.LOCKED&&!k.global().QUBIT_CONTAINERS_LOCKED){if(this.onBeforeRun)try{this.onBeforeRun()}catch(d){this.log.ERROR("Soft failure [Container.onBeforeRun()]: "+d)}var f=!this.containerScriptLoadedSynchronously(),g="runIfFiltersPass";b&&b.command&&(g=b.command);this.runningStarted=(new Date).valueOf();this.log.FINE("triggering runningStarted at "+this.runningStarted);this.config.scanTags&&
!this._scanned&&(this.scanForTags(),this._scanned=(new Date).valueOf());this.prepareSessionIfNeeded();for(var h=this.getTagsInOrder(),l="___otctnmk"+a.runtimeCounter++,m=0;m<h.length;m++)try{var r=h[m];this.includedToRun(r)&&this._checkAndRun(r,g,f,l)}catch(q){this.log.ERROR("Error while preparing tag '"+r.CLASSPATH+"' to run.\n Error: "+q)}e.setTimeout(function(){this.sendPingsNotTooOften()}.bind(this),3100);this.waitForAllTagsToFinish();for(f=0;f<h.length;f++)h[f]._runtimeMarkers[l]=void 0,delete h[f]._runtimeMarkers[l]}else this.log.INFO("All containers are LOCKED."),
this.log.INFO("To run, set Container.LOCKED to false and  set Utils.global().QUBIT_CONTAINERS_LOCKED to false or use force parameter."),this.log.WARN("Container locked - stopping here.")};a.prototype.getTagsInOrder=function(){for(var a=[],b=0;b<this.tags.length;b++){var c=this.tags[b],d=c.config.priority;if(0<+d){for(var e=0,f=0;f<a.length;f++){var g=a[f];if(g)if(g=+g.config.priority,0<g&&g>d)e++;else break}a.splice(e,0,c)}else a.push(c)}return a};a.prototype._checkAndRun=function(a,b,c,d){if(!a._runtimeMarkers[d]){a._runtimeMarkers[d]=
!0;var e=a.resolveDependencies();if(0<e.length)for(var f=0;f<e.length;f++)this._checkAndRun(e[f],b,c,d);this._tagRunner(a,b,c)}};a.prototype._tagRunner=function(a,b,c){try{this.includedToRun(a)&&(this.log.FINE("triggering tag named: "+a.config.name),c&&(a.forceAsynchronous=!0),this.config.delayDocWrite&&(a.delayDocWrite=!0),a.session=a.session||this.session,a[b]())}catch(d){this.log.ERROR(" -> tagRunner: Error running tag with name '"+a.config.name+"'.\n Error: "+d)}};a.prototype.getContainerId=function(){if(this.config.containerId)return this.config.containerId;
if(this._pkgName)return this._pkgName;var a=this.PACKAGE_NAME.split(".");return this._pkgName=a=a[a.length-1]};a.prototype.includedToRun=function(c){if(!c)return!1;var d=c.config;if(d.inactive||d.disabled&&!c.cookieSaysToRunEvenIfDisabled()||c.disabledByCookie())return!1;d=a.consentIsGiven||!d.needsConsent||this.hasConsent();c=c.state===b.prototype.STATE.INITIAL;return this.ignoreTagsState||d&&c};a.prototype.scanForTags=function(a,b){a&&(this.tags=[]);var c;c=b&&"object"===typeof b?this.findAllTags(b):
this.findAllTagsByClassPath();this.registerTags(c);return c};a.prototype.findAllTags=function(a,b){a=a||this.tagsPackageName||this.PACKAGE_NAME;return g.findAllTags(a,b)};a.prototype.findAllTagsByClassPath=function(a){a=a||this.PACKAGE_NAME;return g.findAllTagsByClassPath(a)};a.prototype.findAllFilters=function(a,b){a=a||this.tagsPackageName||this.PACKAGE_NAME;return g.findAllFilters(a,b)};a.prototype.waitForAllTagsToFinish=function(){if(!this._waitForAllTagsToFinishWaiting){this._lastWaited||(this._lastWaited=
(new Date).valueOf());var a=this.log,b=15E3<(new Date).valueOf()-this._lastWaited,c=this.allTagsFinished()||b;if(!this._showFinishedOnce&&c){this._lastWaited=null;b&&this.log.WARN("Waiting too long. Check tags dependencies.");this._showFinishedOnce=!0;this.runningFinished=(new Date).valueOf();b=this.getAllTagsByState();c=null===b.awaiting?0:k.keys(b.awaiting).length;a.INFO("********************************************************",0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");a.INFO("Startup tags have ended their processing.",
0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");a.INFO("Finished in "+(this.runningFinished-this.runningStarted)+"ms.",0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");var d;b.run?(d=k.keys(b.run).length,a.INFO("Successfully run tags["+d+"]:",0," ;color: #0F7600;font-size: 12px;font-weight:bold; "),a.INFO(b.run,!0)):a.INFO("No successfully run tags.",0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");b.failed?(d=k.keys(b.failed).length,a.INFO("Failed to run["+d+"]:",0," ;color: #0F7600;font-size: 12px;font-weight:bold; "+
(null===b.failed?"":"color: #DF5500;")),a.INFO(b.failed,!0)):a.INFO("No failed tags.",0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");b.awaiting?(d=k.keys(b.awaiting).length,a.INFO("There is still "+c+" tag(s) ready to be fired by awaiting filters that can run.",0," ;color: #0F7600;font-size: 12px;font-weight:bold; color: #DC9500;"),a.INFO("Filter ready tags["+d+"]:",0," ;color: #0F7600;font-size: 12px;font-weight:bold; color: #DC9500;"),a.INFO(b.awaiting,!0)):a.INFO("No filter ready tags.",
0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");b.consent?(d=k.keys(b.consent).length,a.INFO("Consent awaiting tags["+d+"]:",0," ;color: #0F7600;font-size: 12px;font-weight:bold; "),a.INFO(b.consent,!0)):a.INFO("No consent awaiting tags.",0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");b.locked?(d=k.keys(b.locked).length,a.INFO("Locked ["+d+"]:",0," ;color: #0F7600;font-size: 12px;font-weight:bold; "),a.INFO(b.locked,!0)):a.INFO("No locked tags.",0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");
b.other?(d=k.keys(b.other).length,a.INFO("Other unloaded tags["+d+"]:",0," ;color: #0F7600;font-size: 12px;font-weight:bold; "),a.INFO(b.other,!0)):a.INFO("No unloaded tags.",0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");a.INFO("********************************************************",0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");this._containerAlreadySentPings=(new Date).valueOf();this.sendPingsNotTooOften();if(this.onTagsInitiallyRun)this.onTagsInitiallyRun()}else c?(a.INFO("********************************************************"),
a.WARN("All tags seem to finished current jobs."),a.INFO("********************************************************")):(this._waitForAllTagsToFinishWaiting=!0,this._showFinishedOnce=!1,e.setTimeout(function(){this._waitForAllTagsToFinishWaiting=!1;this.waitForAllTagsToFinish()}.bind(this),100))}};a.prototype.onTagsInitiallyRun=x;a.prototype.resetAllTags=function(a){this.log.INFO("reseting all tags!");for(var b=0;b<this.tags.length;b++)this.tags[b].reset(),a||this.tags[b].resetFilters()};a.prototype._prepareTagsToRestart=
function(a){this.log.INFO("restarting all tags.");for(var b=0;b<this.tags.length;b++)this.tags[b].prepareForRestart(a)};a.prototype.reset=function(a,b){this.log.WARN("reseting container!");this._showFinishedOnce=this.runningStarted=this._waitForAllTagsToFinishWaiting=this.runningFinished=void 0;a||this.resetAllTags(b)};a.prototype.onRestart=function(a){this.events.on("restart",a)};a.prototype.restart=function(a,b){this.config.restartable&&(this.events.call("restart",this),this.reset(!0,!0),a||this._prepareTagsToRestart(b),
this.run())};a.restartAll=function(b,c){for(var d=a.getContainers(),e=0;e<d.length;e++)try{d[e].restart(b,c)}catch(f){r.ERROR("Restart failed for container "+d[e].config.name,f)}};a.resetAll=function(b,c){for(var d=a.getContainers(),e=0;e<d.length;e++)try{d[e].reset(b,c)}catch(f){r.ERROR("Reset failed for container "+d[e].config.name,f)}};a.prototype.sendPingsNotTooOften=function(){this._sndLck=this._sndLck||{};e.runIfNotScheduled(this._sendPingsTrigger,2E3,this._sndLck)};a.prototype.sendPings=function(){if(this.config.noPings)this.log.WARN("Pings are cancelled due to configuration.");
else{var a;if(this.isTellingLoadTimes()){var b=this.getAllTagsByState(),c=[];b.run&&(c=g.getLoadTimes(b.run));this.log.INFO("Sending standard load pings");this.lastPingsSentTime=(new Date).valueOf();this.ping.send(this,c);var c=g.getLoadTimes(),d=[];for(a=0;a<c.length;a++){var e=c[a].tag;e.config.dedupe&&e.sendDedupePing&&d.push(e)}0<d.length&&(this.log.INFO("Sending deduplication pings"),this.lastDedupePingsSentTime=(new Date).valueOf(),this.ping.sendDedupe(this,d));if(b.other){c=g.getLoadTimes(b.other);
d=[];for(a=0;a<c.length;a++)d.push(c[a]);0<d.length&&this.ping.send(this,d)}if(b.awaiting){c=g.getLoadTimes(b.awaiting);b=[];for(a=0;a<c.length;a++)b.push(c[a]);0<b.length&&this.ping.send(this,b)}}else this.ping.send(this,[])}};a.prototype.getAllTagsByState=function(){return a.getAllTagsByState(this.tags)};a.getAllTagsByState=function(a){for(var d=null,e=null,f=null,g=null,h=null,k=null,m={},r=b.prototype.STATE.EXECUTED_WITH_ERRORS,q=0;q<a.length;q++){var s=a[q];if(s instanceof b){var t=s.config.name;
0<s.scriptExecuted?(d=d||{},l(d,s,t,m)):s.locked?(k=k||{},l(k,s,t,m)):0>s.scriptExecuted||s.state>=r?(g=g||{},l(g,s,t)):s.filtersState()===c.state.SESSION||0<s.filtersState()?(f=f||{},l(f,s,t,m)):s.config.needsConsent?(h=h||{},l(h,s,t,m)):(e=e||{},l(e,s,t,m))}}return{run:d,failed:g,awaiting:f,consent:h,locked:k,other:e}};a.prototype.allTagsFinished=function(){for(var a=0;a<this.tags.length;a++){var b=this.tags[a];if(b instanceof h.opentag.BaseTag){var d=b.filtersState();if(!b.config.disabled){var e=
0>b.filtersState()&&!b.locked,f=!(b.finished()||b.config.runner&&!b.isRunning);if(e&&f&&(b=0<+b.awaitingDependencies,d!==c.state.SESSION&&!b))return!1}}}return!0};a.prototype.getPageVariables=function(){for(var a=[],b=0;b<this.tags.length;b++)for(var c=this.tags[b].getPageVariables(),d=0;d<c.length;d++)k.addToArrayIfNotExist(a,c[d]);return a};a.getPageVariableByName=function(a){for(var b=this.getAllPageVariables(),c=[],d=0;d<b.length;d++)b[d].config.name===a&&c.push(b[d]);return c};a.prototype._getCookieNameForDisabling=
function(){return"qubit.opentag.disableContainerRunning_"+this.getContainerId()+this.config.name};a.prototype.disabledByCookie=function(){return!!m.getCached(this._getCookieNameForDisabling())};a.prototype.setCookieToDisable=function(){m.set(this._getCookieNameForDisabling(),"true");m.resetCache()};a.prototype.rmCookieToDisable=function(){m.rm(this._getCookieNameForDisabling());m.resetCache()};a.rmAllDisablingCookies=function(){k.rmCookiesMatching("qubit.opentag.disableContainerRunning_");m.resetCache()};
a.setCookieForDisabledContainersToRun=function(){m.set("qubit.opentag.forceContainerRunning","true");m.resetCache()};a.rmCookieForDisabledContainersToRun=function(){m.rm("qubit.opentag.forceContainerRunning");m.resetCache()}})();(function(){var a={callbacks:{},unfired_events:[],early_callbacks:null,currentUV:null},h,k="universal_variable";a._isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)};a._targetChanged=function(c,d,b){if(null===b)return"null"===d?!1:!0;if(void 0===
b)return d===b?!1:!0;d=z.parse(d);d=a._getNested(d,c);c=a._getNested(b,c);return!a._jsonIsEqual(d,c)};a._processCallbacks=function(){var c;if(a.early_callbacks&&0<a.early_callbacks.length){for(c=0;c<a.early_callbacks.length;c+=1)a.push(a.early_callbacks[c]);a.early_callbacks=null}};a._keyStringToArr=function(a){a=a.replace(/^\s+/,"").replace(/\s+$/,"");if(""===a)return[];a=a.replace(/\[(\w+)\]/g,".$1");a=a.replace(/^\./,"");return a.split(".")};a._getNested=function(c,d){for(var b=a._keyStringToArr(d),
e;0<b.length;)if(e=b.shift(),c.hasOwnProperty(e))c=c[e];else return;return c};a._jsonIsEqual=function(c,d){"string"!==typeof c&&(c=z.stringify(c,a._stripEvents));"string"!==typeof d&&(d=z.stringify(d,a._stripEvents));return c===d};a._stripEvents=function(a,d){if("events"!==a)return d};a._on=function(c,d){var b;b=c.split(":");c=b[0];b=b[1];a.callbacks[c]=a.callbacks[c]||[];b?a.callbacks[c].push({keyString:b,func:d}):a.callbacks[c].push({func:d})};a._trigger=function(c,d){var b,e;if(a.callbacks[c])for(b=
0;b<a.callbacks[c].length;b+=1)"function"===typeof a.callbacks[c][b].func&&((e=a.callbacks[c][b].keyString)?"change"===c&&a._targetChanged(e,a.currentUV,h)&&a.callbacks[c][b].func(d):a.callbacks[c][b].func(d))};a._eventsPush=function(c){var d,b;h.events[h.events.length]=c;c.time=c.time||(new Date).getTime();if(a.callbacks.event)for(d=0,b=a.callbacks.event.length,d;d<b;d+=1)a.callbacks.event[d].func(c);c.has_fired=!0};a._getUnfiredEvents=function(){for(var c=0,c=0;c<h.events.length;c+=1)h.events[c].has_fired||
(a.unfired_events.push(h.events.splice(c,1)[0]),c-=1)};a._fireEvents=function(){for(;0<a.unfired_events.length;)h.events.push(a.unfired_events.shift())};a._resetEventsPush=function(){h.events=h.events||[];-1!==h.events.push.toString().indexOf("[native code]")&&(h.events.push=a._eventsPush,a._getUnfiredEvents(),a._fireEvents())};a._checkForChanges=function(){a.callbacks.change&&0<a.callbacks.change.length&&!a._jsonIsEqual(a.currentUV,h)&&(a._trigger("change",h),a.currentUV=z.stringify(h,a._stripEvents))};
a._setUVLocation=function(c){k=c;a._initUV()};a._initUV=function(){window[k]=window[k]||{events:[]};h=window[k];h.events||(h.events=[])};a.push=function(c){a._isArray(c)&&("on"===c[0]?a._on(c[1],c[2]):"trigger"===c[0]&&c[1]&&a._trigger(c[1]))};a.init=function(c,d){d&&(k=d);a._initUV();!window.uv_listener||a._isArray(window.uv_listener)?(a.early_callbacks=window.uv_listener||null,window.uv_listener=a,c||a.start()):d&&window.uv_listener._setUVLocation(k)};a.start=function(){a.currentUV=z.stringify(h,
a._stripEvents);setInterval(function(){a._initUV();a._resetEventsPush();a._checkForChanges()},500);a._processCallbacks()};v.UVListener=a})();(function(){function a(){}function l(a,b,c){!c||void 0!==a[b]&&""!==a[b]&&null!==a[b]||(a[b]=c)}function k(a){var c=a.PACKAGE_NAME.split("."),c=c[c.length-1];a=b.getParentObject(a.PACKAGE_NAME);a[c]=null;delete a[c]}var c=new h.opentag.Log("Main -> "),d=h.Cookie,b=h.opentag.Utils;h.opentag.Log.setLevel(h.opentag.Log.LEVEL_NONE);h.opentag.Log.setCollectLevel(3);
h.opentag.Log.setLevel(h.opentag.Log.LEVEL_INFO);h.opentag.Log.setCollectLevel(4);h.opentag.Log.setLevelFromCookie();a.run=function(){var b=!1,g;a:{try{var f=y.TAGSDK_MAIN_DISABLED_FUNCTION;if(f&&f()){g=!0;break a}}catch(k){c.ERROR("Buggy GLOBAL.TAGSDK_MAIN_DISABLED_FUNCTION ?\n "+k)}g=0<=document.location.href.indexOf("opentag_disabled=true")?!0:!1}if(!g){g=!1;g=!0;h.DEBUG_MODE=!0;f=!1;if(d.get("opentag_debug_tool")||0<=document.location.href.indexOf("opentag_debug_tool"))f=!0;var l;!(l=f)&&(l=!1,
d.get("opentag_debug")||0<=document.location.href.indexOf("opentag_debug"))&&(l=!0);!g&&l&&(y.TAGSDK_NS_OVERRIDE=h.DEBUG_MODE?!1:!0,b=!0);h.DEBUG_MODE&&(y.TAGSDK_NS_OVERRIDE=!1);try{v.UVListener.init()}catch(q){}a.runAllContainers(b);!b&&g&&f&&!y.TAGSDK_DEBUG_TOOL_LOADED&&(b=document.createElement("script"),b.src="https://s3-eu-west-1.amazonaws.com/opentag-dev/debug-tool/loader-v3.js",document.getElementsByTagName("head")[0].appendChild(b),y.TAGSDK_DEBUG_TOOL_LOADED=!0)}};a.runAllContainers=function(d){try{for(var g=
h.opentag.Container.getContainers(),f=0;f<g.length;f++){var m=g[f],r=m.config;if(!m.runningStarted&&!m.configuredInMain){r.scanTags=!0;var q=b.getParentObject(m.PACKAGE_NAME).ClientConfig;q&&l(m.config,"clientId",q.id);var t=b.getParentObject(m.PACKAGE_NAME).SystemDefaults;t&&(l(r,"pingServerUrl",t.pingServerUrl),l(r,"tellLoadTimesProbability",t.tellLoadTimesProbability));m.configuredInMain=!0;d?(m.destroy(!0),k(m),a.loadDebugVersion(m)):y.QUBIT_OPENTAG_STOP_MAIN_EXECUTION?function(){var a=h.opentag.RUN_STOPPED_EXECUTON;
h.opentag.RUN_STOPPED_EXECUTON=function(){try{a&&a()}finally{m.run()}}}(m):(c.INFO("Running container "+m.CLASSPATH),m.run())}}}catch(s){}};a.loadDebugVersion=function(a){var c=document.createElement("script"),d,h=a.config.scriptURL,k;(k=b.getParentObject(a.PACKAGE_NAME).ClientConfig)&&k.clientId?k=k.clientId:(k=a.PACKAGE_NAME.split("."),k=k[k.length-2].substring(1));a=a.getContainerId();h&&(d=h,d.lastIndexOf("-debug.js")!==d.length-9&&(d=d.substring(0,d.length-3),d+="-debug.js"));c.src=d&&"//d3c3cq33003psk.cloudfront.net/opentag-"+
k+"-"+a+"-debug.js"!==d?d:"//s3-eu-west-1.amazonaws.com/opentag/opentag-"+k+"-"+a+"-debug.js";document.getElementsByTagName("head")[0].appendChild(c)};h.Define.namespace("qubit.opentag.Main",a)})()})();
